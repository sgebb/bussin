(function(ie){"use strict";function st(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}function we(R){throw new Error('Could not dynamically require "'+R+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ee={exports:{}},ke;function at(){return ke||(ke=1,(function(R,F){(function(y){R.exports=y()})(function(){return(function(){function y(T,m,u){function c(p,f){if(!m[p]){if(!T[p]){var i=typeof we=="function"&&we;if(!f&&i)return i(p,!0);if(_)return _(p,!0);var h=new Error("Cannot find module '"+p+"'");throw h.code="MODULE_NOT_FOUND",h}var j=m[p]={exports:{}};T[p][0].call(j.exports,function(C){var l=T[p][1][C];return c(l||C)},j,j.exports,y,T,m,u)}return m[p].exports}for(var _=typeof we=="function"&&we,A=0;A<u.length;A++)c(u[A]);return c}return y})()({1:[function(y,T,m){(function(u,c){(function(){var _=y("./errors.js"),A=y("./frames.js"),p=y("./log.js"),f=y("./sasl.js"),i=y("./util.js"),h=y("./endpoint.js"),j=y("./session.js"),C=y("./transport.js"),l=y("fs"),v=y("os"),k=y("path"),O=y("net"),L=y("tls"),P=y("events").EventEmitter,E=0;function U(){var g;u.env.MESSAGING_CONNECT_FILE?g=[u.env.MESSAGING_CONNECT_FILE]:g=[u.cwd(),k.join(v.homedir(),".config/messaging"),"/etc/messaging"].map(function(e){return k.join(e,"/connect.json")});for(var I=0;I<g.length;I++)if(l.existsSync(g[I])){var Y=JSON.parse(l.readFileSync(g[I],"utf8"));return p.config("using config from %s: %j",g[I],Y),Y}return{}}function M(){var g=U(),I={};return g.scheme==="amqps"&&(I.transport="tls"),g.host&&(I.host=g.host),g.port==="amqp"?I.port=5672:g.port==="amqps"?I.port=5671:I.port=g.port,g.sasl&&g.sasl.enabled===!1||(g.user?I.username=g.user:I.username="anonymous",g.password&&(I.password=g.password),g.sasl_mechanisms&&(I.sasl_mechanisms=g.sasl_mechanisms)),g.tls&&(g.tls.key&&(I.key=l.readFileSync(g.tls.key)),g.tls.cert&&(I.cert=l.readFileSync(g.tls.cert)),g.tls.ca&&(I.ca=[l.readFileSync(g.tls.ca)]),(g.verify===!1||g.tls.verify===!1)&&(I.rejectUnauthorized=!1)),I.transport==="tls"&&(I.servername=I.host),I}function w(g){return g.get_id_string?g.get_id_string():g.localAddress+":"+g.localPort+" -> "+g.remoteAddress+":"+g.remotePort}function r(g){var I=null;return{get_session:function(){return I||(I=g.create_session(),I.observers.on("session_close",function(){I=null}),I.begin()),I}}}function a(g,I){if(g){var Y=g,e;return function(o){return e!==o&&(Y=g,e=o),Y--?I(o):-1}}else return I}function S(g,I){var Y=g,e;return function(o){e!==o&&(Y=g,e=o);var b=Y,z=Y*2;return Y=I>z?z:I,b}}function x(g){if(g.transport===void 0||g.transport==="tcp")return O.connect;if(g.transport==="tls"||g.transport==="ssl")return L.connect;throw Error("Unrecognised transport: "+g.transport)}function N(g){var I={};return I.connect=g.connect?g.connect:x(g),I.host=g.host?g.host:"localhost",I.port=g.port?g.port:5672,I.options=g,I}var W=["container_id","hostname","max_frame_size","channel_max","idle_time_out","outgoing_locales","incoming_locales","offered_capabilities","desired_capabilities","properties"];function $(g){return function(){return this.remote.open?this.remote.open[g]:void 0}}function V(g){var I={};return W.forEach(function(Y){g[Y]!==void 0&&(I[Y]=g[Y])}),I}function H(g,I){if(typeof g=="boolean")if(g){var Y=I.get_option("initial_reconnect_delay",100),e=I.get_option("max_reconnect_delay",6e4);I.options.reconnect=a(I.get_option("reconnect_limit"),S(Y,e))}else I.options.reconnect=!1;else if(typeof g=="number"){var o=I.options.reconnect;I.options.reconnect=a(I.get_option("reconnect_limit"),function(){return o})}}var q=1,G=function(g,I){if(this.options={},g){for(var Y in g)this.options[Y]=g[Y];(g.transport==="tls"||g.transport==="ssl")&&g.servername===void 0&&g.host!==void 0&&(this.options.servername=g.host)}else this.options=M();if(this.container=I,this.options.id||(this.options.id="connection-"+q++),this.options.container_id||(this.options.container_id=I?I.id:i.generate_uuid()),!this.options.connection_details){var o=this;this.options.connection_details=function(){return N(o.options)}}var e=this.get_option("reconnect",!0);H(e,this),this.registered=!1,this.state=new h,this.local_channel_map={},this.remote_channel_map={},this.local={},this.remote={},this.local.open=A.open(V(this.options)),this.local.close=A.close({}),this.session_policy=r(this),this.amqp_transport=new C(this.options.id,E,A.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.conn_established_counter=0,this.heartbeat_out=void 0,this.heartbeat_in=void 0,this.abort_idle=void 0,this.socket_ready=!1,this.scheduled_reconnect=void 0,this.default_sender=void 0,this.closed_with_non_fatal_error=!1;var o=this;W.forEach(function(b){Object.defineProperty(o,b,{get:$(b)})}),Object.defineProperty(this,"error",{get:function(){return this.remote.close?this.remote.close.error:void 0}})};G.prototype=Object.create(P.prototype),G.prototype.constructor=G,G.prototype.dispatch=function(g){return p.events("[%s] Connection got event: %s",this.options.id,g),this.listeners(g).length?(P.prototype.emit.apply(this,arguments),!0):this.container?this.container.dispatch.apply(this.container,arguments):!1},G.prototype._disconnect=function(){this.state.disconnected();for(var g in this.local_channel_map)this.local_channel_map[g]._disconnect();this.socket_ready=!1},G.prototype._reconnect=function(){this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0,this.local.close.error=void 0,this.state=new h,this.state.open()),this.state.reconnect(),this._reset_remote_state()},G.prototype._reset_remote_state=function(){this.amqp_transport=new C(this.options.id,E,A.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.remote={},this.remote_channel_map={};var g=this.local_channel_map;for(var I in g)g[I]._reconnect()},G.prototype.connect=function(){return this.is_server=!1,this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0),this._reset_remote_state(),this._connect(this.options.connection_details(this.conn_established_counter)),this.open(),this},G.prototype.reconnect=function(){return this.scheduled_reconnect=void 0,p.reconnect("[%s] reconnecting...",this.options.id),this._reconnect(),this._connect(this.options.connection_details(this.conn_established_counter)),u.nextTick(this._process.bind(this)),this},G.prototype.set_reconnect=function(g){H(g,this)},G.prototype._connect=function(g){return g.connect?this.init(g.connect(g.port,g.host,g.options,this.connected.bind(this))):this.init(x(g)(g.port,g.host,g.options,this.connected.bind(this))),this},G.prototype.accept=function(g){return this.is_server=!0,p.io("[%s] client accepted: %s",this.id,w(g)),this.socket_ready=!0,this.init(g)},G.prototype.abort_socket=function(g){g===this.socket&&(this.abort_idle=void 0,p.io("[%s] aborting socket",this.options.id),this.socket.end(),this.socket.removeAllListeners&&(this.socket.removeAllListeners("data"),this.socket.removeAllListeners("error"),this.socket.removeAllListeners("end")),typeof this.socket.destroy=="function"&&this.socket.destroy(),this._disconnected())},G.prototype.init=function(g){if(this.socket=g,this.get_option("tcp_no_delay",!1)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.socket.on("data",this.input.bind(this)),this.socket.on("error",this.on_error.bind(this)),this.socket.on("end",this.eof.bind(this)),this.is_server){var I;if(this.container&&Object.getOwnPropertyNames(this.container.sasl_server_mechanisms).length&&(I=this.container.sasl_server_mechanisms),this.socket.encrypted&&this.socket.authorized&&this.get_option("enable_sasl_external",!1)&&(I=f.server_add_external(I?i.clone(I):{})),I)I.ANONYMOUS!==void 0&&!this.get_option("require_sasl",!1)?this.sasl_transport=new f.Selective(this,I):this.sasl_transport=new f.Server(this,I);else if(!this.get_option("disable_sasl",!1)){var Y=f.server_mechanisms();Y.enable_anonymous(),this.sasl_transport=new f.Selective(this,Y)}}else{var e=this.get_option("sasl_mechanisms");if(!e){var o=this.get_option("username"),b=this.get_option("password"),z=this.get_option("token");o&&(e=f.client_mechanisms(),b?e.enable_plain(o,b):z?e.enable_xoauth2(o,z):e.enable_anonymous(o))}this.socket.encrypted&&this.options.cert&&this.get_option("enable_sasl_external",!1)&&(e||(e=f.client_mechanisms()),e.enable_external()),e&&(this.sasl_transport=new f.Client(this,e,this.options.sasl_init_hostname||this.options.servername||this.options.host))}return this.transport=this.sasl_transport?this.sasl_transport:this.amqp_transport,this},G.prototype.attach_sender=function(g){return this.session_policy.get_session().attach_sender(g)},G.prototype.open_sender=G.prototype.attach_sender,G.prototype.attach_receiver=function(g){return this.get_option("tcp_no_delay",!0)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.session_policy.get_session().attach_receiver(g)},G.prototype.open_receiver=G.prototype.attach_receiver,G.prototype.get_option=function(g,I){return this.options[g]!==void 0?this.options[g]:this.container?this.container.get_option(g,I):I},G.prototype.send=function(g){return this.default_sender===void 0&&(this.default_sender=this.open_sender({target:{}})),this.default_sender.send(g)},G.prototype.connected=function(){this.socket_ready=!0,this.conn_established_counter++,p.io("[%s] connected %s",this.options.id,w(this.socket)),this.output()},G.prototype.sasl_failed=function(g,I){this.transport_error=new _.ConnectionError(g,I||"amqp:unauthorized-access",this),this._handle_error(),this.socket.end()},G.prototype._is_fatal=function(g){var I=this.get_option("all_errors_non_fatal",!1);if(I)return!1;var Y=this.get_option("non_fatal_errors",["amqp:connection:forced"]);return Y.indexOf(g)<0},G.prototype._handle_error=function(){var g=this.get_error();if(g){var I=this.dispatch("connection_error",this._context({error:g}));return I=this.dispatch("connection_close",this._context({error:g}))||I,this._is_fatal(g.condition)?I||this.dispatch("error",new _.ConnectionError(g.description,g.condition,this)):this.state.local_open&&(this.closed_with_non_fatal_error=!0),!0}else return!1},G.prototype.get_error=function(){if(this.transport_error)return this.transport_error;if(this.remote.close&&this.remote.close.error)return new _.ConnectionError(this.remote.close.error.description,this.remote.close.error.condition,this)},G.prototype._get_peer_details=function(){var g="";return this.remote.open&&this.remote.open.container&&(g+=this.remote.open.container+" "),this.remote.open&&this.remote.open.properties&&(g+=JSON.stringify(this.remote.open.properties)),g},G.prototype.output=function(){try{this.socket&&this.socket_ready&&(this.heartbeat_out&&clearTimeout(this.heartbeat_out),this.transport.write(this.socket),(this.is_closed()&&this.state.has_settled()||this.abort_idle||this.transport_error)&&!this.transport.has_writes_pending()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2)),this.local.open.idle_time_out&&this.heartbeat_in===void 0&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)))}catch(g){this.saved_error=g,g.name==="ProtocolError"?(console.error("["+this.options.id+"] error on write: "+g+" "+this._get_peer_details()+" "+g.name),this.dispatch("protocol_error",g)||console.error("["+this.options.id+"] error on write: "+g+" "+this._get_peer_details())):this.dispatch("error",g),this.socket.end()}};function oe(g){return g<16?"0x0"+Number(g).toString(16):"0x"+Number(g).toString(16)}function ne(g){for(var I=[],Y=0;Y<g.length;Y++)I.push(oe(g[Y]));return I.join(",")}G.prototype.input=function(g){var I;try{this.heartbeat_in&&clearTimeout(this.heartbeat_in),p.io("[%s] read %d bytes",this.options.id,g.length),this.previous_input?(I=c.concat([this.previous_input,g],this.previous_input.length+g.length),this.previous_input=null):I=g;var Y=this.transport.read(I,this);Y<I.length&&(this.previous_input=I.slice(Y)),this.local.open.idle_time_out&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)),this.transport.has_writes_pending()?this.output():this.is_closed()&&this.state.has_settled()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&!this.heartbeat_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2))}catch(e){this.saved_error=e,e.name==="ProtocolError"?this.dispatch("protocol_error",e)||console.error("["+this.options.id+"] error on read: "+e+" "+this._get_peer_details()+" (buffer:"+ne(I)+")"):this.dispatch("error",e),this.socket.end()}},G.prototype.idle=function(){this.is_closed()||(this.closed_with_non_fatal_error=!0,this.local.close.error={condition:"amqp:resource-limit-exceeded",description:"max idle time exceeded"},this.close(),this.abort_idle=setTimeout(this.abort_socket.bind(this,this.socket),1e3))},G.prototype.on_error=function(g){this._disconnected(g)},G.prototype.eof=function(g){var I=g||this.saved_error;this.saved_error=void 0,this._disconnected(I)},G.prototype._disconnected=function(g){this.heartbeat_out&&(clearTimeout(this.heartbeat_out),this.heartbeat_out=void 0),this.heartbeat_in&&(clearTimeout(this.heartbeat_in),this.heartbeat_in=void 0),this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0);var I=this.closed_with_non_fatal_error;if(this.closed_with_non_fatal_error&&(this.closed_with_non_fatal_error=!1,this.options.reconnect&&this.open()),(!this.is_closed()||I)&&this.scheduled_reconnect===void 0){this._disconnect();var Y={};if(g&&(Y.error=g),!this.is_server&&!this.transport_error&&this.options.reconnect){var e=this.options.reconnect(this.conn_established_counter);e>=0?(p.reconnect("[%s] Scheduled reconnect in "+e+"ms",this.options.id),this.scheduled_reconnect=setTimeout(this.reconnect.bind(this),e),Y.reconnecting=!0):Y.reconnecting=!1}this.dispatch("disconnected",this._context(Y))||console.warn("["+this.options.id+"] disconnected %s",Y.error||"")}},G.prototype.open=function(){this.state.open()&&this._register()},G.prototype.close=function(g){g&&(this.local.close.error=g),this.state.close()&&this._register()},G.prototype.is_open=function(){return this.state.is_open()},G.prototype.is_remote_open=function(){return this.state.remote_open},G.prototype.is_closed=function(){return this.state.is_closed()},G.prototype.create_session=function(){for(var g=0;this.local_channel_map[g];)g++;var I=new j(this,g);return this.local_channel_map[g]=I,I},G.prototype.find_sender=function(g){return this.find_link(i.sender_filter(g))},G.prototype.find_receiver=function(g){return this.find_link(i.receiver_filter(g))},G.prototype.find_link=function(g){for(var I in this.local_channel_map){var Y=this.local_channel_map[I],e=Y.find_link(g);if(e)return e}},G.prototype.each_receiver=function(g,I){this.each_link(g,i.receiver_filter(I))},G.prototype.each_sender=function(g,I){this.each_link(g,i.sender_filter(I))},G.prototype.each_link=function(g,I){for(var Y in this.local_channel_map){var e=this.local_channel_map[Y];e.each_link(g,I)}},G.prototype.on_open=function(g){if(this.state.remote_opened())this.remote.open=g.performative,this.open(),this.dispatch("connection_open",this._context());else throw new _.ProtocolError("Open already received")},G.prototype.on_close=function(g){if(this.state.remote_closed()){this.remote.close=g.performative,this.remote.close.error?this._handle_error():this.dispatch("connection_close",this._context()),this.heartbeat_out&&clearTimeout(this.heartbeat_out);var I=this;u.nextTick(function(){I.close()})}else throw new _.ProtocolError("Close already received")},G.prototype._register=function(){this.registered||(this.registered=!0,u.nextTick(this._process.bind(this)))},G.prototype._process=function(){this.registered=!1;do{this.state.need_open()&&this._write_open();var g=this.local_channel_map;for(var I in g)g[I]._process();this.state.need_close()&&this._write_close()}while(!this.state.has_settled())},G.prototype._write_frame=function(g,I,Y){this.amqp_transport.encode(A.amqp_frame(g,I,Y)),this.output()},G.prototype._write_open=function(){this._write_frame(0,this.local.open)},G.prototype._write_close=function(){this._write_frame(0,this.local.close),this.local.close.error=void 0},G.prototype.on_begin=function(g){var I;if(g.performative.remote_channel===null||g.performative.remote_channel===void 0)I=this.create_session(),I.local.begin.remote_channel=g.channel;else if(I=this.local_channel_map[g.performative.remote_channel],!I)throw new _.ProtocolError("Invalid value for remote channel "+g.performative.remote_channel);I.on_begin(g),this.remote_channel_map[g.channel]=I},G.prototype.get_peer_certificate=function(){if(this.socket&&this.socket.getPeerCertificate)return this.socket.getPeerCertificate()},G.prototype.get_tls_socket=function(){if(this.socket&&(this.options.transport==="tls"||this.options.transport==="ssl"))return this.socket},G.prototype._context=function(g){var I=g||{};return I.connection=this,this.container&&(I.container=this.container),I},G.prototype.remove_session=function(g){this.remote_channel_map[g.remote.channel]===g&&delete this.remote_channel_map[g.remote.channel],this.local_channel_map[g.local.channel]===g&&delete this.local_channel_map[g.local.channel]},G.prototype.remove_all_sessions=function(){le(this.remote_channel_map),le(this.local_channel_map)};function le(g){for(var I in g)Object.prototype.hasOwnProperty.call(g,I)&&delete g[I]}function ue(g){G.prototype["on_"+g]=function(I){var Y=this.remote_channel_map[I.channel];if(!Y)throw new _.ProtocolError(g+" received on invalid channel "+I.channel);Y["on_"+g](I)}}ue("end"),ue("attach"),ue("detach"),ue("transfer"),ue("disposition"),ue("flow"),T.exports=G}).call(this)}).call(this,y("_process"),y("buffer").Buffer)},{"./endpoint.js":2,"./errors.js":3,"./frames.js":6,"./log.js":8,"./sasl.js":10,"./session.js":11,"./transport.js":13,"./util.js":15,_process:43,buffer:20,events:26,fs:19,net:19,os:41,path:42,tls:19}],2:[function(y,T,m){var u=function(){this.init()};u.prototype.init=function(){this.local_open=!1,this.remote_open=!1,this.open_requests=0,this.close_requests=0,this.initialised=!1,this.marker=void 0},u.prototype.mark=function(c){return this.marker=c||Date.now(),this.marker},u.prototype.open=function(){return this.marker=void 0,this.initialised=!0,this.local_open?!1:(this.local_open=!0,this.open_requests++,!0)},u.prototype.close=function(){return this.marker=void 0,this.local_open?(this.local_open=!1,this.close_requests++,!0):!1},u.prototype.disconnected=function(){var c=this.initialised;this.was_open=this.local_open,this.init(),this.initialised=c},u.prototype.reconnect=function(){this.was_open&&(this.open(),this.was_open=void 0)},u.prototype.remote_opened=function(){return this.remote_open?!1:(this.remote_open=!0,!0)},u.prototype.remote_closed=function(){return this.remote_open?(this.remote_open=!1,!0):!1},u.prototype.is_open=function(){return this.local_open&&this.remote_open},u.prototype.is_closed=function(){return this.initialised&&!(this.local_open||this.was_open)&&!this.remote_open},u.prototype.has_settled=function(){return this.open_requests===0&&this.close_requests===0},u.prototype.need_open=function(){return this.open_requests>0?(this.open_requests--,!0):!1},u.prototype.need_close=function(){return this.close_requests>0?(this.close_requests--,!0):!1},T.exports=u},{}],3:[function(y,T,m){var u=y("util");function c(p){Error.captureStackTrace(this,c),this.message=p,this.name="ProtocolError"}u.inherits(c,Error);function _(p){Error.captureStackTrace(this,_),this.message=p,this.name="TypeError"}u.inherits(_,c);function A(p,f,i){Error.captureStackTrace(this,A),this.message=p,this.name="ConnectionError",this.condition=f,this.description=p,Object.defineProperty(this,"connection",{value:i})}u.inherits(A,Error),A.prototype.toJSON=function(){return{type:this.name,code:this.condition,message:this.description}},T.exports={ProtocolError:c,TypeError:_,ConnectionError:A}},{util:46}],4:[function(y,T,m){var u;(function(p){p.message="message",p.receiverOpen="receiver_open",p.receiverDrained="receiver_drained",p.receiverFlow="receiver_flow",p.receiverError="receiver_error",p.receiverClose="receiver_close",p.settled="settled"})(u||(u={}));var c;(function(p){p.sendable="sendable",p.senderOpen="sender_open",p.senderDraining="sender_draining",p.senderFlow="sender_flow",p.senderError="sender_error",p.senderClose="sender_close",p.accepted="accepted",p.released="released",p.rejected="rejected",p.modified="modified",p.settled="settled"})(c||(c={}));var _;(function(p){p.sessionOpen="session_open",p.sessionError="session_error",p.sessionClose="session_close",p.settled="settled"})(_||(_={}));var A;(function(p){p.connectionOpen="connection_open",p.connectionClose="connection_close",p.connectionError="connection_error",p.protocolError="protocol_error",p.error="error",p.disconnected="disconnected",p.settled="settled"})(A||(A={})),T.exports={ReceiverEvents:u,SenderEvents:c,SessionEvents:_,ConnectionEvents:A}},{}],5:[function(y,T,m){var u=y("./types.js");T.exports={selector:function(c){return{"jms-selector":u.wrap_described(c,77567109365764)}}}},{"./types.js":14}],6:[function(y,T,m){var u=y("./types.js"),c=y("./errors.js"),_={},A={};_.read_header=function(w){var r=4,a={},S=w.toString("ascii",0,r);if(S!=="AMQP")throw new c.ProtocolError("Invalid protocol header for AMQP: "+w.toString("hex",0,r));if(a.protocol_id=w.readUInt8(r++),a.major=w.readUInt8(r++),a.minor=w.readUInt8(r++),a.revision=w.readUInt8(r++),a.protocol_id===0&&a.major===0&&a.minor===9&&a.revision===1)throw new c.ProtocolError("Unsupported AMQP version: 0-9-1");if(a.protocol_id===1&&a.major===1&&a.minor===0&&a.revision===10)throw new c.ProtocolError("Unsupported AMQP version: 0-10");if(a.major!==1||a.minor!==0)throw new c.ProtocolError("Unsupported AMQP version: "+JSON.stringify(a));return a},_.write_header=function(w,r){var a=4;return w.write("AMQP",0,a,"ascii"),w.writeUInt8(r.protocol_id,a++),w.writeUInt8(r.major,a++),w.writeUInt8(r.minor,a++),w.writeUInt8(r.revision,a++),8},_.TYPE_AMQP=0,_.TYPE_SASL=1,_.read_frame=function(w){var r=new u.Reader(w),a={};if(a.size=r.read_uint(4),r.remaining()<a.size-4)return null;var S=r.read_uint(1);if(S<2)throw new c.ProtocolError("Invalid data offset, must be at least 2 was "+S);if(a.type=r.read_uint(1),a.type===_.TYPE_AMQP)a.channel=r.read_uint(2);else if(a.type===_.TYPE_SASL)r.skip(2),a.channel=0;else throw new c.ProtocolError("Unknown frame type "+a.type);if(S>1&&r.skip(S*4-8),r.remaining()){a.performative=r.read();var x=A[a.performative.descriptor.value];x&&(a.performative=new x(a.performative.value)),r.remaining()&&(a.payload=r.read_bytes(r.remaining()))}return a},_.write_frame=function(w){var r=new u.Writer;if(r.skip(4),r.write_uint(2,1),r.write_uint(w.type,1),w.type===_.TYPE_AMQP)r.write_uint(w.channel,2);else if(w.type===_.TYPE_SASL)r.write_uint(0,2);else throw new c.ProtocolError("Unknown frame type "+w.type);w.performative&&(r.write(w.performative),w.payload&&r.write_bytes(w.payload));var a=r.toBuffer();return a.writeUInt32BE(a.length,0),a},_.amqp_frame=function(w,r,a){return{channel:w||0,type:_.TYPE_AMQP,performative:r,payload:a}},_.sasl_frame=function(w){return{channel:0,type:_.TYPE_SASL,performative:w}};function p(w,r){var a=u.define_composite(r);_[r.name]=a.create,A[Number(a.descriptor.numeric).toString(10)]=a,A[a.descriptor.symbolic]=a}var f={name:"open",code:16,fields:[{name:"container_id",type:"string",mandatory:!0},{name:"hostname",type:"string"},{name:"max_frame_size",type:"uint",default_value:4294967295},{name:"channel_max",type:"ushort",default_value:65535},{name:"idle_time_out",type:"uint"},{name:"outgoing_locales",type:"symbol",multiple:!0},{name:"incoming_locales",type:"symbol",multiple:!0},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]},i={name:"begin",code:17,fields:[{name:"remote_channel",type:"ushort"},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"incoming_window",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle_max",type:"uint",default_value:"4294967295"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]},h={name:"attach",code:18,fields:[{name:"name",type:"string",mandatory:!0},{name:"handle",type:"uint",mandatory:!0},{name:"role",type:"boolean",mandatory:!0},{name:"snd_settle_mode",type:"ubyte",default_value:2},{name:"rcv_settle_mode",type:"ubyte",default_value:0},{name:"source",type:"*"},{name:"target",type:"*"},{name:"unsettled",type:"map"},{name:"incomplete_unsettled",type:"boolean",default_value:!1},{name:"initial_delivery_count",type:"uint"},{name:"max_message_size",type:"ulong"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]},j={name:"flow",code:19,fields:[{name:"next_incoming_id",type:"uint"},{name:"incoming_window",type:"uint",mandatory:!0},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle",type:"uint"},{name:"delivery_count",type:"uint"},{name:"link_credit",type:"uint"},{name:"available",type:"uint"},{name:"drain",type:"boolean",default_value:!1},{name:"echo",type:"boolean",default_value:!1},{name:"properties",type:"symbolic_map"}]},C={name:"transfer",code:20,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"delivery_id",type:"uint"},{name:"delivery_tag",type:"binary"},{name:"message_format",type:"uint"},{name:"settled",type:"boolean"},{name:"more",type:"boolean",default_value:!1},{name:"rcv_settle_mode",type:"ubyte"},{name:"state",type:"delivery_state"},{name:"resume",type:"boolean",default_value:!1},{name:"aborted",type:"boolean",default_value:!1},{name:"batchable",type:"boolean",default_value:!1}]},l={name:"disposition",code:21,fields:[{name:"role",type:"boolean",mandatory:!0},{name:"first",type:"uint",mandatory:!0},{name:"last",type:"uint"},{name:"settled",type:"boolean",default_value:!1},{name:"state",type:"*"},{name:"batchable",type:"boolean",default_value:!1}]},v={name:"detach",code:22,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"closed",type:"boolean",default_value:!1},{name:"error",type:"error"}]},k={name:"end",code:23,fields:[{name:"error",type:"error"}]},O={name:"close",code:24,fields:[{name:"error",type:"error"}]};p(_.TYPE_AMQP,f),p(_.TYPE_AMQP,i),p(_.TYPE_AMQP,h),p(_.TYPE_AMQP,j),p(_.TYPE_AMQP,C),p(_.TYPE_AMQP,l),p(_.TYPE_AMQP,v),p(_.TYPE_AMQP,k),p(_.TYPE_AMQP,O);var L={name:"sasl_mechanisms",code:64,fields:[{name:"sasl_server_mechanisms",type:"symbol",multiple:!0,mandatory:!0}]},P={name:"sasl_init",code:65,fields:[{name:"mechanism",type:"symbol",mandatory:!0},{name:"initial_response",type:"binary"},{name:"hostname",type:"string"}]},E={name:"sasl_challenge",code:66,fields:[{name:"challenge",type:"binary",mandatory:!0}]},U={name:"sasl_response",code:67,fields:[{name:"response",type:"binary",mandatory:!0}]},M={name:"sasl_outcome",code:68,fields:[{name:"code",type:"ubyte",mandatory:!0},{name:"additional_data",type:"binary"}]};p(_.TYPE_SASL,L),p(_.TYPE_SASL,P),p(_.TYPE_SASL,E),p(_.TYPE_SASL,U),p(_.TYPE_SASL,M),T.exports=_},{"./errors.js":3,"./types.js":14}],7:[function(y,T,m){(function(u,c){(function(){var _=y("./frames.js"),A=y("./log.js"),p=y("./message.js"),f=y("./terminus.js"),i=y("./endpoint.js"),h=function(M){this.window=M};h.prototype.update=function(M){var w=this.window-M.receiver.credit;w>=this.window/4&&M.receiver.flow(w)};function j(M){M.delivery.settled=!0}function C(M){M.delivery.update(void 0,p.accepted().described())}function l(M,w,r){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=M,this.condition=w,this.description=M,Object.defineProperty(this,"link",{value:r})}y("util").inherits(l,Error);var v=y("events").EventEmitter,k=Object.create(v.prototype);k.dispatch=function(M){return A.events("[%s] Link got event: %s",this.connection.options.id,M),v.prototype.emit.apply(this.observers,arguments),this.listeners(M).length?(v.prototype.emit.apply(this,arguments),!0):this.session.dispatch.apply(this.session,arguments)},k.set_source=function(M){this.local.attach.source=f.source(M).described()},k.set_target=function(M){this.local.attach.target=f.target(M).described()},k.attach=function(){this.state.open()&&this.connection._register()},k.open=k.attach,k.detach=function(){this.local.detach.closed=!1,this.state.close()&&this.connection._register()},k.close=function(M){M&&(this.local.detach.error=M),this.local.detach.closed=!0,this.state.close()&&this.connection._register()},k.remove=function(){this.session.remove_link(this)},k.is_open=function(){return this.session.is_open()&&this.state.is_open()},k.is_remote_open=function(){return this.session.is_remote_open()&&this.state.remote_open},k.is_itself_closed=function(){return this.state.is_closed()},k.is_closed=function(){return this.session.is_closed()||this.is_itself_closed()},k._process=function(){do this.state.need_open()&&this.session.output(this.local.attach),this.issue_flow&&this.state.local_open&&(this.session._write_flow(this),this.issue_flow=!1),this.state.need_close()&&this.session.output(this.local.detach);while(!this.state.has_settled())},k.on_attach=function(M){if(this.state.remote_opened())this.remote.handle||(this.remote.handle=M.handle),M.performative.source=f.unwrap(M.performative.source),M.performative.target=f.unwrap(M.performative.target),this.remote.attach=M.performative,this.open(),this.dispatch(this.is_receiver()?"receiver_open":"sender_open",this._context());else throw Error("Attach already received")},k.prefix_event=function(M){return(this.local.attach.role?"receiver_":"sender_")+M},k.on_detach=function(M){if(this.state.remote_closed()){this._incomplete&&(this._incomplete.settled=!0),this.remote.detach=M.performative;var w=this.remote.detach.error;if(w){var r=this.dispatch(this.prefix_event("error"),this._context());r=this.dispatch(this.prefix_event("close"),this._context())||r,r||v.prototype.emit.call(this.connection.container,"error",new l(w.description,w.condition,this))}else this.dispatch(this.prefix_event("close"),this._context());var a=this,S=this.state.mark();u.nextTick(function(){a.state.marker===S&&(a.close(),u.nextTick(function(){a.remove()}))})}else throw Error("Detach already received")};function O(M){switch(M){case"name":case"handle":case"role":case"initial_delivery_count":return!0;default:return!1}}var L=["snd_settle_mode","rcv_settle_mode","source","target","max_message_size","offered_capabilities","desired_capabilities","properties"];function P(M){return function(){return this.remote.attach?this.remote.attach[M]:void 0}}k.init=function(M,w,r,a,S){this.session=M,this.connection=M.connection,this.name=w,this.options=a===void 0?{}:a,this.state=new i,this.issue_flow=!1,this.local={handle:r},this.local.attach=_.attach({handle:r,name:w,role:S});for(var x in this.local.attach)!O(x)&&this.options[x]!==void 0&&(this.local.attach[x]=this.options[x]);this.local.detach=_.detach({handle:r,closed:!0}),this.remote={handle:void 0},this.delivery_count=0,this.credit=0,this.observers=new v;var N=this;L.forEach(function(W){Object.defineProperty(N,W,{get:P(W)})}),Object.defineProperty(this,"error",{get:function(){return this.remote.detach?this.remote.detach.error:void 0}})},k._disconnect=function(){this.state.disconnected(),this.state.was_open||this.remove()},k._reconnect=function(){this.state.reconnect(),this.remote={handle:void 0},this.delivery_count=0,this.credit=0},k.has_credit=function(){return this.credit>0},k.is_receiver=function(){return this.local.attach.role},k.is_sender=function(){return!this.is_receiver()},k._context=function(M){var w=M||{};return this.is_receiver()?w.receiver=this:w.sender=this,this.session._context(w)},k.get_option=function(M,w){return this.options[M]!==void 0?this.options[M]:this.session.get_option(M,w)};var E=function(M,w,r,a){this.init(M,w,r,a,!1),this._draining=!1,this._drained=!1,this.local.attach.initial_delivery_count=0,this.tag=0,this.get_option("autosettle",!0)&&this.observers.on("settled",j);var S=this;this.get_option("treat_modified_as_released",!0)&&this.observers.on("modified",function(x){S.dispatch("released",x)})};E.prototype=Object.create(k),E.prototype.constructor=E,E.prototype._get_drain=function(){if(this._draining&&this._drained&&this.credit){for(;this.credit;)++this.delivery_count,--this.credit;return!0}else return!1},E.prototype.set_drained=function(M){this._drained=M,this._draining&&this._drained&&(this.issue_flow=!0)},E.prototype.next_tag=function(){return c.from(new String(this.tag++))},E.prototype.sendable=function(){return!!(this.credit&&this.session.outgoing.available())},E.prototype.on_flow=function(M){var w=M.performative;this.credit=w.delivery_count+w.link_credit-this.delivery_count,this._draining=w.drain,this._drained=this.credit>0,this.is_open()&&(this.dispatch("sender_flow",this._context()),this._draining&&this.dispatch("sender_draining",this._context()),this.sendable()&&this.dispatch("sendable",this._context()))},E.prototype.on_transfer=function(){throw Error("got transfer on sending link")},E.prototype.send=function(M,w,r){var a=r===void 0?p.encode(M):M,S=this.session.send(this,w||this.next_tag(),a,r);return this.local.attach.snd_settle_mode===1&&(S.settled=!0),S};var U=function(M,w,r,a){this.init(M,w,r,a,!0),this.drain=!1,this.set_credit_window(this.get_option("credit_window",1e3)),this.get_option("autoaccept",!0)&&this.observers.on("message",C),this.local.attach.rcv_settle_mode===1&&this.get_option("autosettle",!0)&&this.observers.on("settled",j)};U.prototype=Object.create(k),U.prototype.constructor=U,U.prototype.on_flow=function(M){this.dispatch("receiver_flow",this._context()),M.performative.drain&&(this.credit=M.performative.link_credit,this.delivery_count=M.performative.delivery_count,M.performative.link_credit>0?console.error("ERROR: received flow with drain set, but non zero credit"):this.dispatch("receiver_drained",this._context()))},U.prototype.flow=function(M){M>0&&(this.credit+=M,this.issue_flow=!0,this.connection._register())},U.prototype.drain_credit=function(){this.drain=!0,this.issue_flow=!0,this.connection._register()},U.prototype.add_credit=U.prototype.flow,U.prototype._get_drain=function(){return this.drain},U.prototype.set_credit_window=function(M){if(M>0){var w=new h(M),r=w.update.bind(w);this.observers.on("message",r),this.observers.on("receiver_open",r)}},T.exports={Sender:E,Receiver:U}}).call(this)}).call(this,y("_process"),y("buffer").Buffer)},{"./endpoint.js":2,"./frames.js":6,"./log.js":8,"./message.js":9,"./terminus.js":12,_process:43,buffer:20,events:26,util:46}],8:[function(y,T,m){var u=y("debug");u.formatters&&(u.formatters.h=function(c){return c.toString("hex")}),T.exports={config:u("rhea:config"),frames:u("rhea:frames"),raw:u("rhea:raw"),reconnect:u("rhea:reconnect"),events:u("rhea:events"),message:u("rhea:message"),flow:u("rhea:flow"),io:u("rhea:io")}},{debug:23}],9:[function(y,T,m){var u=y("./log.js"),c=y("./types.js"),_={},A={},p=[],f={};function i(E,U,M){U.descriptor=E,A[E.symbolic]=U,A[Number(E.numeric).toString(10)]=U,M&&p.push(M)}function h(E){var U=c.define_composite(E);f[E.name]=U.create,_[Number(U.descriptor.numeric).toString(10)]=U,_[U.descriptor.symbolic]=U;var M=function(r,a){for(var S=new U(a.value),x=0;x<E.fields.length;x++){var N=E.fields[x],W=S[N.name];W!=null&&(r[N.name]=W)}},w=function(r,a){r.push(U.create(a).described())};i(U.descriptor,M,w)}function j(E,U){var M=U?c.wrap_symbolic_map:c.wrap_map,w={numeric:E.code};w.symbolic="amqp:"+E.name.replace(/_/g,"-")+":map";var r=function(S,x){S[E.name]=c.unwrap_map_simple(x)},a=function(S,x){x[E.name]&&S.push(c.described_nc(c.wrap_ulong(w.numeric),M(x[E.name])))};i(w,r,a)}function C(E,U,M){this.typecode=E,this.content=U,this.multiple=M}C.prototype.described=function(E){return c.described(c.wrap_ulong(this.typecode),c.wrap(E||this.content))},C.prototype.collect_sections=function(E){if(this.multiple)for(var U=0;U<this.content.length;U++)E.push(this.described(this.content[U]));else E.push(this.described())},h({name:"header",code:112,fields:[{name:"durable",type:"boolean",default_value:!1},{name:"priority",type:"ubyte",default_value:4},{name:"ttl",type:"uint"},{name:"first_acquirer",type:"boolean",default_value:!1},{name:"delivery_count",type:"uint",default_value:0}]}),j({name:"delivery_annotations",code:113},!0),j({name:"message_annotations",code:114},!0),h({name:"properties",code:115,fields:[{name:"message_id",type:"message_id"},{name:"user_id",type:"binary"},{name:"to",type:"string"},{name:"subject",type:"string"},{name:"reply_to",type:"string"},{name:"correlation_id",type:"message_id"},{name:"content_type",type:"symbol"},{name:"content_encoding",type:"symbol"},{name:"absolute_expiry_time",type:"timestamp"},{name:"creation_time",type:"timestamp"},{name:"group_id",type:"string"},{name:"group_sequence",type:"uint"},{name:"reply_to_group_id",type:"string"}]}),j({name:"application_properties",code:116});function l(E,U,M){E.body===void 0?E.body=new C(M,c.unwrap(U)):E.body.constructor===C&&E.body.typecode===M&&(E.body.multiple?E.body.content.push(c.unwrap(U)):(E.body.multiple=!0,E.body.content=[E.body.content,c.unwrap(U)]))}i({numeric:117,symbolic:"amqp:data:binary"},function(E,U){l(E,U,117)}),i({numeric:118,symbolic:"amqp:amqp-sequence:list"},function(E,U){l(E,U,118)}),i({numeric:119,symbolic:"amqp:value:*"},function(E,U){E.body=c.unwrap(U)}),j({name:"footer",code:120});function v(E,U){U.body&&U.body.collect_sections?U.body.collect_sections(E):E.push(c.described(c.wrap_ulong(119),c.wrap(U.body)))}p.push(v),f.data_section=function(E){return new C(117,E)},f.sequence_section=function(E){return new C(118,E)},f.data_sections=function(E){return new C(117,E,!0)},f.sequence_sections=function(E){return new C(118,E,!0)};function k(E,U){for(var M in E){var w=E[M];typeof w=="object"?k(w,U[M]):U[M]=w}}function O(E){E&&k(E,this)}O.prototype.toJSON=function(){var E={};for(var U in this)typeof this[U]!="function"&&(E[U]=this[U]);return E},O.prototype.toString=function(){return JSON.stringify(this.toJSON())},f.encode=function(E){var U=[];p.forEach(function(a){a(U,E)});for(var M=new c.Writer,w=0;w<U.length;w++)u.message("Encoding section %d of %d: %o",w+1,U.length,U[w]),M.write(U[w]);var r=M.toBuffer();return u.message("encoded %d bytes",r.length),r},f.decode=function(E){for(var U=new O,M=new c.Reader(E);M.remaining();){var w=M.read();if(u.message("decoding section: %o of type: %o",w,w.descriptor),w.descriptor){var r=A[w.descriptor.value];r?r(U,w):console.warn("WARNING: did not recognise message section with descriptor "+w.descriptor)}else console.warn("WARNING: expected described message section got "+JSON.stringify(w))}return U};var L={};function P(E){var U=c.define_composite(E);U.composite_type=E.name,f[E.name]=U.create,L[Number(U.descriptor.numeric).toString(10)]=U,L[U.descriptor.symbolic]=U,f["is_"+E.name]=function(M){if(M&&M.descriptor){var w=L[M.descriptor.value];if(w)return w.descriptor.numeric===E.code}return!1}}f.unwrap_outcome=function(E){if(E&&E.descriptor){var U=L[E.descriptor.value];if(U)return new U(E.value)}return console.error("unrecognised outcome: "+JSON.stringify(E)),E},f.are_outcomes_equivalent=function(E,U){return E===void 0&&U===void 0?!0:E===void 0||U===void 0?!1:E.descriptor.value===U.descriptor.value&&E.descriptor.value===36},P({name:"received",code:35,fields:[{name:"section_number",type:"uint",mandatory:!0},{name:"section_offset",type:"ulong",mandatory:!0}]}),P({name:"accepted",code:36,fields:[]}),P({name:"rejected",code:37,fields:[{name:"error",type:"error"}]}),P({name:"released",code:38,fields:[]}),P({name:"modified",code:39,fields:[{name:"delivery_failed",type:"boolean"},{name:"undeliverable_here",type:"boolean"},{name:"message_annotations",type:"map"}]}),T.exports=f},{"./log.js":8,"./types.js":14}],10:[function(y,T,m){var u=y("./errors.js"),c=y("./frames.js"),_=y("./transport.js"),A=y("./util.js"),p={OK:0,AUTH:1,SYS:2,SYS_PERM:3,SYS_TEMP:4},f=3;function i(w){for(var r=[],a=0,S=0;S<w.length;)w[S]===0?(S>a?r.push(w.toString("utf8",a,S)):r.push(null),a=++S):++S;return S>a?r.push(w.toString("utf8",a,S)):r.push(null),r}var h=function(w){this.callback=w,this.outcome=void 0,this.username=void 0};h.prototype.start=function(w,r){var a=i(w);if(a.length!==3)return Promise.reject("Unexpected response in PLAIN, got "+a.length+" fields, expected 3");var S=this;return Promise.resolve(this.callback(a[1],a[2],r)).then(function(x){x?(S.outcome=!0,S.username=a[1]):S.outcome=!1})};var j=function(w,r){this.username=w,this.password=r};j.prototype.start=function(w){var r=A.allocate_buffer(1+this.username.length+1+this.password.length);r.writeUInt8(0,0),r.write(this.username,1),r.writeUInt8(0,1+this.username.length),r.write(this.password,1+this.username.length+1),w(void 0,r)};var C=function(){this.outcome=void 0,this.username=void 0};C.prototype.start=function(w){this.outcome=!0,this.username=w?w.toString("utf8"):"anonymous"};var l=function(w){this.username=w||"anonymous"};l.prototype.start=function(w){var r=A.allocate_buffer(1+this.username.length);r.writeUInt8(0,0),r.write(this.username,1),w(void 0,r)};var v=function(){this.outcome=void 0,this.username=void 0};v.prototype.start=function(){this.outcome=!0};var k=function(){this.username=void 0};k.prototype.start=function(w){w(void 0,"")},k.prototype.step=function(w){w(void 0,"")};var O=function(w,r){this.username=w,this.token=r};O.prototype.start=function(w){var r=A.allocate_buffer(this.username.length+this.token.length+5+12+3),a=0;r.write("user=",a),a+=5,r.write(this.username,a),a+=this.username.length,r.writeUInt8(1,a),a+=1,r.write("auth=Bearer ",a),a+=12,r.write(this.token,a),a+=this.token.length,r.writeUInt8(1,a),a+=1,r.writeUInt8(1,a),a+=1,w(void 0,r)};var L=function(w,r){this.connection=w,this.transport=new _(w.amqp_transport.identifier,f,c.TYPE_SASL,this),this.next=w.amqp_transport,this.mechanisms=r,this.mechanism=void 0,this.outcome=void 0,this.username=void 0;var a=Object.getOwnPropertyNames(r);this.transport.encode(c.sasl_frame(c.sasl_mechanisms({sasl_server_mechanisms:a})))};L.prototype.do_step=function(w){if(this.mechanism.outcome===void 0)this.transport.encode(c.sasl_frame(c.sasl_challenge({challenge:w}))),this.connection.output();else{this.outcome=this.mechanism.outcome?p.OK:p.AUTH;var r=c.sasl_frame(c.sasl_outcome({code:this.outcome}));this.transport.encode(r),this.connection.output(),this.outcome===p.OK&&(this.username=this.mechanism.username,this.transport.write_complete=!0,this.transport.read_complete=!0)}},L.prototype.on_sasl_init=function(w){var r=this.mechanisms[w.performative.mechanism];r?(this.mechanism=r(),Promise.resolve(this.mechanism.start(w.performative.initial_response,w.performative.hostname)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))):(this.outcome=p.AUTH,this.transport.encode(c.sasl_frame(c.sasl_outcome({code:this.outcome}))))},L.prototype.on_sasl_response=function(w){Promise.resolve(this.mechanism.step(w.performative.response)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))},L.prototype.do_fail=function(w){var r=c.sasl_frame(c.sasl_outcome({code:p.SYS}));this.transport.encode(r),this.connection.output();try{this.connection.sasl_failed("Sasl callback promise failed with "+w,"amqp:internal-error")}catch(a){console.error("Uncaught error: ",a.message)}},L.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},L.prototype.write=function(w){return this.transport.write_complete&&this.transport.pending.length===0?this.next.write(w):this.transport.write(w)},L.prototype.read=function(w){return this.transport.read_complete?this.next.read(w):this.transport.read(w)};var P=function(w,r,a){this.connection=w,this.transport=new _(w.amqp_transport.identifier,f,c.TYPE_SASL,this),this.next=w.amqp_transport,this.mechanisms=r,this.mechanism=void 0,this.mechanism_name=void 0,this.hostname=a,this.failed=!1};P.prototype.on_sasl_mechanisms=function(w){var r=[];Array.isArray(w.performative.sasl_server_mechanisms)?r=w.performative.sasl_server_mechanisms:w.performative.sasl_server_mechanisms&&(r=[w.performative.sasl_server_mechanisms]);for(var a=0;this.mechanism===void 0&&a<r.length;a++){var S=r[a],x=this.mechanisms[S];x&&(this.mechanism=typeof x=="function"?x():x,this.mechanism_name=S)}if(this.mechanism){var N=this;this.mechanism.start(function(W,$){if(W)N.failed=!0,N.connection.sasl_failed("SASL mechanism init failed: "+W);else{var V={mechanism:N.mechanism_name,initial_response:$};N.hostname&&(V.hostname=N.hostname),N.transport.encode(c.sasl_frame(c.sasl_init(V))),N.connection.output()}})}else this.failed=!0,this.connection.sasl_failed("No suitable mechanism; server supports "+w.performative.sasl_server_mechanisms)},P.prototype.on_sasl_challenge=function(w){var r=this;this.mechanism.step(w.performative.challenge,function(a,S){a?(r.failed=!0,r.connection.sasl_failed("SASL mechanism challenge failed: "+a)):(r.transport.encode(c.sasl_frame(c.sasl_response({response:S}))),r.connection.output())})},P.prototype.on_sasl_outcome=function(w){switch(w.performative.code){case p.OK:this.transport.read_complete=!0,this.transport.write_complete=!0;break;case p.SYS:case p.SYS_PERM:case p.SYS_TEMP:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+w.performative.code,"amqp:internal-error");break;default:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+w.performative.code)}},P.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},P.prototype.write=function(w){return this.transport.write_complete?this.next.write(w):this.transport.write(w)},P.prototype.read=function(w){return this.transport.read_complete?this.next.read(w):this.transport.read(w)};var E=function(w,r){this.header_received=!1,this.transports={0:w.amqp_transport,3:new L(w,r)},this.selected=void 0};E.prototype.has_writes_pending=function(){return this.header_received&&this.selected.has_writes_pending()},E.prototype.write=function(w){return this.selected?this.selected.write(w):0},E.prototype.read=function(w){if(!this.header_received){if(w.length<8)return 0;if(this.header_received=c.read_header(w),this.selected=this.transports[this.header_received.protocol_id],this.selected===void 0)throw new u.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id)}return this.selected.read(w)};var U={enable_anonymous:function(){this.ANONYMOUS=function(){return new C}},enable_plain:function(w){this.PLAIN=function(){return new h(w)}}},M={enable_anonymous:function(w){this.ANONYMOUS=function(){return new l(w)}},enable_plain:function(w,r){this.PLAIN=function(){return new j(w,r)}},enable_external:function(){this.EXTERNAL=function(){return new k}},enable_xoauth2:function(w,r){if(w&&r)this.XOAUTH2=function(){return new O(w,r)};else{if(r===void 0)throw Error("token must be specified");if(w===void 0)throw Error("username must be specified")}}};T.exports={Client:P,Server:L,Selective:E,server_mechanisms:function(){return Object.create(U)},client_mechanisms:function(){return Object.create(M)},server_add_external:function(w){return w.EXTERNAL=function(){return new v},w}}},{"./errors.js":3,"./frames.js":6,"./transport.js":13,"./util.js":15}],11:[function(y,T,m){(function(u,c){(function(){var _=y("./frames.js"),A=y("./link.js"),p=y("./log.js"),f=y("./message.js"),i=y("./types.js"),h=y("./util.js"),j=y("./endpoint.js"),C=y("events").EventEmitter;function l(r,a,S){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=r,this.condition=a,this.description=r,Object.defineProperty(this,"session",{value:S})}y("util").inherits(l,Error);var v=function(r){this.capacity=r,this.size=0,this.head=0,this.tail=0,this.entries=[]};v.prototype.available=function(){return this.capacity-this.size},v.prototype.push=function(r){if(this.size<this.capacity)this.entries[this.tail]=r,this.tail=(this.tail+1)%this.capacity,this.size++;else throw Error("circular buffer overflow: head="+this.head+" tail="+this.tail+" size="+this.size+" capacity="+this.capacity)},v.prototype.pop_if=function(r){for(var a=0;this.size&&r(this.entries[this.head]);)this.entries[this.head]=void 0,this.head=(this.head+1)%this.capacity,this.size--,a++;return a},v.prototype.by_id=function(r){if(this.size>0){var a=r-this.entries[this.head].id;if(a<this.size)return this.entries[(this.head+a)%this.capacity]}},v.prototype.get_head=function(){return this.size>0?this.entries[this.head]:void 0},v.prototype.get_tail=function(){return this.size>0?this.entries[(this.head+this.size-1)%this.capacity]:void 0};function k(r){var a,S,x,N,W;for(N=0;N<r.length;N++)W=r[N],a===void 0&&(a=W,S=W,x=W.id),a!==S&&!f.are_outcomes_equivalent(S.state,W.state)||S.settled!==W.settled||x!==W.id?(a.link.session.output(_.disposition({role:a.link.is_receiver(),first:a.id,last:S.id,state:a.state,settled:a.settled})),a=W,S=W,x=W.id):(S.id!==W.id&&(S=W),x++);a!==void 0&&S!==void 0&&a.link.session.output(_.disposition({role:a.link.is_receiver(),first:a.id,last:S.id,state:a.state,settled:a.settled}))}var O=function(r){this.deliveries=new v(2048),this.updated=[],this.pending_dispositions=[],this.next_delivery_id=0,this.next_pending_delivery=0,this.next_transfer_id=0,this.window=i.MAX_UINT,this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.connection=r};O.prototype.available=function(){return this.deliveries.available()},O.prototype.compute_max_payload=function(r){if(this.connection.max_frame_size)return this.connection.max_frame_size-(50+r.length)},O.prototype.send=function(r,a,S,x){var N=[],W=this.compute_max_payload(a);if(W&&S.length>W)for(var $=0;$<S.length;){var V=Math.min($+W,S.length);N.push(S.slice($,V)),$=V}else N.push(S);var H={id:this.next_delivery_id++,tag:a,link:r,data:N,format:x||0,sent:!1,settled:!1,state:void 0,remote_settled:!1,remote_state:void 0},q=this;return H.update=function(G,oe){q.update(H,G,oe)},this.deliveries.push(H),H},O.prototype.on_begin=function(r){this.remote_window=r.incoming_window},O.prototype.on_flow=function(r){this.remote_next_transfer_id=r.next_incoming_id,this.remote_window=r.incoming_window},O.prototype.on_disposition=function(r){for(var a=r.last?r.last:r.first,S=r.first;S<=a;S++){var x=this.deliveries.by_id(S);if(x&&!x.remote_settled){var N=!1;r.settled&&(x.remote_settled=r.settled,N=!0),r.state&&r.state!==x.remote_state&&(x.remote_state=f.unwrap_outcome(r.state),N=!0),N&&this.updated.push(x)}}},O.prototype.update=function(r,a,S){r&&(r.settled=a,S!==void 0&&(r.state=S),r.remote_settled||this.pending_dispositions.push(r),r.link.connection._register())},O.prototype.transfer_window=function(){return this.remote_window?this.remote_window-(this.next_transfer_id-this.remote_next_transfer_id):0},O.prototype.process=function(){for(var r;this.next_pending_delivery<this.next_delivery_id;)if(r=this.deliveries.by_id(this.next_pending_delivery),r)if(r.link.has_credit())if(this.transfer_window()>=r.data.length){this.window-=r.data.length;for(var a=0;a<r.data.length;a++){this.next_transfer_id++;var S=a+1<r.data.length,x=_.transfer({handle:r.link.local.handle,message_format:r.format,delivery_id:r.id,delivery_tag:r.tag,settled:r.settled,more:S});r.link.session.output(x,r.data[a]),r.settled&&(r.remote_settled=!0)}r.link.credit--,r.link.delivery_count++,this.next_pending_delivery++}else{p.flow("[%s] Incoming window of peer preventing sending further transfers: remote_window=%d, remote_next_transfer_id=%d, next_transfer_id=%d",this.connection.options.id,this.remote_window,this.remote_next_transfer_id,this.next_transfer_id);break}else{p.flow("[%s] Link has no credit",this.connection.options.id);break}else{console.error("ERROR: Next pending delivery not found: "+this.next_pending_delivery);break}for(var a=0;a<this.updated.length;a++)r=this.updated[a],r.remote_state&&r.remote_state.constructor.composite_type&&r.link.dispatch(r.remote_state.constructor.composite_type,r.link._context({delivery:r})),r.remote_settled&&r.link.dispatch("settled",r.link._context({delivery:r}));this.updated=[],this.pending_dispositions.length&&(k(this.pending_dispositions),this.pending_dispositions=[]),this.deliveries.pop_if(function(N){return N.settled&&N.remote_settled})};var L=function(){this.deliveries=new v(2048),this.updated=[],this.next_transfer_id=0,this.next_delivery_id=void 0,Object.defineProperty(this,"window",{get:function(){return this.deliveries.available()}}),this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.max_transfer_id=this.next_transfer_id+this.window};L.prototype.update=function(r,a,S){r&&(r.settled=a,S!==void 0&&(r.state=S),r.remote_settled||this.updated.push(r),r.link.connection._register())},L.prototype.on_transfer=function(r,a){if(this.next_transfer_id++,a.is_remote_open()){this.next_delivery_id===void 0&&(this.next_delivery_id=r.performative.delivery_id);var S,x;if(a._incomplete){if(S=a._incomplete,h.is_defined(r.performative.delivery_id)&&S.id!==r.performative.delivery_id)throw Error("frame sequence error: delivery "+S.id+" not complete, got "+r.performative.delivery_id);r.payload?x=c.concat([S.data,r.payload],S.data.length+r.payload.length):x=S.data}else if(this.next_delivery_id===r.performative.delivery_id){S={id:r.performative.delivery_id,tag:r.performative.delivery_tag,format:r.performative.message_format,link:a,settled:!1,state:void 0,remote_settled:r.performative.settled===void 0?!1:r.performative.settled,remote_state:r.performative.state};var N=this;S.update=function($,V){var H=$;H===void 0&&(H=a.local.attach.rcv_settle_mode!==1),N.update(S,H,V)},S.accept=function(){this.update(void 0,f.accepted().described())},S.release=function($){$?this.update(void 0,f.modified($).described()):this.update(void 0,f.released().described())},S.reject=function($){this.update(void 0,f.rejected({error:$}).described())},S.modified=function($){this.update(void 0,f.modified($).described())},this.deliveries.push(S),this.next_delivery_id++,x=r.payload}else throw Error("frame sequence error: expected "+this.next_delivery_id+", got "+r.performative.delivery_id);if(S.incomplete=r.performative.more,S.incomplete)a._incomplete=S,S.data=x;else{a._incomplete=void 0,a.credit>0?a.credit--:console.error("Received transfer when credit was %d",a.credit),a.delivery_count++;var W=S.format===0?{message:f.decode(x),delivery:S}:{message:x,delivery:S,format:S.format};a.dispatch("message",a._context(W))}}else throw Error("transfer after detach")},L.prototype.process=function(r){this.updated.length>0&&(k(this.updated),this.updated=[]),this.deliveries.pop_if(function(a){return a.settled}),this.max_transfer_id-this.next_transfer_id<this.window/2&&r._write_flow()},L.prototype.on_begin=function(r){this.remote_window=r.outgoing_window,this.remote_next_transfer_id=r.next_outgoing_id},L.prototype.on_flow=function(r){this.remote_next_transfer_id=r.next_outgoing_id,this.remote_window=r.outgoing_window},L.prototype.on_disposition=function(r){for(var a=r.last?r.last:r.first,S=r.first;S<=a;S++){var x=this.deliveries.by_id(S);x&&!x.remote_settled&&(r.state&&r.state!==x.remote_state&&(x.remote_state=f.unwrap_outcome(r.state)),r.settled&&(x.remote_settled=r.settled,x.link.dispatch("settled",x.link._context({delivery:x}))))}};var P=function(r,a){this.connection=r,this.outgoing=new O(r),this.incoming=new L,this.state=new j,this.local={channel:a,handles:{}},this.local.begin=_.begin({next_outgoing_id:this.outgoing.next_transfer_id,incoming_window:this.incoming.window,outgoing_window:this.outgoing.window}),this.local.end=_.end(),this.remote={handles:{}},this.links={},this.options={},Object.defineProperty(this,"error",{get:function(){return this.remote.end?this.remote.end.error:void 0}}),this.observers=new C};P.prototype=Object.create(C.prototype),P.prototype.constructor=P,P.prototype._disconnect=function(){this.state.disconnected();for(var r in this.links)this.links[r]._disconnect();this.state.was_open||this.remove()},P.prototype._reconnect=function(){this.state.reconnect(),this.outgoing=new O(this.connection),this.incoming=new L,this.remote={handles:{}};for(var r in this.links)this.links[r]._reconnect()},P.prototype.dispatch=function(r){return p.events("[%s] Session got event: %s",this.connection.options.id,r),C.prototype.emit.apply(this.observers,arguments),this.listeners(r).length?(C.prototype.emit.apply(this,arguments),!0):this.connection.dispatch.apply(this.connection,arguments)},P.prototype.output=function(r,a){this.connection._write_frame(this.local.channel,r,a)},P.prototype.create_sender=function(r,a){return a||(a=this.get_option("sender_options",{})),this.create_link(r,A.Sender,a)},P.prototype.create_receiver=function(r,a){return a||(a=this.get_option("receiver_options",{})),this.create_link(r,A.Receiver,a)};function E(r,a){for(var S in a)S==="properties"&&r.properties?E(r.properties,a.properties):r[S]=a[S]}function U(r,a,S,x){var N=Object.create(x||{});typeof a=="string"?N[S]=a:a&&E(N,a),N.name||(N.name=h.generate_uuid());var W=r(N.name,N);for(var $ in{source:0,target:0})N[$]&&(typeof N[$]=="string"&&(N[$]={address:N[$]}),W["set_"+$](N[$]));return W.is_sender()&&N.source===void 0&&(N.source=W.set_source({})),W.is_receiver()&&N.target===void 0&&(N.target=W.set_target({})),W.attach(),W}P.prototype.get_option=function(r,a){return this.options[r]!==void 0?this.options[r]:this.connection.get_option(r,a)},P.prototype.attach_sender=function(r){return U(this.create_sender.bind(this),r,"target",this.get_option("sender_options",{}))},P.prototype.open_sender=P.prototype.attach_sender,P.prototype.attach_receiver=function(r){return U(this.create_receiver.bind(this),r,"source",this.get_option("receiver_options",{}))},P.prototype.open_receiver=P.prototype.attach_receiver,P.prototype.find_sender=function(r){return this.find_link(h.sender_filter(r))},P.prototype.find_receiver=function(r){return this.find_link(h.receiver_filter(r))},P.prototype.find_link=function(r){for(var a in this.links){var S=this.links[a];if(r(S))return S}},P.prototype.each_receiver=function(r,a){this.each_link(r,h.receiver_filter(a))},P.prototype.each_sender=function(r,a){this.each_link(r,h.sender_filter(a))},P.prototype.each_link=function(r,a){for(var S in this.links){var x=this.links[S];(a===void 0||a(x))&&r(x)}},P.prototype.create_link=function(r,a,S){for(var x=0;this.local.handles[x];)x++;var N=new a(this,r,x,S);return this.links[r]=N,this.local.handles[x]=N,N},P.prototype.begin=function(){this.state.open()&&this.connection._register()},P.prototype.open=P.prototype.begin,P.prototype.end=function(r){r&&(this.local.end.error=r),this.state.close()&&this.connection._register()},P.prototype.close=P.prototype.end,P.prototype.is_open=function(){return this.connection.is_open()&&this.state.is_open()},P.prototype.is_remote_open=function(){return this.connection.is_remote_open()&&this.state.remote_open},P.prototype.is_itself_closed=function(){return this.state.is_closed()},P.prototype.is_closed=function(){return this.connection.is_closed()||this.is_itself_closed()};function M(r){r.dispatch("sendable",r._context())}function w(r){return r.is_open()&&r.sendable()}P.prototype._process=function(){do{this.state.need_open()&&this.output(this.local.begin);var r=this.outgoing.deliveries.available()===0;this.outgoing.process(),r&&this.outgoing.deliveries.available()&&this.each_sender(M,w),this.incoming.process(this);for(var a in this.links)this.links[a]._process();this.state.need_close()&&this.output(this.local.end)}while(!this.state.has_settled())},P.prototype.send=function(r,a,S,x){var N=this.outgoing.send(r,a,S,x);return this.connection._register(),N},P.prototype._write_flow=function(r){var a={next_incoming_id:this.incoming.next_transfer_id,incoming_window:this.incoming.window,next_outgoing_id:this.outgoing.next_transfer_id,outgoing_window:this.outgoing.window};this.incoming.max_transfer_id=a.next_incoming_id+a.incoming_window,r&&(r._get_drain()&&(a.drain=!0),a.delivery_count=r.delivery_count,a.handle=r.local.handle,a.link_credit=r.credit),this.output(_.flow(a))},P.prototype.on_begin=function(r){if(this.state.remote_opened())this.remote.channel||(this.remote.channel=r.channel),this.remote.begin=r.performative,this.outgoing.on_begin(r.performative),this.incoming.on_begin(r.performative),this.open(),this.dispatch("session_open",this._context());else throw Error("Begin already received")},P.prototype.on_end=function(r){if(this.state.remote_closed()){this.remote.end=r.performative;var a=this.remote.end.error;if(a){var S=this.dispatch("session_error",this._context());S=this.dispatch("session_close",this._context())||S,S||C.prototype.emit.call(this.connection.container,"error",new l(a.description,a.condition,this))}else this.dispatch("session_close",this._context());var x=this,N=this.state.mark();u.nextTick(function(){x.state.marker===N&&(x.close(),u.nextTick(function(){x.remove()}))})}else throw Error("End already received")},P.prototype.on_attach=function(r){var a=r.performative.name,S=this.links[a];S||(S=r.performative.role?this.create_sender(a):this.create_receiver(a)),this.remote.handles[r.performative.handle]=S,S.on_attach(r),S.remote.attach=r.performative},P.prototype.on_disposition=function(r){r.performative.role?(p.events("[%s] Received disposition for outgoing transfers",this.connection.options.id),this.outgoing.on_disposition(r.performative)):(p.events("[%s] Received disposition for incoming transfers",this.connection.options.id),this.incoming.on_disposition(r.performative)),this.connection._register()},P.prototype.on_flow=function(r){this.outgoing.on_flow(r.performative),this.incoming.on_flow(r.performative),h.is_defined(r.performative.handle)&&this._get_link(r).on_flow(r),this.connection._register()},P.prototype._context=function(r){var a=r||{};return a.session=this,this.connection._context(a)},P.prototype._get_link=function(r){var a=r.performative.handle,S=this.remote.handles[a];if(!S)throw Error("Invalid handle "+a);return S},P.prototype.on_detach=function(r){this._get_link(r).on_detach(r)},P.prototype.remove_link=function(r){delete this.remote.handles[r.remote.handle],delete this.local.handles[r.local.handle],delete this.links[r.name]},P.prototype.remove=function(){this.connection.remove_session(this)},P.prototype.on_transfer=function(r){this.incoming.on_transfer(r,this._get_link(r))},T.exports=P}).call(this)}).call(this,y("_process"),y("buffer").Buffer)},{"./endpoint.js":2,"./frames.js":6,"./link.js":7,"./log.js":8,"./message.js":9,"./types.js":14,"./util.js":15,_process:43,buffer:20,events:26,util:46}],12:[function(y,T,m){var u=y("./types.js"),c={},_={};function A(p){var f=u.define_composite(p);c[p.name]=f.create,_[Number(f.descriptor.numeric).toString(10)]=f,_[f.descriptor.symbolic]=f}c.unwrap=function(p){if(p&&p.descriptor){var f=_[p.descriptor.value];if(f)return new f(p.value);console.warn("Unknown terminus: "+p.descriptor)}return null},A({name:"source",code:40,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"distribution_mode",type:"symbol"},{name:"filter",type:"symbolic_map"},{name:"default_outcome",type:"*"},{name:"outcomes",type:"symbol",multiple:!0},{name:"capabilities",type:"symbol",multiple:!0}]}),A({name:"target",code:41,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"capabilities",type:"symbol",multiple:!0}]}),T.exports=c},{"./types.js":14}],13:[function(y,T,m){var u=y("./errors.js"),c=y("./frames.js"),_=y("./log.js"),A=y("./util.js"),p=function(f,i,h,j){this.identifier=f,this.protocol_id=i,this.frame_type=h,this.handler=j,this.pending=[],this.header_sent=void 0,this.header_received=void 0,this.write_complete=!1,this.read_complete=!1};p.prototype.has_writes_pending=function(){return this.pending.length>0||!this.header_sent},p.prototype.encode=function(f){this.pending.push(f)},p.prototype.write=function(f){if(!this.header_sent){var i=A.allocate_buffer(8),h={protocol_id:this.protocol_id,major:1,minor:0,revision:0};_.frames("[%s] -> %o",this.identifier,h),c.write_header(i,h),f.write(i),this.header_sent=h}for(var j=0;j<this.pending.length;j++){var C=this.pending[j],i=c.write_frame(C);f.write(i),C.performative?_.frames("[%s]:%s -> %s %j",this.identifier,C.channel,C.performative.constructor,C.performative,C.payload||""):_.frames("[%s]:%s -> empty",this.identifier,C.channel),_.raw("[%s] SENT: %d %h",this.identifier,i.length,i)}this.pending=[]},p.prototype.read=function(f){var i=0;if(!this.header_received){if(f.length<8)return i;if(this.header_received=c.read_header(f),_.frames("[%s] <- %o",this.identifier,this.header_received),this.header_received.protocol_id!==this.protocol_id)throw this.protocol_id===3&&this.header_received.protocol_id===0?new u.ProtocolError("Expecting SASL layer"):this.protocol_id===0&&this.header_received.protocol_id===3?new u.ProtocolError("SASL layer not enabled"):new u.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id+" expecting: "+this.protocol_id);i=8}for(;i<f.length-4&&!this.read_complete;){var h=f.readUInt32BE(i);if(_.io("[%s] got frame of size %d",this.identifier,h),f.length<i+h){_.io("[%s] incomplete frame; have only %d of %d",this.identifier,f.length-i,h);break}else{var j=f.slice(i,i+h);_.raw("[%s] RECV: %d %h",this.identifier,j.length,j);var C=c.read_frame(j);if(C.performative?_.frames("[%s]:%s <- %s %j",this.identifier,C.channel,C.performative.constructor,C.performative,C.payload||""):_.frames("[%s]:%s <- empty",this.identifier,C.channel),C.type!==this.frame_type)throw new u.ProtocolError("Invalid frame type: "+C.type);i+=h,C.performative&&C.performative.dispatch(this.handler,C)}}return i},T.exports=p},{"./errors.js":3,"./frames.js":6,"./log.js":8,"./util.js":15}],14:[function(y,T,m){(function(u){(function(){var c=y("./errors.js"),_=y("./util.js"),A=1,p=2,f=3,i=4;function h(e,o,b,z){this.type=e,this.value=o,b&&(this.array_constructor={typecode:b},z&&(this.array_constructor.descriptor=z))}h.prototype.toString=function(){return this.value?this.value.toString():null},h.prototype.toLocaleString=function(){return this.value?this.value.toLocaleString():null},h.prototype.valueOf=function(){return this.value},h.prototype.toJSON=function(){return this.value&&this.value.toJSON?this.value.toJSON():this.value},h.prototype.toRheaTyped=function(){return this};function j(e,o,b,z){this.name=e,this.typecode=o;var J=o>>>4;switch(J){case 4:this.width=0,this.category=A;break;case 5:this.width=1,this.category=A;break;case 6:this.width=2,this.category=A;break;case 7:this.width=4,this.category=A;break;case 8:this.width=8,this.category=A;break;case 9:this.width=16,this.category=A;break;case 10:this.width=1,this.category=p;break;case 11:this.width=4,this.category=p;break;case 12:this.width=1,this.category=f;break;case 13:this.width=4,this.category=f;break;case 14:this.width=1,this.category=i;break;case 15:this.width=4,this.category=i;break}b&&(b.read&&(this.read=b.read),b.write&&(this.write=b.write),b.encoding&&(this.encoding=b.encoding));var X=this;J===4?this.create=function(){return new h(X,z)}:J===14||J===15?this.create=function(K,Z,ee){return new h(X,K,Z,ee)}:this.create=function(K){return new h(X,K)}}j.prototype.toString=function(){return this.name+"#"+C(this.typecode)};function C(e){return Number(e).toString(16)}var l={by_code:{}};Object.defineProperty(l,"MAX_UINT",{value:4294967295,writable:!1,configurable:!1}),Object.defineProperty(l,"MAX_USHORT",{value:65535,writable:!1,configurable:!1});function v(e,o,b,z){var J=new j(e,o,b,z);J.create.typecode=J.typecode,l.by_code[J.typecode]=J,l[e]=J.create}function k(){return{read:function(e,o){return e.readUInt8(o)},write:function(e,o,b){e.writeUInt8(o,b)}}}function O(){return{read:function(e,o){return e.readUInt16BE(o)},write:function(e,o,b){e.writeUInt16BE(o,b)}}}function L(){return{read:function(e,o){return e.readUInt32BE(o)},write:function(e,o,b){e.writeUInt32BE(o,b)}}}function P(){return{read:function(e,o){return e.readInt8(o)},write:function(e,o,b){e.writeInt8(o,b)}}}function E(){return{read:function(e,o){return e.readInt16BE(o)},write:function(e,o,b){e.writeInt16BE(o,b)}}}function U(){return{read:function(e,o){return e.readInt32BE(o)},write:function(e,o,b){e.writeInt32BE(o,b)}}}function M(){return{read:function(e,o){return e.readFloatBE(o)},write:function(e,o,b){e.writeFloatBE(o,b)}}}function w(){return{read:function(e,o){return e.readDoubleBE(o)},write:function(e,o,b){e.writeDoubleBE(o,b)}}}var r=4294967296,a=-2147483647;function S(e,o,b){if(typeof o=="number"||o instanceof Number){var z=Math.floor(o/r),J=o%r;e.writeUInt32BE(z,b),e.writeUInt32BE(J,b+4)}else o.copy(e,b)}function x(e,o){var b=e.readUInt32BE(o),z=e.readUInt32BE(o+4);return b<2097153?b*r+z:e.slice(o,o+8)}function N(e,o,b){if(typeof o=="number"||o instanceof Number){var z=Math.abs(o),J=Math.floor(z/r),X=z%r;if(e.writeInt32BE(J,b),e.writeUInt32BE(X,b+4),o<0)for(var K=1,Z=0;Z<8;Z++){var ee=b+(7-Z),ce=(e[ee]^255)+K;e[ee]=ce&255,K=ce>>8}}else o.copy(e,b)}function W(e,o,b){return typeof o=="object"&&o!==null&&typeof o.getTime=="function"&&(o=o.getTime()),N(e,o,b)}function $(e,o){var b=e.readInt32BE(o),z=e.readUInt32BE(o+4);return b<2097153&&b>-2097153?b*r+z:e.slice(o,o+8)}function V(e,o){const b=$(e,o);return new Date(b)}v("Null",64,void 0,null),v("Boolean",86,k()),v("True",65,void 0,!0),v("False",66,void 0,!1),v("Ubyte",80,k()),v("Ushort",96,O()),v("Uint",112,L()),v("SmallUint",82,k()),v("Uint0",67,void 0,0),v("Ulong",128,{write:S,read:x}),v("SmallUlong",83,k()),v("Ulong0",68,void 0,0),v("Byte",81,P()),v("Short",97,E()),v("Int",113,U()),v("SmallInt",84,P()),v("Long",129,{write:N,read:$}),v("SmallLong",85,P()),v("Float",114,M()),v("Double",130,w()),v("Decimal32",116),v("Decimal64",132),v("Decimal128",148),v("CharUTF32",115,L()),v("Timestamp",131,{write:W,read:V}),v("Uuid",152),v("Vbin8",160),v("Vbin32",176),v("Str8",161,{encoding:"utf8"}),v("Str32",177,{encoding:"utf8"}),v("Sym8",163,{encoding:"ascii"}),v("Sym32",179,{encoding:"ascii"}),v("List0",69,void 0,[]),v("List8",192),v("List32",208),v("Map8",193),v("Map32",209),v("Array8",224),v("Array32",240);function H(e,o){for(var b=0;b<o.length;b++)if(e.type.typecode===o[b].typecode)return!0;return!1}function q(e,o,b){for(var z=0;z<o&&z<e.length;z++)if(e[z]!==(b?255:0))return!1;return!0}l.is_ulong=function(e){return H(e,[l.Ulong,l.Ulong0,l.SmallUlong])},l.is_string=function(e){return H(e,[l.Str8,l.Str32])},l.is_symbol=function(e){return H(e,[l.Sym8,l.Sym32])},l.is_list=function(e){return H(e,[l.List0,l.List8,l.List32])},l.is_map=function(e){return H(e,[l.Map8,l.Map32])},l.wrap_boolean=function(e){return e?l.True():l.False()},l.wrap_ulong=function(e){return u.isBuffer(e)?q(e,8,!1)?l.Ulong0():q(e,7,!1)?l.SmallUlong(e[7]):l.Ulong(e):e===0?l.Ulong0():e>255?l.Ulong(e):l.SmallUlong(e)},l.wrap_uint=function(e){return e===0?l.Uint0():e>255?l.Uint(e):l.SmallUint(e)},l.wrap_ushort=function(e){return l.Ushort(e)},l.wrap_ubyte=function(e){return l.Ubyte(e)},l.wrap_long=function(e){if(u.isBuffer(e)){var o=(e[0]&128)!==0;return q(e,7,o)&&(e[7]&128)===(o?128:0)?l.SmallLong(o?-((e[7]^255)+1):e[7]):l.Long(e)}else return e>127||e<-128?l.Long(e):l.SmallLong(e)},l.wrap_int=function(e){return e>127||e<-128?l.Int(e):l.SmallInt(e)},l.wrap_short=function(e){return l.Short(e)},l.wrap_byte=function(e){return l.Byte(e)},l.wrap_float=function(e){return l.Float(e)},l.wrap_double=function(e){return l.Double(e)},l.wrap_timestamp=function(e){return l.Timestamp(e)},l.wrap_char=function(e){return l.CharUTF32(e)},l.wrap_uuid=function(e){return l.Uuid(e)},l.wrap_binary=function(e){return e.length>255?l.Vbin32(e):l.Vbin8(e)},l.wrap_string=function(e){return u.byteLength(e)>255?l.Str32(e):l.Str8(e)},l.wrap_symbol=function(e){return u.byteLength(e)>255?l.Sym32(e):l.Sym8(e)},l.wrap_list=function(e){if(e.length===0)return l.List0();var o=e.map(l.wrap);return l.List32(o)},l.wrap_set_as_list=function(e){if(e.size===0)return l.List0();var o=Array.from(e,l.wrap);return l.List32(o)},l.wrap_map=function(e,o){var b=[];for(var z in e)b.push(o?o(z):l.wrap(z)),b.push(l.wrap(e[z]));return l.Map32(b)},l.wrap_map_as_map=function(e){var o=[];for(var[b,z]of e)o.push(l.wrap(b)),o.push(l.wrap(z));return l.Map32(o)},l.wrap_symbolic_map=function(e){return l.wrap_map(e,l.wrap_symbol)},l.wrap_array=function(e,o,b){if(o)return l.Array32(e,o,b);throw console.trace("An array must specify a type for its elements"),new c.TypeError("An array must specify a type for its elements")},l.wrap=function(e){var o=typeof e;return o==="object"&&e!==null&&typeof e.toRheaTyped=="function"?e.toRheaTyped():o==="string"?l.wrap_string(e):o==="boolean"?e?l.True():l.False():o==="number"||e instanceof Number?isNaN(e)?l.Null():Math.floor(e)-e!==0?l.Double(e):e>0?e<r?l.wrap_uint(e):l.wrap_ulong(e):e>a?l.wrap_int(e):l.wrap_long(e):e instanceof Date?l.wrap_timestamp(e.getTime()):e instanceof u||e instanceof Uint8Array?l.wrap_binary(e):o==="undefined"||e===null?l.Null():Array.isArray(e)?l.wrap_list(e):e instanceof Map?l.wrap_map_as_map(e):e instanceof Set?l.wrap_set_as_list(e):l.wrap_map(e)},l.wrap_described=function(e,o){var b=l.wrap(e);return o&&(typeof o=="string"?b=l.described(l.wrap_symbol(o),b):(typeof o=="number"||o instanceof Number)&&(b=l.described(l.wrap_ulong(o),b))),b},l.wrap_message_id=function(e){var o=typeof e;if(o==="string")return l.wrap_string(e);if(o==="number"||e instanceof Number)return l.wrap_ulong(e);if(u.isBuffer(e))return l.wrap_uuid(e);throw new c.TypeError("invalid message id:"+e)};function G(e){for(var o={},b=0;b+1<e.length;)o[e[b++]]=e[b++];return o}var oe={};l.unwrap_map_simple=function(e){return G(e.value.map(function(o){return l.unwrap(o,!0)}))},l.unwrap=function(e,o){if(e instanceof h){if(e.descriptor){var b=oe[e.descriptor.value];if(b)return new b(e.value);if(o)return e}var z=l.unwrap(e.value,!0);return l.is_map(e)?G(z):z}else return Array.isArray(e)?e.map(function(J){return l.unwrap(J,!0)}):e},l.described_nc=function(e,o){return e.length?(o.descriptor=e.shift(),l.described(e,o)):(o.descriptor=e,o)},l.described=l.described_nc;function ne(e){var o=l.by_code[e];if(!o)throw new c.TypeError("Unrecognised typecode: "+C(e));return o}l.Reader=function(e){this.buffer=e,this.position=0},l.Reader.prototype.read_typecode=function(){return this.read_uint(1)},l.Reader.prototype.read_uint=function(e){var o=this.position;if(this.position+=e,e===1)return this.buffer.readUInt8(o);if(e===2)return this.buffer.readUInt16BE(o);if(e===4)return this.buffer.readUInt32BE(o);throw new c.TypeError("Unexpected width for uint "+e)},l.Reader.prototype.read_fixed_width=function(e){var o=this.position;return this.position+=e.width,e.read?e.read(this.buffer,o):this.buffer.slice(o,this.position)},l.Reader.prototype.read_variable_width=function(e){var o=this.read_uint(e.width),b=this.read_bytes(o);return e.encoding?b.toString(e.encoding):b},l.Reader.prototype.read=function(){var e=this.read_constructor(),o=this.read_value(ne(e.typecode));return e.descriptor?l.described_nc(e.descriptor,o):o},l.Reader.prototype.read_constructor=function(e){var o=this.read_typecode();return o===0?(e===void 0&&(e=[]),e.push(this.read()),this.read_constructor(e)):e===void 0?{typecode:o}:e.length===1?{typecode:o,descriptor:e[0]}:{typecode:o,descriptor:e[0],descriptors:e}},l.Reader.prototype.read_value=function(e){if(e.width===0)return e.create();if(e.category===A)return e.create(this.read_fixed_width(e));if(e.category===p)return e.create(this.read_variable_width(e));if(e.category===f)return this.read_compound(e);if(e.category===i)return this.read_array(e);throw new c.TypeError("Invalid category for type: "+e)},l.Reader.prototype.read_array_items=function(e,o){for(var b=[];b.length<e;)b.push(this.read_value(o));return b},l.Reader.prototype.read_n=function(e){for(var o=new Array(e),b=0;b<e;b++)o[b]=this.read();return o},l.Reader.prototype.read_size_count=function(e){return{size:this.read_uint(e),count:this.read_uint(e)}},l.Reader.prototype.read_compound=function(e){var o=this.read_size_count(e.width);return e.create(this.read_n(o.count))},l.Reader.prototype.read_array=function(e){var o=this.read_size_count(e.width),b=this.read_constructor();return e.create(this.read_array_items(o.count,ne(b.typecode)),b.typecode,b.descriptor)},l.Reader.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var o=this.position;o<this.buffer.length;o++)o>0&&(e+=","),e+="0x"+Number(this.buffer[o]).toString(16);return e},l.Reader.prototype.reset=function(){this.position=0},l.Reader.prototype.skip=function(e){this.position+=e},l.Reader.prototype.read_bytes=function(e){var o=this.position;return this.position+=e,this.buffer.slice(o,this.position)},l.Reader.prototype.remaining=function(){return this.buffer.length-this.position},l.Writer=function(e){this.buffer=e||_.allocate_buffer(1024),this.position=0},l.Writer.prototype.toBuffer=function(){return this.buffer.slice(0,this.position)};function le(e,o){return e>o?e:o}l.Writer.prototype.ensure=function(e){if(this.buffer.length<e){var o=_.allocate_buffer(le(this.buffer.length*2,e));this.buffer.copy(o),this.buffer=o}},l.Writer.prototype.write_typecode=function(e){this.write_uint(e,1)},l.Writer.prototype.write_uint=function(e,o){var b=this.position;if(this.ensure(this.position+o),this.position+=o,o===1)return this.buffer.writeUInt8(e,b);if(o===2)return this.buffer.writeUInt16BE(e,b);if(o===4)return this.buffer.writeUInt32BE(e,b);throw new c.TypeError("Unexpected width for uint "+o)},l.Writer.prototype.write_fixed_width=function(e,o){var b=this.position;if(this.ensure(this.position+e.width),this.position+=e.width,e.write)e.write(this.buffer,o,b);else if(o.copy)o.copy(this.buffer,b);else throw new c.TypeError("Cannot handle write for "+e)},l.Writer.prototype.write_variable_width=function(e,o){var b=e.encoding?u.from(o,e.encoding):u.from(o);this.write_uint(b.length,e.width),this.write_bytes(b)},l.Writer.prototype.write_bytes=function(e){var o=this.position;this.ensure(this.position+e.length),this.position+=e.length,e.copy(this.buffer,o)},l.Writer.prototype.write_constructor=function(e,o){o&&(this.write_typecode(0),this.write(o)),this.write_typecode(e)},l.Writer.prototype.write=function(e){if(e.type===void 0)if(e.described)this.write(e.described());else throw new c.TypeError("Cannot write "+JSON.stringify(e));else this.write_constructor(e.type.typecode,e.descriptor),this.write_value(e.type,e.value,e.array_constructor)},l.Writer.prototype.write_value=function(e,o,b){if(e.width!==0)if(e.category===A)this.write_fixed_width(e,o);else if(e.category===p)this.write_variable_width(e,o);else if(e.category===f)this.write_compound(e,o);else if(e.category===i)this.write_array(e,o,b);else throw new c.TypeError("Invalid category "+e.category+" for type: "+e)},l.Writer.prototype.backfill_size=function(e,o){var b=this.position-o;this.position=o,this.write_uint(b-e,e),this.position+=b-e},l.Writer.prototype.write_compound=function(e,o){var b=this.position;this.position+=e.width,this.write_uint(o.length,e.width);for(var z=0;z<o.length;z++)o[z]===void 0||o[z]===null?this.write(l.Null()):this.write(o[z]);this.backfill_size(e.width,b)},l.Writer.prototype.write_array=function(e,o,b){var z=this.position;this.position+=e.width,this.write_uint(o.length,e.width),this.write_constructor(b.typecode,b.descriptor);for(var J=ne(b.typecode),X=0;X<o.length;X++)this.write_value(J,o[X]);this.backfill_size(e.width,z)},l.Writer.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var o=0;o<this.position;o++)o>0&&(e+=","),e+=("00"+Number(this.buffer[o]).toString(16)).slice(-2);return e},l.Writer.prototype.skip=function(e){this.ensure(this.position+e),this.position+=e},l.Writer.prototype.clear=function(){this.buffer.fill(0),this.position=0},l.Writer.prototype.remaining=function(){return this.buffer.length-this.position};function ue(e){if(e==="symbol")return{typecode:l.Sym8.typecode};throw new c.TypeError("TODO: Array of type "+e+" not yet supported")}function g(e,o){if(o!=null)if(Array.isArray(o)){if(!e.multiple)throw new c.TypeError("Field "+e.name+" does not support multiple values, got "+JSON.stringify(o));var b=ue(e.type);return l.wrap_array(o,b.typecode,b.descriptor)}else{if(e.type==="*")return o;var z=l["wrap_"+e.type];if(z)return z(o);throw new c.TypeError("No wrapper for field "+e.name+" of type "+e.type)}else{if(e.mandatory)throw new c.TypeError("Field "+e.name+" is mandatory");return l.Null()}}function I(e,o){var b;o.type==="*"?b=function(){return this.value[e]}:b=function(){return l.unwrap(this.value[e])};var z=function(J){this.value[e]=g(o,J)};return{get:b,set:z,enumerable:!0,configurable:!1}}l.define_composite=function(e){var o=function(J){this.value=J||[]};o.descriptor={numeric:e.code,symbolic:"amqp:"+e.name+":list"},o.prototype.dispatch=function(J,X){J["on_"+e.name](X)};for(var b=0;b<e.fields.length;b++){var z=e.fields[b];Object.defineProperty(o.prototype,z.name,I(b,z))}return o.toString=function(){return e.name+"#"+Number(e.code).toString(16)},o.prototype.toJSON=function(){var J={};for(var X in this)X!=="value"&&this[X]&&(J[X]=this[X]);return J},o.create=function(J){var X=new o;for(var K in J)X[K]=J[K];return X},o.prototype.described=function(){return l.described_nc(l.wrap_ulong(o.descriptor.numeric),l.wrap_list(this.value))},o};function Y(e){var o=l.define_composite(e);l["wrap_"+e.name]=function(b){return o.create(b).described()},oe[Number(o.descriptor.numeric).toString(10)]=o,oe[o.descriptor.symbolic]=o}Y({name:"error",code:29,fields:[{name:"condition",type:"symbol",mandatory:!0},{name:"description",type:"string"},{name:"info",type:"map"}]}),T.exports=l}).call(this)}).call(this,y("buffer").Buffer)},{"./errors.js":3,"./util.js":15,buffer:20}],15:[function(y,T,m){(function(u){(function(){var c=y("./errors.js"),_={};_.allocate_buffer=function(p){return u.alloc?u.alloc(p):new u(p)},_.generate_uuid=function(){return _.uuid_to_string(_.uuid4())},_.uuid4=function(){for(var p=_.allocate_buffer(16),f=0;f<p.length;f++)p[f]=Math.random()*255|0;return p[7]&=15,p[7]|=64,p[8]&=63,p[8]|=128,p},_.uuid_to_string=function(p){if(p.length===16){var f=[p.slice(0,4),p.slice(4,6),p.slice(6,8),p.slice(8,10),p.slice(10,16)];return f.map(function(i){return i.toString("hex")}).join("-")}else throw new c.TypeError("Not a UUID, expecting 16 byte buffer")};var A=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/;_.string_to_uuid=function(p){var f=A.exec(p.toLowerCase());if(f)return u.from(f.slice(1).join(""),"hex");throw new c.TypeError("Not a valid UUID string: "+p)},_.clone=function(p){for(var f=Object.create(p.prototype||{}),i=Object.getOwnPropertyNames(p),h=0;h<i.length;h++){var j=i[h];f[j]=p[j]}return f},_.and=function(p,f){return f===void 0?p:function(i){return p(i)&&f(i)}},_.is_sender=function(p){return p.is_sender()},_.is_receiver=function(p){return p.is_receiver()},_.sender_filter=function(p){return _.and(_.is_sender,p)},_.receiver_filter=function(p){return _.and(_.is_receiver,p)},_.is_defined=function(p){return p!=null},T.exports=_}).call(this)}).call(this,y("buffer").Buffer)},{"./errors.js":3,buffer:20}],16:[function(y,T,m){(function(u){(function(){function c(f){return f}function _(f){return f instanceof ArrayBuffer?u.from(new Uint8Array(f)):u.from(f)}function A(f){return new Uint8Array(f)}function p(f){var i=c,h=c;return f.binaryType&&(f.binaryType="arraybuffer",i=_,h=A),{end:function(){f.close()},write:function(j){try{f.send(h(j),{binary:!0})}catch(C){f.onerror(C)}},on:function(j,C){j==="data"?f.onmessage=function(l){C(i(l.data))}:j==="end"?f.onclose=C:j==="error"?f.onerror=C:console.error("ERROR: Attempt to set unrecognised handler on websocket wrapper: "+j)},get_id_string:function(){return f.url}}}T.exports={connect:function(f){return function(i,h,j){return function(){return{connect:function(C,l,v,k){var O=new f(i,h,j);return O.onopen=k,p(O)}}}}},wrap:p}}).call(this)}).call(this,y("buffer").Buffer)},{buffer:20}],17:[function(y,T,m){(function(u){(function(){var c=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],_=typeof globalThis>"u"?u:globalThis;T.exports=function(){for(var p=[],f=0;f<c.length;f++)typeof _[c[f]]=="function"&&(p[p.length]=c[f]);return p}}).call(this)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],18:[function(y,T,m){m.byteLength=h,m.toByteArray=C,m.fromByteArray=k;for(var u=[],c=[],_=typeof Uint8Array<"u"?Uint8Array:Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,f=A.length;p<f;++p)u[p]=A[p],c[A.charCodeAt(p)]=p;c[45]=62,c[95]=63;function i(O){var L=O.length;if(L%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var P=O.indexOf("=");P===-1&&(P=L);var E=P===L?0:4-P%4;return[P,E]}function h(O){var L=i(O),P=L[0],E=L[1];return(P+E)*3/4-E}function j(O,L,P){return(L+P)*3/4-P}function C(O){var L,P=i(O),E=P[0],U=P[1],M=new _(j(O,E,U)),w=0,r=U>0?E-4:E,a;for(a=0;a<r;a+=4)L=c[O.charCodeAt(a)]<<18|c[O.charCodeAt(a+1)]<<12|c[O.charCodeAt(a+2)]<<6|c[O.charCodeAt(a+3)],M[w++]=L>>16&255,M[w++]=L>>8&255,M[w++]=L&255;return U===2&&(L=c[O.charCodeAt(a)]<<2|c[O.charCodeAt(a+1)]>>4,M[w++]=L&255),U===1&&(L=c[O.charCodeAt(a)]<<10|c[O.charCodeAt(a+1)]<<4|c[O.charCodeAt(a+2)]>>2,M[w++]=L>>8&255,M[w++]=L&255),M}function l(O){return u[O>>18&63]+u[O>>12&63]+u[O>>6&63]+u[O&63]}function v(O,L,P){for(var E,U=[],M=L;M<P;M+=3)E=(O[M]<<16&16711680)+(O[M+1]<<8&65280)+(O[M+2]&255),U.push(l(E));return U.join("")}function k(O){for(var L,P=O.length,E=P%3,U=[],M=16383,w=0,r=P-E;w<r;w+=M)U.push(v(O,w,w+M>r?r:w+M));return E===1?(L=O[P-1],U.push(u[L>>2]+u[L<<4&63]+"==")):E===2&&(L=(O[P-2]<<8)+O[P-1],U.push(u[L>>10]+u[L>>4&63]+u[L<<2&63]+"=")),U.join("")}},{}],19:[function(y,T,m){},{}],20:[function(y,T,m){(function(u){(function(){var c=y("base64-js"),_=y("ieee754");m.Buffer=i,m.SlowBuffer=E,m.INSPECT_MAX_BYTES=50;var A=2147483647;m.kMaxLength=A,i.TYPED_ARRAY_SUPPORT=p(),!i.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function p(){try{var d=new Uint8Array(1);return d.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},d.foo()===42}catch{return!1}}Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}});function f(d){if(d>A)throw new RangeError('The value "'+d+'" is invalid for option "size"');var t=new Uint8Array(d);return t.__proto__=i.prototype,t}function i(d,t,n){if(typeof d=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return l(d)}return h(d,t,n)}typeof Symbol<"u"&&Symbol.species!=null&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192;function h(d,t,n){if(typeof d=="string")return v(d,t);if(ArrayBuffer.isView(d))return k(d);if(d==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(he(d,ArrayBuffer)||d&&he(d.buffer,ArrayBuffer))return O(d,t,n);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var s=d.valueOf&&d.valueOf();if(s!=null&&s!==d)return i.from(s,t,n);var B=L(d);if(B)return B;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return i.from(d[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}i.from=function(d,t,n){return h(d,t,n)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array;function j(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function C(d,t,n){return j(d),d<=0?f(d):t!==void 0?typeof n=="string"?f(d).fill(t,n):f(d).fill(t):f(d)}i.alloc=function(d,t,n){return C(d,t,n)};function l(d){return j(d),f(d<0?0:P(d)|0)}i.allocUnsafe=function(d){return l(d)},i.allocUnsafeSlow=function(d){return l(d)};function v(d,t){if((typeof t!="string"||t==="")&&(t="utf8"),!i.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=U(d,t)|0,s=f(n),B=s.write(d,t);return B!==n&&(s=s.slice(0,B)),s}function k(d){for(var t=d.length<0?0:P(d.length)|0,n=f(t),s=0;s<t;s+=1)n[s]=d[s]&255;return n}function O(d,t,n){if(t<0||d.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var s;return t===void 0&&n===void 0?s=new Uint8Array(d):n===void 0?s=new Uint8Array(d,t):s=new Uint8Array(d,t,n),s.__proto__=i.prototype,s}function L(d){if(i.isBuffer(d)){var t=P(d.length)|0,n=f(t);return n.length===0||d.copy(n,0,0,t),n}if(d.length!==void 0)return typeof d.length!="number"||ye(d.length)?f(0):k(d);if(d.type==="Buffer"&&Array.isArray(d.data))return k(d.data)}function P(d){if(d>=A)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+A.toString(16)+" bytes");return d|0}function E(d){return+d!=d&&(d=0),i.alloc(+d)}i.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==i.prototype},i.compare=function(t,n){if(he(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),he(n,Uint8Array)&&(n=i.from(n,n.offset,n.byteLength)),!i.isBuffer(t)||!i.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===n)return 0;for(var s=t.length,B=n.length,D=0,Q=Math.min(s,B);D<Q;++D)if(t[D]!==n[D]){s=t[D],B=n[D];break}return s<B?-1:B<s?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,n){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return i.alloc(0);var s;if(n===void 0)for(n=0,s=0;s<t.length;++s)n+=t[s].length;var B=i.allocUnsafe(n),D=0;for(s=0;s<t.length;++s){var Q=t[s];if(he(Q,Uint8Array)&&(Q=i.from(Q)),!i.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(B,D),D+=Q.length}return B};function U(d,t){if(i.isBuffer(d))return d.length;if(ArrayBuffer.isView(d)||he(d,ArrayBuffer))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);var n=d.length,s=arguments.length>2&&arguments[2]===!0;if(!s&&n===0)return 0;for(var B=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return K(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return n*2;case"hex":return n>>>1;case"base64":return ce(d).length;default:if(B)return s?-1:K(d).length;t=(""+t).toLowerCase(),B=!0}}i.byteLength=U;function M(d,t,n){var s=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((n===void 0||n>this.length)&&(n=this.length),n<=0)||(n>>>=0,t>>>=0,n<=t))return"";for(d||(d="utf8");;)switch(d){case"hex":return ue(this,t,n);case"utf8":case"utf-8":return q(this,t,n);case"ascii":return ne(this,t,n);case"latin1":case"binary":return le(this,t,n);case"base64":return H(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),s=!0}}i.prototype._isBuffer=!0;function w(d,t,n){var s=d[t];d[t]=d[n],d[n]=s}i.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)w(this,n,n+1);return this},i.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)w(this,n,n+3),w(this,n+1,n+2);return this},i.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)w(this,n,n+7),w(this,n+1,n+6),w(this,n+2,n+5),w(this,n+3,n+4);return this},i.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?q(this,0,t):M.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:i.compare(this,t)===0},i.prototype.inspect=function(){var t="",n=m.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},i.prototype.compare=function(t,n,s,B,D){if(he(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),!i.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(n===void 0&&(n=0),s===void 0&&(s=t?t.length:0),B===void 0&&(B=0),D===void 0&&(D=this.length),n<0||s>t.length||B<0||D>this.length)throw new RangeError("out of range index");if(B>=D&&n>=s)return 0;if(B>=D)return-1;if(n>=s)return 1;if(n>>>=0,s>>>=0,B>>>=0,D>>>=0,this===t)return 0;for(var Q=D-B,te=s-n,re=Math.min(Q,te),se=this.slice(B,D),pe=t.slice(n,s),ae=0;ae<re;++ae)if(se[ae]!==pe[ae]){Q=se[ae],te=pe[ae];break}return Q<te?-1:te<Q?1:0};function r(d,t,n,s,B){if(d.length===0)return-1;if(typeof n=="string"?(s=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,ye(n)&&(n=B?0:d.length-1),n<0&&(n=d.length+n),n>=d.length){if(B)return-1;n=d.length-1}else if(n<0)if(B)n=0;else return-1;if(typeof t=="string"&&(t=i.from(t,s)),i.isBuffer(t))return t.length===0?-1:a(d,t,n,s,B);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?B?Uint8Array.prototype.indexOf.call(d,t,n):Uint8Array.prototype.lastIndexOf.call(d,t,n):a(d,[t],n,s,B);throw new TypeError("val must be string, number or Buffer")}function a(d,t,n,s,B){var D=1,Q=d.length,te=t.length;if(s!==void 0&&(s=String(s).toLowerCase(),s==="ucs2"||s==="ucs-2"||s==="utf16le"||s==="utf-16le")){if(d.length<2||t.length<2)return-1;D=2,Q/=2,te/=2,n/=2}function re(it,ot){return D===1?it[ot]:it.readUInt16BE(ot*D)}var se;if(B){var pe=-1;for(se=n;se<Q;se++)if(re(d,se)===re(t,pe===-1?0:se-pe)){if(pe===-1&&(pe=se),se-pe+1===te)return pe*D}else pe!==-1&&(se-=se-pe),pe=-1}else for(n+te>Q&&(n=Q-te),se=n;se>=0;se--){for(var ae=!0,Se=0;Se<te;Se++)if(re(d,se+Se)!==re(t,Se)){ae=!1;break}if(ae)return se}return-1}i.prototype.includes=function(t,n,s){return this.indexOf(t,n,s)!==-1},i.prototype.indexOf=function(t,n,s){return r(this,t,n,s,!0)},i.prototype.lastIndexOf=function(t,n,s){return r(this,t,n,s,!1)};function S(d,t,n,s){n=Number(n)||0;var B=d.length-n;s?(s=Number(s),s>B&&(s=B)):s=B;var D=t.length;s>D/2&&(s=D/2);for(var Q=0;Q<s;++Q){var te=parseInt(t.substr(Q*2,2),16);if(ye(te))return Q;d[n+Q]=te}return Q}function x(d,t,n,s){return fe(K(t,d.length-n),d,n,s)}function N(d,t,n,s){return fe(Z(t),d,n,s)}function W(d,t,n,s){return N(d,t,n,s)}function $(d,t,n,s){return fe(ce(t),d,n,s)}function V(d,t,n,s){return fe(ee(t,d.length-n),d,n,s)}i.prototype.write=function(t,n,s,B){if(n===void 0)B="utf8",s=this.length,n=0;else if(s===void 0&&typeof n=="string")B=n,s=this.length,n=0;else if(isFinite(n))n=n>>>0,isFinite(s)?(s=s>>>0,B===void 0&&(B="utf8")):(B=s,s=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var D=this.length-n;if((s===void 0||s>D)&&(s=D),t.length>0&&(s<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");B||(B="utf8");for(var Q=!1;;)switch(B){case"hex":return S(this,t,n,s);case"utf8":case"utf-8":return x(this,t,n,s);case"ascii":return N(this,t,n,s);case"latin1":case"binary":return W(this,t,n,s);case"base64":return $(this,t,n,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,t,n,s);default:if(Q)throw new TypeError("Unknown encoding: "+B);B=(""+B).toLowerCase(),Q=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function H(d,t,n){return t===0&&n===d.length?c.fromByteArray(d):c.fromByteArray(d.slice(t,n))}function q(d,t,n){n=Math.min(d.length,n);for(var s=[],B=t;B<n;){var D=d[B],Q=null,te=D>239?4:D>223?3:D>191?2:1;if(B+te<=n){var re,se,pe,ae;switch(te){case 1:D<128&&(Q=D);break;case 2:re=d[B+1],(re&192)===128&&(ae=(D&31)<<6|re&63,ae>127&&(Q=ae));break;case 3:re=d[B+1],se=d[B+2],(re&192)===128&&(se&192)===128&&(ae=(D&15)<<12|(re&63)<<6|se&63,ae>2047&&(ae<55296||ae>57343)&&(Q=ae));break;case 4:re=d[B+1],se=d[B+2],pe=d[B+3],(re&192)===128&&(se&192)===128&&(pe&192)===128&&(ae=(D&15)<<18|(re&63)<<12|(se&63)<<6|pe&63,ae>65535&&ae<1114112&&(Q=ae))}}Q===null?(Q=65533,te=1):Q>65535&&(Q-=65536,s.push(Q>>>10&1023|55296),Q=56320|Q&1023),s.push(Q),B+=te}return oe(s)}var G=4096;function oe(d){var t=d.length;if(t<=G)return String.fromCharCode.apply(String,d);for(var n="",s=0;s<t;)n+=String.fromCharCode.apply(String,d.slice(s,s+=G));return n}function ne(d,t,n){var s="";n=Math.min(d.length,n);for(var B=t;B<n;++B)s+=String.fromCharCode(d[B]&127);return s}function le(d,t,n){var s="";n=Math.min(d.length,n);for(var B=t;B<n;++B)s+=String.fromCharCode(d[B]);return s}function ue(d,t,n){var s=d.length;(!t||t<0)&&(t=0),(!n||n<0||n>s)&&(n=s);for(var B="",D=t;D<n;++D)B+=X(d[D]);return B}function g(d,t,n){for(var s=d.slice(t,n),B="",D=0;D<s.length;D+=2)B+=String.fromCharCode(s[D]+s[D+1]*256);return B}i.prototype.slice=function(t,n){var s=this.length;t=~~t,n=n===void 0?s:~~n,t<0?(t+=s,t<0&&(t=0)):t>s&&(t=s),n<0?(n+=s,n<0&&(n=0)):n>s&&(n=s),n<t&&(n=t);var B=this.subarray(t,n);return B.__proto__=i.prototype,B};function I(d,t,n){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+t>n)throw new RangeError("Trying to access beyond buffer length")}i.prototype.readUIntLE=function(t,n,s){t=t>>>0,n=n>>>0,s||I(t,n,this.length);for(var B=this[t],D=1,Q=0;++Q<n&&(D*=256);)B+=this[t+Q]*D;return B},i.prototype.readUIntBE=function(t,n,s){t=t>>>0,n=n>>>0,s||I(t,n,this.length);for(var B=this[t+--n],D=1;n>0&&(D*=256);)B+=this[t+--n]*D;return B},i.prototype.readUInt8=function(t,n){return t=t>>>0,n||I(t,1,this.length),this[t]},i.prototype.readUInt16LE=function(t,n){return t=t>>>0,n||I(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUInt16BE=function(t,n){return t=t>>>0,n||I(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUInt32LE=function(t,n){return t=t>>>0,n||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},i.prototype.readUInt32BE=function(t,n){return t=t>>>0,n||I(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,n,s){t=t>>>0,n=n>>>0,s||I(t,n,this.length);for(var B=this[t],D=1,Q=0;++Q<n&&(D*=256);)B+=this[t+Q]*D;return D*=128,B>=D&&(B-=Math.pow(2,8*n)),B},i.prototype.readIntBE=function(t,n,s){t=t>>>0,n=n>>>0,s||I(t,n,this.length);for(var B=n,D=1,Q=this[t+--B];B>0&&(D*=256);)Q+=this[t+--B]*D;return D*=128,Q>=D&&(Q-=Math.pow(2,8*n)),Q},i.prototype.readInt8=function(t,n){return t=t>>>0,n||I(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},i.prototype.readInt16LE=function(t,n){t=t>>>0,n||I(t,2,this.length);var s=this[t]|this[t+1]<<8;return s&32768?s|4294901760:s},i.prototype.readInt16BE=function(t,n){t=t>>>0,n||I(t,2,this.length);var s=this[t+1]|this[t]<<8;return s&32768?s|4294901760:s},i.prototype.readInt32LE=function(t,n){return t=t>>>0,n||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,n){return t=t>>>0,n||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,n){return t=t>>>0,n||I(t,4,this.length),_.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,n){return t=t>>>0,n||I(t,4,this.length),_.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,n){return t=t>>>0,n||I(t,8,this.length),_.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,n){return t=t>>>0,n||I(t,8,this.length),_.read(this,t,!1,52,8)};function Y(d,t,n,s,B,D){if(!i.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>B||t<D)throw new RangeError('"value" argument is out of bounds');if(n+s>d.length)throw new RangeError("Index out of range")}i.prototype.writeUIntLE=function(t,n,s,B){if(t=+t,n=n>>>0,s=s>>>0,!B){var D=Math.pow(2,8*s)-1;Y(this,t,n,s,D,0)}var Q=1,te=0;for(this[n]=t&255;++te<s&&(Q*=256);)this[n+te]=t/Q&255;return n+s},i.prototype.writeUIntBE=function(t,n,s,B){if(t=+t,n=n>>>0,s=s>>>0,!B){var D=Math.pow(2,8*s)-1;Y(this,t,n,s,D,0)}var Q=s-1,te=1;for(this[n+Q]=t&255;--Q>=0&&(te*=256);)this[n+Q]=t/te&255;return n+s},i.prototype.writeUInt8=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,1,255,0),this[n]=t&255,n+1},i.prototype.writeUInt16LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,65535,0),this[n]=t&255,this[n+1]=t>>>8,n+2},i.prototype.writeUInt16BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,65535,0),this[n]=t>>>8,this[n+1]=t&255,n+2},i.prototype.writeUInt32LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,4294967295,0),this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=t&255,n+4},i.prototype.writeUInt32BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,4294967295,0),this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t&255,n+4},i.prototype.writeIntLE=function(t,n,s,B){if(t=+t,n=n>>>0,!B){var D=Math.pow(2,8*s-1);Y(this,t,n,s,D-1,-D)}var Q=0,te=1,re=0;for(this[n]=t&255;++Q<s&&(te*=256);)t<0&&re===0&&this[n+Q-1]!==0&&(re=1),this[n+Q]=(t/te>>0)-re&255;return n+s},i.prototype.writeIntBE=function(t,n,s,B){if(t=+t,n=n>>>0,!B){var D=Math.pow(2,8*s-1);Y(this,t,n,s,D-1,-D)}var Q=s-1,te=1,re=0;for(this[n+Q]=t&255;--Q>=0&&(te*=256);)t<0&&re===0&&this[n+Q+1]!==0&&(re=1),this[n+Q]=(t/te>>0)-re&255;return n+s},i.prototype.writeInt8=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,1,127,-128),t<0&&(t=255+t+1),this[n]=t&255,n+1},i.prototype.writeInt16LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,32767,-32768),this[n]=t&255,this[n+1]=t>>>8,n+2},i.prototype.writeInt16BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,32767,-32768),this[n]=t>>>8,this[n+1]=t&255,n+2},i.prototype.writeInt32LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,2147483647,-2147483648),this[n]=t&255,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24,n+4},i.prototype.writeInt32BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t&255,n+4};function e(d,t,n,s,B,D){if(n+s>d.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function o(d,t,n,s,B){return t=+t,n=n>>>0,B||e(d,t,n,4),_.write(d,t,n,s,23,4),n+4}i.prototype.writeFloatLE=function(t,n,s){return o(this,t,n,!0,s)},i.prototype.writeFloatBE=function(t,n,s){return o(this,t,n,!1,s)};function b(d,t,n,s,B){return t=+t,n=n>>>0,B||e(d,t,n,8),_.write(d,t,n,s,52,8),n+8}i.prototype.writeDoubleLE=function(t,n,s){return b(this,t,n,!0,s)},i.prototype.writeDoubleBE=function(t,n,s){return b(this,t,n,!1,s)},i.prototype.copy=function(t,n,s,B){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),!B&&B!==0&&(B=this.length),n>=t.length&&(n=t.length),n||(n=0),B>0&&B<s&&(B=s),B===s||t.length===0||this.length===0)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(B<0)throw new RangeError("sourceEnd out of bounds");B>this.length&&(B=this.length),t.length-n<B-s&&(B=t.length-n+s);var D=B-s;if(this===t&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(n,s,B);else if(this===t&&s<n&&n<B)for(var Q=D-1;Q>=0;--Q)t[Q+n]=this[Q+s];else Uint8Array.prototype.set.call(t,this.subarray(s,B),n);return D},i.prototype.fill=function(t,n,s,B){if(typeof t=="string"){if(typeof n=="string"?(B=n,n=0,s=this.length):typeof s=="string"&&(B=s,s=this.length),B!==void 0&&typeof B!="string")throw new TypeError("encoding must be a string");if(typeof B=="string"&&!i.isEncoding(B))throw new TypeError("Unknown encoding: "+B);if(t.length===1){var D=t.charCodeAt(0);(B==="utf8"&&D<128||B==="latin1")&&(t=D)}}else typeof t=="number"&&(t=t&255);if(n<0||this.length<n||this.length<s)throw new RangeError("Out of range index");if(s<=n)return this;n=n>>>0,s=s===void 0?this.length:s>>>0,t||(t=0);var Q;if(typeof t=="number")for(Q=n;Q<s;++Q)this[Q]=t;else{var te=i.isBuffer(t)?t:i.from(t,B),re=te.length;if(re===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(Q=0;Q<s-n;++Q)this[Q+n]=te[Q%re]}return this};var z=/[^+/0-9A-Za-z-_]/g;function J(d){if(d=d.split("=")[0],d=d.trim().replace(z,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function X(d){return d<16?"0"+d.toString(16):d.toString(16)}function K(d,t){t=t||1/0;for(var n,s=d.length,B=null,D=[],Q=0;Q<s;++Q){if(n=d.charCodeAt(Q),n>55295&&n<57344){if(!B){if(n>56319){(t-=3)>-1&&D.push(239,191,189);continue}else if(Q+1===s){(t-=3)>-1&&D.push(239,191,189);continue}B=n;continue}if(n<56320){(t-=3)>-1&&D.push(239,191,189),B=n;continue}n=(B-55296<<10|n-56320)+65536}else B&&(t-=3)>-1&&D.push(239,191,189);if(B=null,n<128){if((t-=1)<0)break;D.push(n)}else if(n<2048){if((t-=2)<0)break;D.push(n>>6|192,n&63|128)}else if(n<65536){if((t-=3)<0)break;D.push(n>>12|224,n>>6&63|128,n&63|128)}else if(n<1114112){if((t-=4)<0)break;D.push(n>>18|240,n>>12&63|128,n>>6&63|128,n&63|128)}else throw new Error("Invalid code point")}return D}function Z(d){for(var t=[],n=0;n<d.length;++n)t.push(d.charCodeAt(n)&255);return t}function ee(d,t){for(var n,s,B,D=[],Q=0;Q<d.length&&!((t-=2)<0);++Q)n=d.charCodeAt(Q),s=n>>8,B=n%256,D.push(B),D.push(s);return D}function ce(d){return c.toByteArray(J(d))}function fe(d,t,n,s){for(var B=0;B<s&&!(B+n>=t.length||B>=d.length);++B)t[B+n]=d[B];return B}function he(d,t){return d instanceof t||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===t.name}function ye(d){return d!==d}}).call(this)}).call(this,y("buffer").Buffer)},{"base64-js":18,buffer:20,ieee754:35}],21:[function(y,T,m){var u=y("get-intrinsic"),c=y("./"),_=c(u("String.prototype.indexOf"));T.exports=function(p,f){var i=u(p,!!f);return typeof i=="function"&&_(p,".prototype.")>-1?c(i):i}},{"./":22,"get-intrinsic":30}],22:[function(y,T,m){var u=y("function-bind"),c=y("get-intrinsic"),_=c("%Function.prototype.apply%"),A=c("%Function.prototype.call%"),p=c("%Reflect.apply%",!0)||u.call(A,_),f=c("%Object.getOwnPropertyDescriptor%",!0),i=c("%Object.defineProperty%",!0),h=c("%Math.max%");if(i)try{i({},"a",{value:1})}catch{i=null}T.exports=function(l){var v=p(u,A,arguments);if(f&&i){var k=f(v,"length");k.configurable&&i(v,"length",{value:1+h(0,l.length-(arguments.length-1))})}return v};var j=function(){return p(u,_,arguments)};i?i(T.exports,"apply",{value:j}):T.exports.apply=j},{"function-bind":29,"get-intrinsic":30}],23:[function(y,T,m){(function(u){(function(){m.formatArgs=_,m.save=A,m.load=p,m.useColors=c,m.storage=f(),m.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),m.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function c(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function _(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+T.exports.humanize(this.diff),!this.useColors)return;const j="color: "+this.color;h.splice(1,0,j,"color: inherit");let C=0,l=0;h[0].replace(/%[a-zA-Z%]/g,v=>{v!=="%%"&&(C++,v==="%c"&&(l=C))}),h.splice(l,0,j)}m.log=console.debug||console.log||(()=>{});function A(h){try{h?m.storage.setItem("debug",h):m.storage.removeItem("debug")}catch{}}function p(){let h;try{h=m.storage.getItem("debug")}catch{}return!h&&typeof u<"u"&&"env"in u&&(h=u.env.DEBUG),h}function f(){try{return localStorage}catch{}}T.exports=y("./common")(m);const{formatters:i}=T.exports;i.j=function(h){try{return JSON.stringify(h)}catch(j){return"[UnexpectedJSONParseError]: "+j.message}}}).call(this)}).call(this,y("_process"))},{"./common":24,_process:43}],24:[function(y,T,m){function u(c){A.debug=A,A.default=A,A.coerce=C,A.disable=i,A.enable=f,A.enabled=h,A.humanize=y("ms"),A.destroy=l,Object.keys(c).forEach(v=>{A[v]=c[v]}),A.names=[],A.skips=[],A.formatters={};function _(v){let k=0;for(let O=0;O<v.length;O++)k=(k<<5)-k+v.charCodeAt(O),k|=0;return A.colors[Math.abs(k)%A.colors.length]}A.selectColor=_;function A(v){let k,O=null,L,P;function E(...U){if(!E.enabled)return;const M=E,w=Number(new Date),r=w-(k||w);M.diff=r,M.prev=k,M.curr=w,k=w,U[0]=A.coerce(U[0]),typeof U[0]!="string"&&U.unshift("%O");let a=0;U[0]=U[0].replace(/%([a-zA-Z%])/g,(x,N)=>{if(x==="%%")return"%";a++;const W=A.formatters[N];if(typeof W=="function"){const $=U[a];x=W.call(M,$),U.splice(a,1),a--}return x}),A.formatArgs.call(M,U),(M.log||A.log).apply(M,U)}return E.namespace=v,E.useColors=A.useColors(),E.color=A.selectColor(v),E.extend=p,E.destroy=A.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>O!==null?O:(L!==A.namespaces&&(L=A.namespaces,P=A.enabled(v)),P),set:U=>{O=U}}),typeof A.init=="function"&&A.init(E),E}function p(v,k){const O=A(this.namespace+(typeof k>"u"?":":k)+v);return O.log=this.log,O}function f(v){A.save(v),A.namespaces=v,A.names=[],A.skips=[];let k;const O=(typeof v=="string"?v:"").split(/[\s,]+/),L=O.length;for(k=0;k<L;k++)O[k]&&(v=O[k].replace(/\*/g,".*?"),v[0]==="-"?A.skips.push(new RegExp("^"+v.slice(1)+"$")):A.names.push(new RegExp("^"+v+"$")))}function i(){const v=[...A.names.map(j),...A.skips.map(j).map(k=>"-"+k)].join(",");return A.enable(""),v}function h(v){if(v[v.length-1]==="*")return!0;let k,O;for(k=0,O=A.skips.length;k<O;k++)if(A.skips[k].test(v))return!1;for(k=0,O=A.names.length;k<O;k++)if(A.names[k].test(v))return!0;return!1}function j(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}function C(v){return v instanceof Error?v.stack||v.message:v}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return A.enable(A.load()),A}T.exports=u},{ms:40}],25:[function(y,T,m){var u=y("get-intrinsic"),c=u("%Object.getOwnPropertyDescriptor%",!0);if(c)try{c([],"length")}catch{c=null}T.exports=c},{"get-intrinsic":30}],26:[function(y,T,m){var u=typeof Reflect=="object"?Reflect:null,c=u&&typeof u.apply=="function"?u.apply:function(a,S,x){return Function.prototype.apply.call(a,S,x)},_;u&&typeof u.ownKeys=="function"?_=u.ownKeys:Object.getOwnPropertySymbols?_=function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:_=function(a){return Object.getOwnPropertyNames(a)};function A(r){console&&console.warn&&console.warn(r)}var p=Number.isNaN||function(a){return a!==a};function f(){f.init.call(this)}T.exports=f,T.exports.once=U,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var i=10;function h(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(r){if(typeof r!="number"||r<0||p(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");i=r}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||p(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this};function j(r){return r._maxListeners===void 0?f.defaultMaxListeners:r._maxListeners}f.prototype.getMaxListeners=function(){return j(this)},f.prototype.emit=function(a){for(var S=[],x=1;x<arguments.length;x++)S.push(arguments[x]);var N=a==="error",W=this._events;if(W!==void 0)N=N&&W.error===void 0;else if(!N)return!1;if(N){var $;if(S.length>0&&($=S[0]),$ instanceof Error)throw $;var V=new Error("Unhandled error."+($?" ("+$.message+")":""));throw V.context=$,V}var H=W[a];if(H===void 0)return!1;if(typeof H=="function")c(H,this,S);else for(var q=H.length,G=L(H,q),x=0;x<q;++x)c(G[x],this,S);return!0};function C(r,a,S,x){var N,W,$;if(h(S),W=r._events,W===void 0?(W=r._events=Object.create(null),r._eventsCount=0):(W.newListener!==void 0&&(r.emit("newListener",a,S.listener?S.listener:S),W=r._events),$=W[a]),$===void 0)$=W[a]=S,++r._eventsCount;else if(typeof $=="function"?$=W[a]=x?[S,$]:[$,S]:x?$.unshift(S):$.push(S),N=j(r),N>0&&$.length>N&&!$.warned){$.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=r,V.type=a,V.count=$.length,A(V)}return r}f.prototype.addListener=function(a,S){return C(this,a,S,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(a,S){return C(this,a,S,!0)};function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(r,a,S){var x={fired:!1,wrapFn:void 0,target:r,type:a,listener:S},N=l.bind(x);return N.listener=S,x.wrapFn=N,N}f.prototype.once=function(a,S){return h(S),this.on(a,v(this,a,S)),this},f.prototype.prependOnceListener=function(a,S){return h(S),this.prependListener(a,v(this,a,S)),this},f.prototype.removeListener=function(a,S){var x,N,W,$,V;if(h(S),N=this._events,N===void 0)return this;if(x=N[a],x===void 0)return this;if(x===S||x.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete N[a],N.removeListener&&this.emit("removeListener",a,x.listener||S));else if(typeof x!="function"){for(W=-1,$=x.length-1;$>=0;$--)if(x[$]===S||x[$].listener===S){V=x[$].listener,W=$;break}if(W<0)return this;W===0?x.shift():P(x,W),x.length===1&&(N[a]=x[0]),N.removeListener!==void 0&&this.emit("removeListener",a,V||S)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(a){var S,x,N;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[a]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[a]),this;if(arguments.length===0){var W=Object.keys(x),$;for(N=0;N<W.length;++N)$=W[N],$!=="removeListener"&&this.removeAllListeners($);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=x[a],typeof S=="function")this.removeListener(a,S);else if(S!==void 0)for(N=S.length-1;N>=0;N--)this.removeListener(a,S[N]);return this};function k(r,a,S){var x=r._events;if(x===void 0)return[];var N=x[a];return N===void 0?[]:typeof N=="function"?S?[N.listener||N]:[N]:S?E(N):L(N,N.length)}f.prototype.listeners=function(a){return k(this,a,!0)},f.prototype.rawListeners=function(a){return k(this,a,!1)},f.listenerCount=function(r,a){return typeof r.listenerCount=="function"?r.listenerCount(a):O.call(r,a)},f.prototype.listenerCount=O;function O(r){var a=this._events;if(a!==void 0){var S=a[r];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function L(r,a){for(var S=new Array(a),x=0;x<a;++x)S[x]=r[x];return S}function P(r,a){for(;a+1<r.length;a++)r[a]=r[a+1];r.pop()}function E(r){for(var a=new Array(r.length),S=0;S<a.length;++S)a[S]=r[S].listener||r[S];return a}function U(r,a){return new Promise(function(S,x){function N($){r.removeListener(a,W),x($)}function W(){typeof r.removeListener=="function"&&r.removeListener("error",N),S([].slice.call(arguments))}w(r,a,W,{once:!0}),a!=="error"&&M(r,N,{once:!0})})}function M(r,a,S){typeof r.on=="function"&&w(r,"error",a,S)}function w(r,a,S,x){if(typeof r.on=="function")x.once?r.once(a,S):r.on(a,S);else if(typeof r.addEventListener=="function")r.addEventListener(a,function N(W){x.once&&r.removeEventListener(a,N),S(W)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}},{}],27:[function(y,T,m){var u=Object.prototype.hasOwnProperty,c=Object.prototype.toString;T.exports=function(A,p,f){if(c.call(p)!=="[object Function]")throw new TypeError("iterator must be a function");var i=A.length;if(i===+i)for(var h=0;h<i;h++)p.call(f,A[h],h,A);else for(var j in A)u.call(A,j)&&p.call(f,A[j],j,A)}},{}],28:[function(y,T,m){var u="Function.prototype.bind called on incompatible ",c=Array.prototype.slice,_=Object.prototype.toString,A="[object Function]";T.exports=function(f){var i=this;if(typeof i!="function"||_.call(i)!==A)throw new TypeError(u+i);for(var h=c.call(arguments,1),j,C=function(){if(this instanceof j){var L=i.apply(this,h.concat(c.call(arguments)));return Object(L)===L?L:this}else return i.apply(f,h.concat(c.call(arguments)))},l=Math.max(0,i.length-h.length),v=[],k=0;k<l;k++)v.push("$"+k);if(j=Function("binder","return function ("+v.join(",")+"){ return binder.apply(this,arguments); }")(C),i.prototype){var O=function(){};O.prototype=i.prototype,j.prototype=new O,O.prototype=null}return j}},{}],29:[function(y,T,m){var u=y("./implementation");T.exports=Function.prototype.bind||u},{"./implementation":28}],30:[function(y,T,m){var u,c=SyntaxError,_=Function,A=TypeError,p=function(W){try{return _('"use strict"; return ('+W+").constructor;")()}catch{}},f=Object.getOwnPropertyDescriptor;if(f)try{f({},"")}catch{f=null}var i=function(){throw new A},h=f?(function(){try{return arguments.callee,i}catch{try{return f(arguments,"callee").get}catch{return i}}})():i,j=y("has-symbols")(),C=Object.getPrototypeOf||function(W){return W.__proto__},l={},v=typeof Uint8Array>"u"?u:C(Uint8Array),k={"%AggregateError%":typeof AggregateError>"u"?u:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?u:ArrayBuffer,"%ArrayIteratorPrototype%":j?C([][Symbol.iterator]()):u,"%AsyncFromSyncIteratorPrototype%":u,"%AsyncFunction%":l,"%AsyncGenerator%":l,"%AsyncGeneratorFunction%":l,"%AsyncIteratorPrototype%":l,"%Atomics%":typeof Atomics>"u"?u:Atomics,"%BigInt%":typeof BigInt>"u"?u:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?u:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?u:Float32Array,"%Float64Array%":typeof Float64Array>"u"?u:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?u:FinalizationRegistry,"%Function%":_,"%GeneratorFunction%":l,"%Int8Array%":typeof Int8Array>"u"?u:Int8Array,"%Int16Array%":typeof Int16Array>"u"?u:Int16Array,"%Int32Array%":typeof Int32Array>"u"?u:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":j?C(C([][Symbol.iterator]())):u,"%JSON%":typeof JSON=="object"?JSON:u,"%Map%":typeof Map>"u"?u:Map,"%MapIteratorPrototype%":typeof Map>"u"||!j?u:C(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?u:Promise,"%Proxy%":typeof Proxy>"u"?u:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?u:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?u:Set,"%SetIteratorPrototype%":typeof Set>"u"||!j?u:C(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?u:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":j?C(""[Symbol.iterator]()):u,"%Symbol%":j?Symbol:u,"%SyntaxError%":c,"%ThrowTypeError%":h,"%TypedArray%":v,"%TypeError%":A,"%Uint8Array%":typeof Uint8Array>"u"?u:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?u:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?u:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?u:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?u:WeakMap,"%WeakRef%":typeof WeakRef>"u"?u:WeakRef,"%WeakSet%":typeof WeakSet>"u"?u:WeakSet},O=function W($){var V;if($==="%AsyncFunction%")V=p("async function () {}");else if($==="%GeneratorFunction%")V=p("function* () {}");else if($==="%AsyncGeneratorFunction%")V=p("async function* () {}");else if($==="%AsyncGenerator%"){var H=W("%AsyncGeneratorFunction%");H&&(V=H.prototype)}else if($==="%AsyncIteratorPrototype%"){var q=W("%AsyncGenerator%");q&&(V=C(q.prototype))}return k[$]=V,V},L={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},P=y("function-bind"),E=y("has"),U=P.call(Function.call,Array.prototype.concat),M=P.call(Function.apply,Array.prototype.splice),w=P.call(Function.call,String.prototype.replace),r=P.call(Function.call,String.prototype.slice),a=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,S=/\\(\\)?/g,x=function($){var V=r($,0,1),H=r($,-1);if(V==="%"&&H!=="%")throw new c("invalid intrinsic syntax, expected closing `%`");if(H==="%"&&V!=="%")throw new c("invalid intrinsic syntax, expected opening `%`");var q=[];return w($,a,function(G,oe,ne,le){q[q.length]=ne?w(le,S,"$1"):oe||G}),q},N=function($,V){var H=$,q;if(E(L,H)&&(q=L[H],H="%"+q[0]+"%"),E(k,H)){var G=k[H];if(G===l&&(G=O(H)),typeof G>"u"&&!V)throw new A("intrinsic "+$+" exists, but is not available. Please file an issue!");return{alias:q,name:H,value:G}}throw new c("intrinsic "+$+" does not exist!")};T.exports=function($,V){if(typeof $!="string"||$.length===0)throw new A("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof V!="boolean")throw new A('"allowMissing" argument must be a boolean');var H=x($),q=H.length>0?H[0]:"",G=N("%"+q+"%",V),oe=G.name,ne=G.value,le=!1,ue=G.alias;ue&&(q=ue[0],M(H,U([0,1],ue)));for(var g=1,I=!0;g<H.length;g+=1){var Y=H[g],e=r(Y,0,1),o=r(Y,-1);if((e==='"'||e==="'"||e==="`"||o==='"'||o==="'"||o==="`")&&e!==o)throw new c("property names with quotes must have matching quotes");if((Y==="constructor"||!I)&&(le=!0),q+="."+Y,oe="%"+q+"%",E(k,oe))ne=k[oe];else if(ne!=null){if(!(Y in ne)){if(!V)throw new A("base intrinsic for "+$+" exists, but the property is not available.");return}if(f&&g+1>=H.length){var b=f(ne,Y);I=!!b,I&&"get"in b&&!("originalValue"in b.get)?ne=b.get:ne=ne[Y]}else I=E(ne,Y),ne=ne[Y];I&&!le&&(k[oe]=ne)}}return ne}},{"function-bind":29,has:34,"has-symbols":31}],31:[function(y,T,m){var u=typeof Symbol<"u"&&Symbol,c=y("./shams");T.exports=function(){return typeof u!="function"||typeof Symbol!="function"||typeof u("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:c()}},{"./shams":32}],32:[function(y,T,m){T.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var c={},_=Symbol("test"),A=Object(_);if(typeof _=="string"||Object.prototype.toString.call(_)!=="[object Symbol]"||Object.prototype.toString.call(A)!=="[object Symbol]")return!1;var p=42;c[_]=p;for(_ in c)return!1;if(typeof Object.keys=="function"&&Object.keys(c).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(c).length!==0)return!1;var f=Object.getOwnPropertySymbols(c);if(f.length!==1||f[0]!==_||!Object.prototype.propertyIsEnumerable.call(c,_))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(c,_);if(i.value!==p||i.enumerable!==!0)return!1}return!0}},{}],33:[function(y,T,m){var u=y("has-symbols/shams");T.exports=function(){return u()&&!!Symbol.toStringTag}},{"has-symbols/shams":32}],34:[function(y,T,m){var u=y("function-bind");T.exports=u.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":29}],35:[function(y,T,m){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */m.read=function(u,c,_,A,p){var f,i,h=p*8-A-1,j=(1<<h)-1,C=j>>1,l=-7,v=_?p-1:0,k=_?-1:1,O=u[c+v];for(v+=k,f=O&(1<<-l)-1,O>>=-l,l+=h;l>0;f=f*256+u[c+v],v+=k,l-=8);for(i=f&(1<<-l)-1,f>>=-l,l+=A;l>0;i=i*256+u[c+v],v+=k,l-=8);if(f===0)f=1-C;else{if(f===j)return i?NaN:(O?-1:1)*(1/0);i=i+Math.pow(2,A),f=f-C}return(O?-1:1)*i*Math.pow(2,f-A)},m.write=function(u,c,_,A,p,f){var i,h,j,C=f*8-p-1,l=(1<<C)-1,v=l>>1,k=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=A?0:f-1,L=A?1:-1,P=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(h=isNaN(c)?1:0,i=l):(i=Math.floor(Math.log(c)/Math.LN2),c*(j=Math.pow(2,-i))<1&&(i--,j*=2),i+v>=1?c+=k/j:c+=k*Math.pow(2,1-v),c*j>=2&&(i++,j/=2),i+v>=l?(h=0,i=l):i+v>=1?(h=(c*j-1)*Math.pow(2,p),i=i+v):(h=c*Math.pow(2,v-1)*Math.pow(2,p),i=0));p>=8;u[_+O]=h&255,O+=L,h/=256,p-=8);for(i=i<<p|h,C+=p;C>0;u[_+O]=i&255,O+=L,i/=256,C-=8);u[_+O-L]|=P*128}},{}],36:[function(y,T,m){typeof Object.create=="function"?T.exports=function(c,_){_&&(c.super_=_,c.prototype=Object.create(_.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:T.exports=function(c,_){if(_){c.super_=_;var A=function(){};A.prototype=_.prototype,c.prototype=new A,c.prototype.constructor=c}}},{}],37:[function(y,T,m){var u=y("has-tostringtag/shams")(),c=y("call-bind/callBound"),_=c("Object.prototype.toString"),A=function(h){return u&&h&&typeof h=="object"&&Symbol.toStringTag in h?!1:_(h)==="[object Arguments]"},p=function(h){return A(h)?!0:h!==null&&typeof h=="object"&&typeof h.length=="number"&&h.length>=0&&_(h)!=="[object Array]"&&_(h.callee)==="[object Function]"},f=(function(){return A(arguments)})();A.isLegacyArguments=p,T.exports=f?A:p},{"call-bind/callBound":21,"has-tostringtag/shams":33}],38:[function(y,T,m){var u=Object.prototype.toString,c=Function.prototype.toString,_=/^\s*(?:function)?\*/,A=y("has-tostringtag/shams")(),p=Object.getPrototypeOf,f=function(){if(!A)return!1;try{return Function("return function*() {}")()}catch{}},i;T.exports=function(j){if(typeof j!="function")return!1;if(_.test(c.call(j)))return!0;if(!A){var C=u.call(j);return C==="[object GeneratorFunction]"}if(!p)return!1;if(typeof i>"u"){var l=f();i=l?p(l):!1}return p(j)===i}},{"has-tostringtag/shams":33}],39:[function(y,T,m){(function(u){(function(){var c=y("foreach"),_=y("available-typed-arrays"),A=y("call-bind/callBound"),p=A("Object.prototype.toString"),f=y("has-tostringtag/shams")(),i=typeof globalThis>"u"?u:globalThis,h=_(),j=A("Array.prototype.indexOf",!0)||function(P,E){for(var U=0;U<P.length;U+=1)if(P[U]===E)return U;return-1},C=A("String.prototype.slice"),l={},v=y("es-abstract/helpers/getOwnPropertyDescriptor"),k=Object.getPrototypeOf;f&&v&&k&&c(h,function(L){var P=new i[L];if(Symbol.toStringTag in P){var E=k(P),U=v(E,Symbol.toStringTag);if(!U){var M=k(E);U=v(M,Symbol.toStringTag)}l[L]=U.get}});var O=function(P){var E=!1;return c(l,function(U,M){if(!E)try{E=U.call(P)===M}catch{}}),E};T.exports=function(P){if(!P||typeof P!="object")return!1;if(!f||!(Symbol.toStringTag in P)){var E=C(p(P),8,-1);return j(h,E)>-1}return v?O(P):!1}}).call(this)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":17,"call-bind/callBound":21,"es-abstract/helpers/getOwnPropertyDescriptor":25,foreach:27,"has-tostringtag/shams":33}],40:[function(y,T,m){var u=1e3,c=u*60,_=c*60,A=_*24,p=A*7,f=A*365.25;T.exports=function(l,v){v=v||{};var k=typeof l;if(k==="string"&&l.length>0)return i(l);if(k==="number"&&isFinite(l))return v.long?j(l):h(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function i(l){if(l=String(l),!(l.length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(v){var k=parseFloat(v[1]),O=(v[2]||"ms").toLowerCase();switch(O){case"years":case"year":case"yrs":case"yr":case"y":return k*f;case"weeks":case"week":case"w":return k*p;case"days":case"day":case"d":return k*A;case"hours":case"hour":case"hrs":case"hr":case"h":return k*_;case"minutes":case"minute":case"mins":case"min":case"m":return k*c;case"seconds":case"second":case"secs":case"sec":case"s":return k*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return k;default:return}}}}function h(l){var v=Math.abs(l);return v>=A?Math.round(l/A)+"d":v>=_?Math.round(l/_)+"h":v>=c?Math.round(l/c)+"m":v>=u?Math.round(l/u)+"s":l+"ms"}function j(l){var v=Math.abs(l);return v>=A?C(l,v,A,"day"):v>=_?C(l,v,_,"hour"):v>=c?C(l,v,c,"minute"):v>=u?C(l,v,u,"second"):l+" ms"}function C(l,v,k,O){var L=v>=k*1.5;return Math.round(l/k)+" "+O+(L?"s":"")}},{}],41:[function(y,T,m){m.endianness=function(){return"LE"},m.hostname=function(){return typeof location<"u"?location.hostname:""},m.loadavg=function(){return[]},m.uptime=function(){return 0},m.freemem=function(){return Number.MAX_VALUE},m.totalmem=function(){return Number.MAX_VALUE},m.cpus=function(){return[]},m.type=function(){return"Browser"},m.release=function(){return typeof navigator<"u"?navigator.appVersion:""},m.networkInterfaces=m.getNetworkInterfaces=function(){return{}},m.arch=function(){return"javascript"},m.platform=function(){return"browser"},m.tmpdir=m.tmpDir=function(){return"/tmp"},m.EOL=`
`,m.homedir=function(){return"/"}},{}],42:[function(y,T,m){(function(u){(function(){function c(f){if(typeof f!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function _(f,i){for(var h="",j=0,C=-1,l=0,v,k=0;k<=f.length;++k){if(k<f.length)v=f.charCodeAt(k);else{if(v===47)break;v=47}if(v===47){if(!(C===k-1||l===1))if(C!==k-1&&l===2){if(h.length<2||j!==2||h.charCodeAt(h.length-1)!==46||h.charCodeAt(h.length-2)!==46){if(h.length>2){var O=h.lastIndexOf("/");if(O!==h.length-1){O===-1?(h="",j=0):(h=h.slice(0,O),j=h.length-1-h.lastIndexOf("/")),C=k,l=0;continue}}else if(h.length===2||h.length===1){h="",j=0,C=k,l=0;continue}}i&&(h.length>0?h+="/..":h="..",j=2)}else h.length>0?h+="/"+f.slice(C+1,k):h=f.slice(C+1,k),j=k-C-1;C=k,l=0}else v===46&&l!==-1?++l:l=-1}return h}function A(f,i){var h=i.dir||i.root,j=i.base||(i.name||"")+(i.ext||"");return h?h===i.root?h+j:h+f+j:j}var p={resolve:function(){for(var i="",h=!1,j,C=arguments.length-1;C>=-1&&!h;C--){var l;C>=0?l=arguments[C]:(j===void 0&&(j=u.cwd()),l=j),c(l),l.length!==0&&(i=l+"/"+i,h=l.charCodeAt(0)===47)}return i=_(i,!h),h?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(i){if(c(i),i.length===0)return".";var h=i.charCodeAt(0)===47,j=i.charCodeAt(i.length-1)===47;return i=_(i,!h),i.length===0&&!h&&(i="."),i.length>0&&j&&(i+="/"),h?"/"+i:i},isAbsolute:function(i){return c(i),i.length>0&&i.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var i,h=0;h<arguments.length;++h){var j=arguments[h];c(j),j.length>0&&(i===void 0?i=j:i+="/"+j)}return i===void 0?".":p.normalize(i)},relative:function(i,h){if(c(i),c(h),i===h||(i=p.resolve(i),h=p.resolve(h),i===h))return"";for(var j=1;j<i.length&&i.charCodeAt(j)===47;++j);for(var C=i.length,l=C-j,v=1;v<h.length&&h.charCodeAt(v)===47;++v);for(var k=h.length,O=k-v,L=l<O?l:O,P=-1,E=0;E<=L;++E){if(E===L){if(O>L){if(h.charCodeAt(v+E)===47)return h.slice(v+E+1);if(E===0)return h.slice(v+E)}else l>L&&(i.charCodeAt(j+E)===47?P=E:E===0&&(P=0));break}var U=i.charCodeAt(j+E),M=h.charCodeAt(v+E);if(U!==M)break;U===47&&(P=E)}var w="";for(E=j+P+1;E<=C;++E)(E===C||i.charCodeAt(E)===47)&&(w.length===0?w+="..":w+="/..");return w.length>0?w+h.slice(v+P):(v+=P,h.charCodeAt(v)===47&&++v,h.slice(v))},_makeLong:function(i){return i},dirname:function(i){if(c(i),i.length===0)return".";for(var h=i.charCodeAt(0),j=h===47,C=-1,l=!0,v=i.length-1;v>=1;--v)if(h=i.charCodeAt(v),h===47){if(!l){C=v;break}}else l=!1;return C===-1?j?"/":".":j&&C===1?"//":i.slice(0,C)},basename:function(i,h){if(h!==void 0&&typeof h!="string")throw new TypeError('"ext" argument must be a string');c(i);var j=0,C=-1,l=!0,v;if(h!==void 0&&h.length>0&&h.length<=i.length){if(h.length===i.length&&h===i)return"";var k=h.length-1,O=-1;for(v=i.length-1;v>=0;--v){var L=i.charCodeAt(v);if(L===47){if(!l){j=v+1;break}}else O===-1&&(l=!1,O=v+1),k>=0&&(L===h.charCodeAt(k)?--k===-1&&(C=v):(k=-1,C=O))}return j===C?C=O:C===-1&&(C=i.length),i.slice(j,C)}else{for(v=i.length-1;v>=0;--v)if(i.charCodeAt(v)===47){if(!l){j=v+1;break}}else C===-1&&(l=!1,C=v+1);return C===-1?"":i.slice(j,C)}},extname:function(i){c(i);for(var h=-1,j=0,C=-1,l=!0,v=0,k=i.length-1;k>=0;--k){var O=i.charCodeAt(k);if(O===47){if(!l){j=k+1;break}continue}C===-1&&(l=!1,C=k+1),O===46?h===-1?h=k:v!==1&&(v=1):h!==-1&&(v=-1)}return h===-1||C===-1||v===0||v===1&&h===C-1&&h===j+1?"":i.slice(h,C)},format:function(i){if(i===null||typeof i!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof i);return A("/",i)},parse:function(i){c(i);var h={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return h;var j=i.charCodeAt(0),C=j===47,l;C?(h.root="/",l=1):l=0;for(var v=-1,k=0,O=-1,L=!0,P=i.length-1,E=0;P>=l;--P){if(j=i.charCodeAt(P),j===47){if(!L){k=P+1;break}continue}O===-1&&(L=!1,O=P+1),j===46?v===-1?v=P:E!==1&&(E=1):v!==-1&&(E=-1)}return v===-1||O===-1||E===0||E===1&&v===O-1&&v===k+1?O!==-1&&(k===0&&C?h.base=h.name=i.slice(1,O):h.base=h.name=i.slice(k,O)):(k===0&&C?(h.name=i.slice(1,v),h.base=i.slice(1,O)):(h.name=i.slice(k,v),h.base=i.slice(k,O)),h.ext=i.slice(v,O)),k>0?h.dir=i.slice(0,k-1):C&&(h.dir="/"),h},sep:"/",delimiter:":",win32:null,posix:null};p.posix=p,T.exports=p}).call(this)}).call(this,y("_process"))},{_process:43}],43:[function(y,T,m){var u=T.exports={},c,_;function A(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?c=setTimeout:c=A}catch{c=A}try{typeof clearTimeout=="function"?_=clearTimeout:_=p}catch{_=p}})();function f(P){if(c===setTimeout)return setTimeout(P,0);if((c===A||!c)&&setTimeout)return c=setTimeout,setTimeout(P,0);try{return c(P,0)}catch{try{return c.call(null,P,0)}catch{return c.call(this,P,0)}}}function i(P){if(_===clearTimeout)return clearTimeout(P);if((_===p||!_)&&clearTimeout)return _=clearTimeout,clearTimeout(P);try{return _(P)}catch{try{return _.call(null,P)}catch{return _.call(this,P)}}}var h=[],j=!1,C,l=-1;function v(){!j||!C||(j=!1,C.length?h=C.concat(h):l=-1,h.length&&k())}function k(){if(!j){var P=f(v);j=!0;for(var E=h.length;E;){for(C=h,h=[];++l<E;)C&&C[l].run();l=-1,E=h.length}C=null,j=!1,i(P)}}u.nextTick=function(P){var E=new Array(arguments.length-1);if(arguments.length>1)for(var U=1;U<arguments.length;U++)E[U-1]=arguments[U];h.push(new O(P,E)),h.length===1&&!j&&f(k)};function O(P,E){this.fun=P,this.array=E}O.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={};function L(){}u.on=L,u.addListener=L,u.once=L,u.off=L,u.removeListener=L,u.removeAllListeners=L,u.emit=L,u.prependListener=L,u.prependOnceListener=L,u.listeners=function(P){return[]},u.binding=function(P){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(P){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],44:[function(y,T,m){T.exports=function(c){return c&&typeof c=="object"&&typeof c.copy=="function"&&typeof c.fill=="function"&&typeof c.readUInt8=="function"}},{}],45:[function(y,T,m){var u=y("is-arguments"),c=y("is-generator-function"),_=y("which-typed-array"),A=y("is-typed-array");function p(s){return s.call.bind(s)}var f=typeof BigInt<"u",i=typeof Symbol<"u",h=p(Object.prototype.toString),j=p(Number.prototype.valueOf),C=p(String.prototype.valueOf),l=p(Boolean.prototype.valueOf);if(f)var v=p(BigInt.prototype.valueOf);if(i)var k=p(Symbol.prototype.valueOf);function O(s,B){if(typeof s!="object")return!1;try{return B(s),!0}catch{return!1}}m.isArgumentsObject=u,m.isGeneratorFunction=c,m.isTypedArray=A;function L(s){return typeof Promise<"u"&&s instanceof Promise||s!==null&&typeof s=="object"&&typeof s.then=="function"&&typeof s.catch=="function"}m.isPromise=L;function P(s){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):A(s)||e(s)}m.isArrayBufferView=P;function E(s){return _(s)==="Uint8Array"}m.isUint8Array=E;function U(s){return _(s)==="Uint8ClampedArray"}m.isUint8ClampedArray=U;function M(s){return _(s)==="Uint16Array"}m.isUint16Array=M;function w(s){return _(s)==="Uint32Array"}m.isUint32Array=w;function r(s){return _(s)==="Int8Array"}m.isInt8Array=r;function a(s){return _(s)==="Int16Array"}m.isInt16Array=a;function S(s){return _(s)==="Int32Array"}m.isInt32Array=S;function x(s){return _(s)==="Float32Array"}m.isFloat32Array=x;function N(s){return _(s)==="Float64Array"}m.isFloat64Array=N;function W(s){return _(s)==="BigInt64Array"}m.isBigInt64Array=W;function $(s){return _(s)==="BigUint64Array"}m.isBigUint64Array=$;function V(s){return h(s)==="[object Map]"}V.working=typeof Map<"u"&&V(new Map);function H(s){return typeof Map>"u"?!1:V.working?V(s):s instanceof Map}m.isMap=H;function q(s){return h(s)==="[object Set]"}q.working=typeof Set<"u"&&q(new Set);function G(s){return typeof Set>"u"?!1:q.working?q(s):s instanceof Set}m.isSet=G;function oe(s){return h(s)==="[object WeakMap]"}oe.working=typeof WeakMap<"u"&&oe(new WeakMap);function ne(s){return typeof WeakMap>"u"?!1:oe.working?oe(s):s instanceof WeakMap}m.isWeakMap=ne;function le(s){return h(s)==="[object WeakSet]"}le.working=typeof WeakSet<"u"&&le(new WeakSet);function ue(s){return le(s)}m.isWeakSet=ue;function g(s){return h(s)==="[object ArrayBuffer]"}g.working=typeof ArrayBuffer<"u"&&g(new ArrayBuffer);function I(s){return typeof ArrayBuffer>"u"?!1:g.working?g(s):s instanceof ArrayBuffer}m.isArrayBuffer=I;function Y(s){return h(s)==="[object DataView]"}Y.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Y(new DataView(new ArrayBuffer(1),0,1));function e(s){return typeof DataView>"u"?!1:Y.working?Y(s):s instanceof DataView}m.isDataView=e;var o=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function b(s){return h(s)==="[object SharedArrayBuffer]"}function z(s){return typeof o>"u"?!1:(typeof b.working>"u"&&(b.working=b(new o)),b.working?b(s):s instanceof o)}m.isSharedArrayBuffer=z;function J(s){return h(s)==="[object AsyncFunction]"}m.isAsyncFunction=J;function X(s){return h(s)==="[object Map Iterator]"}m.isMapIterator=X;function K(s){return h(s)==="[object Set Iterator]"}m.isSetIterator=K;function Z(s){return h(s)==="[object Generator]"}m.isGeneratorObject=Z;function ee(s){return h(s)==="[object WebAssembly.Module]"}m.isWebAssemblyCompiledModule=ee;function ce(s){return O(s,j)}m.isNumberObject=ce;function fe(s){return O(s,C)}m.isStringObject=fe;function he(s){return O(s,l)}m.isBooleanObject=he;function ye(s){return f&&O(s,v)}m.isBigIntObject=ye;function d(s){return i&&O(s,k)}m.isSymbolObject=d;function t(s){return ce(s)||fe(s)||he(s)||ye(s)||d(s)}m.isBoxedPrimitive=t;function n(s){return typeof Uint8Array<"u"&&(I(s)||z(s))}m.isAnyArrayBuffer=n,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(s){Object.defineProperty(m,s,{enumerable:!1,value:function(){throw new Error(s+" is not supported in userland")}})})},{"is-arguments":37,"is-generator-function":38,"is-typed-array":39,"which-typed-array":47}],46:[function(y,T,m){(function(u){(function(){var c=Object.getOwnPropertyDescriptors||function(o){for(var b=Object.keys(o),z={},J=0;J<b.length;J++)z[b[J]]=Object.getOwnPropertyDescriptor(o,b[J]);return z},_=/%[sdj%]/g;m.format=function(e){if(!a(e)){for(var o=[],b=0;b<arguments.length;b++)o.push(i(arguments[b]));return o.join(" ")}for(var b=1,z=arguments,J=z.length,X=String(e).replace(_,function(Z){if(Z==="%%")return"%";if(b>=J)return Z;switch(Z){case"%s":return String(z[b++]);case"%d":return Number(z[b++]);case"%j":try{return JSON.stringify(z[b++])}catch{return"[Circular]"}default:return Z}}),K=z[b];b<J;K=z[++b])M(K)||!W(K)?X+=" "+K:X+=" "+i(K);return X},m.deprecate=function(e,o){if(typeof u<"u"&&u.noDeprecation===!0)return e;if(typeof u>"u")return function(){return m.deprecate(e,o).apply(this,arguments)};var b=!1;function z(){if(!b){if(u.throwDeprecation)throw new Error(o);u.traceDeprecation?console.trace(o):console.error(o),b=!0}return e.apply(this,arguments)}return z};var A={},p=/^$/;if(u.env.NODE_DEBUG){var f=u.env.NODE_DEBUG;f=f.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),p=new RegExp("^"+f+"$","i")}m.debuglog=function(e){if(e=e.toUpperCase(),!A[e])if(p.test(e)){var o=u.pid;A[e]=function(){var b=m.format.apply(m,arguments);console.error("%s %d: %s",e,o,b)}}else A[e]=function(){};return A[e]};function i(e,o){var b={seen:[],stylize:j};return arguments.length>=3&&(b.depth=arguments[2]),arguments.length>=4&&(b.colors=arguments[3]),U(o)?b.showHidden=o:o&&m._extend(b,o),x(b.showHidden)&&(b.showHidden=!1),x(b.depth)&&(b.depth=2),x(b.colors)&&(b.colors=!1),x(b.customInspect)&&(b.customInspect=!0),b.colors&&(b.stylize=h),l(b,e,b.depth)}m.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function h(e,o){var b=i.styles[o];return b?"\x1B["+i.colors[b][0]+"m"+e+"\x1B["+i.colors[b][1]+"m":e}function j(e,o){return e}function C(e){var o={};return e.forEach(function(b,z){o[b]=!0}),o}function l(e,o,b){if(e.customInspect&&o&&H(o.inspect)&&o.inspect!==m.inspect&&!(o.constructor&&o.constructor.prototype===o)){var z=o.inspect(b,e);return a(z)||(z=l(e,z,b)),z}var J=v(e,o);if(J)return J;var X=Object.keys(o),K=C(X);if(e.showHidden&&(X=Object.getOwnPropertyNames(o)),V(o)&&(X.indexOf("message")>=0||X.indexOf("description")>=0))return k(o);if(X.length===0){if(H(o)){var Z=o.name?": "+o.name:"";return e.stylize("[Function"+Z+"]","special")}if(N(o))return e.stylize(RegExp.prototype.toString.call(o),"regexp");if($(o))return e.stylize(Date.prototype.toString.call(o),"date");if(V(o))return k(o)}var ee="",ce=!1,fe=["{","}"];if(E(o)&&(ce=!0,fe=["[","]"]),H(o)){var he=o.name?": "+o.name:"";ee=" [Function"+he+"]"}if(N(o)&&(ee=" "+RegExp.prototype.toString.call(o)),$(o)&&(ee=" "+Date.prototype.toUTCString.call(o)),V(o)&&(ee=" "+k(o)),X.length===0&&(!ce||o.length==0))return fe[0]+ee+fe[1];if(b<0)return N(o)?e.stylize(RegExp.prototype.toString.call(o),"regexp"):e.stylize("[Object]","special");e.seen.push(o);var ye;return ce?ye=O(e,o,b,K,X):ye=X.map(function(d){return L(e,o,b,K,d,ce)}),e.seen.pop(),P(ye,ee,fe)}function v(e,o){if(x(o))return e.stylize("undefined","undefined");if(a(o)){var b="'"+JSON.stringify(o).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(b,"string")}if(r(o))return e.stylize(""+o,"number");if(U(o))return e.stylize(""+o,"boolean");if(M(o))return e.stylize("null","null")}function k(e){return"["+Error.prototype.toString.call(e)+"]"}function O(e,o,b,z,J){for(var X=[],K=0,Z=o.length;K<Z;++K)ue(o,String(K))?X.push(L(e,o,b,z,String(K),!0)):X.push("");return J.forEach(function(ee){ee.match(/^\d+$/)||X.push(L(e,o,b,z,ee,!0))}),X}function L(e,o,b,z,J,X){var K,Z,ee;if(ee=Object.getOwnPropertyDescriptor(o,J)||{value:o[J]},ee.get?ee.set?Z=e.stylize("[Getter/Setter]","special"):Z=e.stylize("[Getter]","special"):ee.set&&(Z=e.stylize("[Setter]","special")),ue(z,J)||(K="["+J+"]"),Z||(e.seen.indexOf(ee.value)<0?(M(b)?Z=l(e,ee.value,null):Z=l(e,ee.value,b-1),Z.indexOf(`
`)>-1&&(X?Z=Z.split(`
`).map(function(ce){return"  "+ce}).join(`
`).substr(2):Z=`
`+Z.split(`
`).map(function(ce){return"   "+ce}).join(`
`))):Z=e.stylize("[Circular]","special")),x(K)){if(X&&J.match(/^\d+$/))return Z;K=JSON.stringify(""+J),K.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(K=K.substr(1,K.length-2),K=e.stylize(K,"name")):(K=K.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),K=e.stylize(K,"string"))}return K+": "+Z}function P(e,o,b){var z=e.reduce(function(J,X){return X.indexOf(`
`)>=0,J+X.replace(/\u001b\[\d\d?m/g,"").length+1},0);return z>60?b[0]+(o===""?"":o+`
 `)+" "+e.join(`,
  `)+" "+b[1]:b[0]+o+" "+e.join(", ")+" "+b[1]}m.types=y("./support/types");function E(e){return Array.isArray(e)}m.isArray=E;function U(e){return typeof e=="boolean"}m.isBoolean=U;function M(e){return e===null}m.isNull=M;function w(e){return e==null}m.isNullOrUndefined=w;function r(e){return typeof e=="number"}m.isNumber=r;function a(e){return typeof e=="string"}m.isString=a;function S(e){return typeof e=="symbol"}m.isSymbol=S;function x(e){return e===void 0}m.isUndefined=x;function N(e){return W(e)&&G(e)==="[object RegExp]"}m.isRegExp=N,m.types.isRegExp=N;function W(e){return typeof e=="object"&&e!==null}m.isObject=W;function $(e){return W(e)&&G(e)==="[object Date]"}m.isDate=$,m.types.isDate=$;function V(e){return W(e)&&(G(e)==="[object Error]"||e instanceof Error)}m.isError=V,m.types.isNativeError=V;function H(e){return typeof e=="function"}m.isFunction=H;function q(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e>"u"}m.isPrimitive=q,m.isBuffer=y("./support/isBuffer");function G(e){return Object.prototype.toString.call(e)}function oe(e){return e<10?"0"+e.toString(10):e.toString(10)}var ne=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function le(){var e=new Date,o=[oe(e.getHours()),oe(e.getMinutes()),oe(e.getSeconds())].join(":");return[e.getDate(),ne[e.getMonth()],o].join(" ")}m.log=function(){console.log("%s - %s",le(),m.format.apply(m,arguments))},m.inherits=y("inherits"),m._extend=function(e,o){if(!o||!W(o))return e;for(var b=Object.keys(o),z=b.length;z--;)e[b[z]]=o[b[z]];return e};function ue(e,o){return Object.prototype.hasOwnProperty.call(e,o)}var g=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;m.promisify=function(o){if(typeof o!="function")throw new TypeError('The "original" argument must be of type Function');if(g&&o[g]){var b=o[g];if(typeof b!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(b,g,{value:b,enumerable:!1,writable:!1,configurable:!0}),b}function b(){for(var z,J,X=new Promise(function(ee,ce){z=ee,J=ce}),K=[],Z=0;Z<arguments.length;Z++)K.push(arguments[Z]);K.push(function(ee,ce){ee?J(ee):z(ce)});try{o.apply(this,K)}catch(ee){J(ee)}return X}return Object.setPrototypeOf(b,Object.getPrototypeOf(o)),g&&Object.defineProperty(b,g,{value:b,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(b,c(o))},m.promisify.custom=g;function I(e,o){if(!e){var b=new Error("Promise was rejected with a falsy value");b.reason=e,e=b}return o(e)}function Y(e){if(typeof e!="function")throw new TypeError('The "original" argument must be of type Function');function o(){for(var b=[],z=0;z<arguments.length;z++)b.push(arguments[z]);var J=b.pop();if(typeof J!="function")throw new TypeError("The last argument must be of type Function");var X=this,K=function(){return J.apply(X,arguments)};e.apply(this,b).then(function(Z){u.nextTick(K.bind(null,null,Z))},function(Z){u.nextTick(I.bind(null,Z,K))})}return Object.setPrototypeOf(o,Object.getPrototypeOf(e)),Object.defineProperties(o,c(e)),o}m.callbackify=Y}).call(this)}).call(this,y("_process"))},{"./support/isBuffer":44,"./support/types":45,_process:43,inherits:36}],47:[function(y,T,m){(function(u){(function(){var c=y("foreach"),_=y("available-typed-arrays"),A=y("call-bind/callBound"),p=A("Object.prototype.toString"),f=y("has-tostringtag/shams")(),i=typeof globalThis>"u"?u:globalThis,h=_(),j=A("String.prototype.slice"),C={},l=y("es-abstract/helpers/getOwnPropertyDescriptor"),v=Object.getPrototypeOf;f&&l&&v&&c(h,function(L){if(typeof i[L]=="function"){var P=new i[L];if(Symbol.toStringTag in P){var E=v(P),U=l(E,Symbol.toStringTag);if(!U){var M=v(E);U=l(M,Symbol.toStringTag)}C[L]=U.get}}});var k=function(P){var E=!1;return c(C,function(U,M){if(!E)try{var w=U.call(P);w===M&&(E=w)}catch{}}),E},O=y("is-typed-array");T.exports=function(P){return O(P)?!f||!(Symbol.toStringTag in P)?j(p(P),8,-1):k(P):!1}}).call(this)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":17,"call-bind/callBound":21,"es-abstract/helpers/getOwnPropertyDescriptor":25,foreach:27,"has-tostringtag/shams":33,"is-typed-array":39}],rhea:[function(y,T,m){(function(u){(function(){var c=y("./connection.js"),_=y("./log.js"),A=y("./sasl.js"),p=y("./util.js"),f=y("./eventTypes.js"),i=y("net"),h=y("tls"),j=y("events").EventEmitter,C=function(v){this.options=v?Object.create(v):{},this.options.id||(this.options.id=p.generate_uuid()),this.id=this.options.id,this.sasl_server_mechanisms=A.server_mechanisms()};C.prototype=Object.create(j.prototype),C.prototype.constructor=C,C.prototype.dispatch=function(v){return _.events("[%s] Container got event: "+v,this.id),j.prototype.emit.apply(this,arguments),!!this.listeners(v).length},C.prototype.connect=function(v){return new c(v,this).connect()},C.prototype.create_connection=function(v){return new c(v,this)},C.prototype.listen=function(v){var k=this,O;if(v.transport===void 0||v.transport==="tcp")O=i.createServer(v),O.on("connection",function(L){new c(v,k).accept(L)});else if(v.transport==="tls"||v.transport==="ssl")O=h.createServer(v),O.on("secureConnection",function(L){new c(v,k).accept(L)});else throw Error("Unrecognised transport: "+v.transport);return u.version.match(/v0\.10\.\d+/)?O.listen(v.port,v.host):O.listen(v),O},C.prototype.create_container=function(v){return new C(v)},C.prototype.get_option=function(v,k){return this.options[v]!==void 0?this.options[v]:k},C.prototype.generate_uuid=p.generate_uuid,C.prototype.string_to_uuid=p.string_to_uuid,C.prototype.uuid_to_string=p.uuid_to_string;var l=y("./ws.js");C.prototype.websocket_accept=function(v,k){new c(k,this).accept(l.wrap(v))},C.prototype.websocket_connect=l.connect,C.prototype.filter=y("./filter.js"),C.prototype.types=y("./types.js"),C.prototype.message=y("./message.js"),C.prototype.sasl=A,C.prototype.ReceiverEvents=f.ReceiverEvents,C.prototype.SenderEvents=f.SenderEvents,C.prototype.SessionEvents=f.SessionEvents,C.prototype.ConnectionEvents=f.ConnectionEvents,T.exports=new C}).call(this)}).call(this,y("_process"))},{"./connection.js":1,"./eventTypes.js":4,"./filter.js":5,"./log.js":8,"./message.js":9,"./sasl.js":10,"./types.js":14,"./util.js":15,"./ws.js":16,_process:43,events:26,net:19,tls:19}]},{},[])("rhea")})})(Ee)),Ee.exports}var ct=at();const _e=st(ct);class de{constructor(F,y){this.connection=null,this.cbsAuthenticated=!1,this.namespace=F,this.token=y,this.hostname=`${F}.servicebus.windows.net`}async connect(){return new Promise((F,y)=>{const T=`wss://${this.hostname}:443/$servicebus/websocket`,m=_e.websocket_connect(WebSocket);this.connection=_e.connect({connection_details:m(T,["AMQPWSB10"],{}),host:this.hostname,hostname:this.hostname,port:443,transport:"ssl",reconnect:!1}),this.connection.on("connection_open",()=>{F()}),this.connection.on("connection_error",u=>{y(new Error(u.error?u.error.toString():"Connection error"))}),this.connection.on("disconnected",u=>{u.error&&!this.cbsAuthenticated&&y(new Error(u.error.toString()))})})}async authenticateCBS(F){if(!this.connection)throw new Error("Connection not established");return new Promise((y,T)=>{const m=this.connection.open_sender("$cbs"),u=this.connection.open_receiver("$cbs");u.on("message",c=>{const _=c.message.application_properties["status-code"],A=c.message.application_properties["status-description"];u.close(),m.close(),_===200||_===202?(this.cbsAuthenticated=!0,y({statusCode:_,statusDesc:A})):T(new Error(`CBS auth failed: ${_} - ${A}`))}),m.on("sender_open",()=>{const c={application_properties:{operation:"put-token",type:"jwt",name:`sb://${this.hostname}/${F}`},body:this.token};m.send(c)}),setTimeout(()=>T(new Error("CBS authentication timeout")),1e4)})}close(){this.connection&&this.connection.close()}}class ve{constructor(F,y){this.sender=null,this.receiver=null,this.replyTo=null,this.connection=F,this.entityPath=y,this.managementAddress=`${y}/$management`}async open(){if(!this.connection.connection)throw new Error("Connection not established");return new Promise((F,y)=>{this.replyTo=`mgmt-reply-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,this.sender=this.connection.connection.open_sender({target:{address:this.managementAddress}}),this.receiver=this.connection.connection.open_receiver({source:{address:this.managementAddress},target:{address:this.replyTo}});let T=!1,m=!1;const u=()=>{T&&m&&F()};this.sender.on("sender_open",()=>{T=!0,u()}),this.receiver.on("receiver_open",()=>{m=!0,u()}),this.sender.on("sender_error",c=>{y(new Error(c.sender.error?c.sender.error.toString():"Sender error"))}),this.receiver.on("receiver_error",c=>{y(new Error(c.receiver.error?c.receiver.error.toString():"Receiver error"))}),setTimeout(()=>y(new Error("Management client open timeout")),1e4)})}async peekMessages(F=0,y=1){if(!this.sender||!this.receiver||!this.replyTo)throw new Error("Management client not opened");return new Promise((T,m)=>{const u=this.replyTo,c=p=>{const f=p.message.application_properties?.statusCode,i=p.message.application_properties?.statusDescription;if(f===200||f===204){const h=p.message.body;let j=[];if(f===204){T([]),this.receiver.removeListener("message",c);return}if(h&&h.messages){const C=Array.isArray(h.messages)?h.messages:[h.messages];for(const l of C)if(l.message)try{const v=ut(l.message);j.push(v)}catch(v){console.error("Failed to decode message:",v)}}T(j)}else m(new Error(`Peek failed: ${f} - ${i}`));this.receiver.removeListener("message",c)};this.receiver.on("message",c);const _={};_["from-sequence-number"]=_e.types.wrap_long(F),_["message-count"]=_e.types.wrap_int(y);const A={body:_,reply_to:u,application_properties:{operation:"com.microsoft:peek-message"},message_id:`peek-${Date.now()}`};this.sender.send(A),setTimeout(()=>{this.receiver.removeListener("message",c),m(new Error("Peek request timeout"))},1e4)})}async deleteMessagesBySequenceNumbers(F){if(!this.sender||!this.receiver||!this.replyTo)throw new Error("Management client not opened");return new Promise((y,T)=>{const m=this.replyTo,u=p=>{const f=p.message.application_properties?.statusCode,i=p.message.application_properties?.statusDescription;f===200||f===204?y():T(new Error(`Delete failed: ${f} - ${i}`)),this.receiver.removeListener("message",u)};this.receiver.on("message",u);const c=F.map(p=>{const f=globalThis.Buffer.alloc(8);return f.writeBigInt64BE(BigInt(p)),f}),_={};_["sequence-numbers"]=_e.types.wrap_array(c,129,void 0),_["receiver-settle-mode"]=_e.types.wrap_uint(0);const A={body:_,reply_to:m,application_properties:{operation:"com.microsoft:receive-by-sequence-number"},message_id:`delete-${Date.now()}`};this.sender.send(A),setTimeout(()=>{this.receiver.removeListener("message",u),T(new Error("Delete request timeout"))},1e4)})}close(){this.sender&&this.sender.close(),this.receiver&&this.receiver.close()}}function ut(R){let F;if(R.type==="Buffer"&&Array.isArray(R.data))F=new Uint8Array(R.data);else if(R instanceof Uint8Array)F=R;else throw new Error("Invalid message buffer format");return _e.message.decode(F)}class Ce{constructor(F,y,T={}){this.receiver=null,this.messageCount=0,this.connection=F,this.queueName=y,this.options={peekMode:T.peekMode||!1,maxMessages:T.maxMessages??null,autoClose:T.autoClose!==!1}}receive(F,y){if(!this.connection.connection)throw new Error("Connection not established");const T=this.options.peekMode?1:0;this.receiver=this.connection.connection.open_receiver({source:{address:this.queueName},credit_window:this.options.maxMessages||10,autoaccept:!this.options.peekMode,rcv_settle_mode:T}),this.receiver.on("message",m=>{this.messageCount++,F&&F(m.message),this.options.maxMessages&&this.messageCount>=this.options.maxMessages&&this.options.autoClose&&(this.close(),this.connection.close())}),this.receiver.on("receiver_error",m=>{if(y){const u=m.receiver.error;y(new Error(u?u.toString():"Receiver error"))}})}close(){this.receiver&&this.receiver.close()}}class ge{constructor(F,y){this.sender=null,this.connection=F,this.entityPath=y}async open(){if(!this.connection.connection)throw new Error("Connection not established");return new Promise((F,y)=>{this.sender=this.connection.connection.open_sender({target:{address:this.entityPath}}),this.sender.on("sender_open",()=>{F()}),this.sender.on("sender_error",T=>{y(new Error(T.sender.error?T.sender.error.toString():"Sender error"))}),setTimeout(()=>y(new Error("Sender open timeout")),5e3)})}async send(F,y={}){if(!this.sender)throw new Error("Sender not opened. Call open() first.");const T=y.message_id||y.messageId||`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;let m,u=y.content_type||y.contentType;typeof F=="string"?(m=new TextEncoder().encode(F),u=u||"text/plain"):F instanceof Uint8Array?(m=F,u=u||"application/octet-stream"):F instanceof ArrayBuffer?(m=new Uint8Array(F),u=u||"application/octet-stream"):(m=new TextEncoder().encode(JSON.stringify(F)),u=u||"application/json");const c={body:m,content_type:u,message_id:T,creation_time:new Date,...y};return delete c.contentType,delete c.messageId,new Promise((_,A)=>{const p=()=>{try{this.sender.send(c),_()}catch(f){A(f)}};this.sender.sendable()?p():(this.sender.once("sendable",p),setTimeout(()=>{this.sender.removeListener("sendable",p),A(new Error("Send timeout - sender not ready"))},5e3))})}close(){this.sender&&this.sender.close()}}function be(R){const F=Te(R.body);return{messageId:R.message_id,body:F,contentType:R.content_type,deliveryCount:R.delivery_count||0,enqueuedTime:R.message_annotations?.["x-opt-enqueued-time"],sequenceNumber:R.message_annotations?.["x-opt-sequence-number"],lockedUntil:R.message_annotations?.["x-opt-locked-until"],applicationProperties:R.application_properties||{},properties:R.properties||{},ttl:R.ttl,expiryTime:R.absolute_expiry_time,creationTime:R.creation_time}}function Te(R){if(typeof R=="string")return R;if(R&&typeof R=="object"&&R.typecode===117&&(R=R.content),R instanceof Uint8Array)return new TextDecoder("utf-8").decode(R);if(R&&R.type==="Buffer"&&Array.isArray(R.data)){const F=new Uint8Array(R.data);return new TextDecoder("utf-8").decode(F)}if(R&&typeof R=="object"&&R.typecode!==void 0){if(R.value!==void 0)return Te(R.value);if(R.content!==void 0)return Te(R.content)}return R}async function Pe(R,F,y,T=10,m=0){return await Ae(R,F,y,T,m)}async function je(R,F,y,T,m=10,u=0){const c=`${F}/subscriptions/${y}`;return await Ae(R,c,T,m,u)}async function Ae(R,F,y,T=10,m=0){const u=new de(R,y);try{await u.connect(),await u.authenticateCBS(F);const c=new ve(u,F);await c.open();const _=await c.peekMessages(m,T);return c.close(),u.close(),_.map(A=>be(A))}catch(c){throw u.close(),new Error(`Peek failed: ${c.message}`)}}async function Ie(R,F,y,T,m={}){return await Be(R,F,y,T,m)}async function Oe(R,F,y,T,m={}){return await Be(R,F,y,T,m)}async function Be(R,F,y,T,m={}){const u=new de(R,y);try{await u.connect(),await u.authenticateCBS(F);const c=new ge(u,F);await c.open(),await c.send(T,m),c.close(),u.close()}catch(c){throw u.close(),new Error(`Send failed: ${c.message}`)}}async function Ue(R,F,y,T=5){return await xe(R,F,y,T)}async function Me(R,F,y,T,m=5){const u=`${F}/subscriptions/${y}`;return await xe(R,u,T,m)}async function xe(R,F,y,T=5){const m=new de(R,y);try{await m.connect(),await m.authenticateCBS(F);const u=new Ce(m,F,{peekMode:!1,maxMessages:1,autoClose:!0});return new Promise((c,_)=>{let A=!1;u.receive(p=>{A=!0,m.close(),c(be(p))},p=>{m.close(),_(new Error(`Receive failed: ${p.message}`))}),setTimeout(()=>{A||(u.close(),m.close(),c(null))},T*1e3)})}catch(u){throw m.close(),new Error(`Receive failed: ${u.message}`)}}const me=new Map;async function Fe(R,F,y,T=5){return await Re(R,F,y,T)}async function Le(R,F,y,T,m=5){const u=`${F}/subscriptions/${y}`;return await Re(R,u,T,m)}async function Re(R,F,y,T=5){const m=new de(R,y);try{return await m.connect(),await m.authenticateCBS(F),new Promise((u,c)=>{let _=!1;const A=m.connection.open_receiver({source:{address:F},credit_window:1,autoaccept:!1,rcv_settle_mode:1});A.on("message",p=>{_=!0;const f=be(p.message),i=p.delivery.tag.toString("hex");f.lockToken=i,f._delivery=p.delivery,me.set(i,{delivery:p.delivery,receiver:A,connection:m}),u(f)}),A.on("receiver_error",p=>{m.close(),c(new Error(p.receiver.error?p.receiver.error.toString():"Receiver error"))}),setTimeout(()=>{_||(A.close(),m.close(),u(null))},T*1e3)})}catch(u){throw m.close(),new Error(`Receive and lock failed: ${u.message}`)}}async function Ne(R){const F=me.get(R);if(!F)throw new Error("Message not found or lock expired");try{F.delivery.accept(),F.receiver.close(),F.connection.close(),me.delete(R)}catch(y){throw new Error(`Complete failed: ${y.message}`)}}async function De(R){const F=me.get(R);if(!F)throw new Error("Message not found or lock expired");try{F.delivery.release(),F.receiver.close(),F.connection.close(),me.delete(R)}catch(y){throw new Error(`Abandon failed: ${y.message}`)}}async function $e(R,F={}){const y=me.get(R);if(!y)throw new Error("Message not found or lock expired");try{y.delivery.modified({delivery_failed:!0,undeliverable_here:!0,message_annotations:{"x-opt-deadletter-reason":F.deadLetterReason||"Manual dead letter","x-opt-deadletter-error-description":F.deadLetterErrorDescription||""}}),y.receiver.close(),y.connection.close(),me.delete(R)}catch(T){throw new Error(`Dead letter failed: ${T.message}`)}}async function We(R){const F=me.get(R);if(!F)throw new Error("Message not found or lock expired");try{F.delivery.modified({delivery_failed:!1}),F.receiver.close(),F.connection.close(),me.delete(R)}catch(y){throw new Error(`Defer failed: ${y.message}`)}}async function ze(R,F,y,T=null){return await Ge(R,F,y,T)}async function Qe(R,F,y,T,m=null){const u=`${F}/subscriptions/${y}`;return await Ge(R,u,T,m)}async function Ge(R,F,y,T=null){const m=new de(R,y);let u=!0,c=0;try{await m.connect(),await m.authenticateCBS(F);const _=new Ce(m,F,{peekMode:!1,maxMessages:null,autoClose:!1});return{promise:new Promise((p,f)=>{let i=null;_.receive(h=>{c++,T&&T(c),i&&clearTimeout(i),i=setTimeout(()=>{u&&(_.close(),m.close(),p(c))},2e3)},h=>{_.close(),m.close(),f(new Error(`Purge failed: ${h.message}`))})}),stop:()=>(u=!1,_.close(),m.close(),c),getCount:()=>c}}catch(_){throw m.close(),new Error(`Purge failed: ${_.message}`)}}async function Ye(R,F,y,T,m){return await Ve(R,F,y,T,m)}async function Je(R,F,y,T,m,u){const c=`${F}/subscriptions/${y}`;return await Ve(R,c,T,m,u)}async function Ve(R,F,y,T,m){const u=new de(R,y);try{await u.connect(),await u.authenticateCBS(F);const c=new Ce(u,F,{peekMode:!0,maxMessages:null,autoClose:!1});return c.receive(_=>T(be(_)),m),{stop:()=>{c.close(),u.close()}}}catch(c){throw u.close(),new Error(`Monitor failed: ${c.message}`)}}async function He(R,F,y,T){return await Ke(R,F,y,T)}async function Xe(R,F,y,T,m){const u=`${F}/subscriptions/${y}`;return await Ke(R,u,T,m)}async function Ke(R,F,y,T){const m=new de(R,y);try{await m.connect(),await m.authenticateCBS(F);const u=new ve(m,F);return await u.open(),await u.deleteMessagesBySequenceNumbers(T),u.close(),m.close(),{successCount:T.length,failureCount:0,errors:[]}}catch(u){return m.close(),{successCount:0,failureCount:T.length,errors:T.map(c=>({messageId:c.toString(),error:u.message}))}}}async function Ze(R,F,y,T){const m=new de(R,y),u={successCount:0,failureCount:0,errors:[]};try{await m.connect(),await m.authenticateCBS(F);const c=new ve(m,F);await c.open();const A=(await c.peekMessages(0,1e3)).filter(f=>T.includes(f.message_annotations?.["x-opt-sequence-number"]));if(A.length===0)return c.close(),m.close(),u;const p=new ge(m,F);await p.open();for(const f of A)try{await p.send(f.body,{content_type:f.content_type,application_properties:f.application_properties}),u.successCount++}catch(i){u.failureCount++,u.errors.push({messageId:f.message_id||"unknown",error:i.message})}return p.close(),await c.deleteMessagesBySequenceNumbers(T),c.close(),m.close(),u}catch(c){throw m.close(),new Error(`Resend failed: ${c.message}`)}}async function qe(R,F,y,T=10,m=0){const u=`${F}/$DeadLetterQueue`;return await Ae(R,u,y,T,m)}async function et(R,F,y,T,m=10,u=0){const c=`${F}/subscriptions/${y}/$DeadLetterQueue`;return await Ae(R,c,T,m,u)}async function tt(R,F,y,T){const m=`${F}/$DeadLetterQueue`,u=new de(R,y),c={successCount:0,failureCount:0,errors:[]};try{await u.connect(),await u.authenticateCBS(m);const _=new ve(u,m);await _.open();const p=(await _.peekMessages(0,1e3)).filter(i=>T.includes(i.message_annotations?.["x-opt-sequence-number"]));if(p.length===0)return _.close(),u.close(),c;await u.authenticateCBS(F);const f=new ge(u,F);await f.open();for(const i of p)try{await f.send(i.body,{content_type:i.content_type,application_properties:i.application_properties}),c.successCount++}catch(h){c.failureCount++,c.errors.push({messageId:i.message_id||"unknown",error:h.message})}return f.close(),await u.authenticateCBS(m),await _.deleteMessagesBySequenceNumbers(T),_.close(),u.close(),c}catch(_){throw u.close(),new Error(`Resubmit from DLQ failed: ${_.message}`)}}async function rt(R,F,y,T,m){const u=`${F}/subscriptions/${y}/$DeadLetterQueue`,c=new de(R,T),_={successCount:0,failureCount:0,errors:[]};try{await c.connect(),await c.authenticateCBS(u);const A=new ve(c,u);await A.open();const f=(await A.peekMessages(0,1e3)).filter(h=>m.includes(h.message_annotations?.["x-opt-sequence-number"]));if(f.length===0)return A.close(),c.close(),_;await c.authenticateCBS(F);const i=new ge(c,F);await i.open();for(const h of f)try{await i.send(h.body,{content_type:h.content_type,application_properties:h.application_properties}),_.successCount++}catch(j){_.failureCount++,_.errors.push({messageId:h.message_id||"unknown",error:j.message})}return i.close(),await c.authenticateCBS(u),await A.deleteMessagesBySequenceNumbers(m),A.close(),c.close(),_}catch(A){throw c.close(),new Error(`Resubmit from DLQ failed: ${A.message}`)}}async function nt(R,F,y,T,m){const u=`${F}/subscriptions/${y}`,c=new de(R,T),_={successCount:0,failureCount:0,errors:[]};try{await c.connect(),await c.authenticateCBS(u);const A=new ve(c,u);await A.open();const f=(await A.peekMessages(0,1e3)).filter(h=>m.includes(h.message_annotations?.["x-opt-sequence-number"]));if(f.length===0)return A.close(),c.close(),_;await c.authenticateCBS(F);const i=new ge(c,F);await i.open();for(const h of f)try{await i.send(h.body,{content_type:h.content_type,application_properties:h.application_properties}),_.successCount++}catch(j){_.failureCount++,_.errors.push({messageId:h.message_id||"unknown",error:j.message})}return i.close(),await c.authenticateCBS(u),await A.deleteMessagesBySequenceNumbers(m),A.close(),c.close(),_}catch(A){throw c.close(),new Error(`Resend failed: ${A.message}`)}}window.ServiceBusAPI={peekQueueMessages:Pe,sendQueueMessage:Ie,receiveQueueMessage:Ue,purgeQueue:ze,monitorQueue:Ye,deleteQueueMessages:He,resendQueueMessages:Ze,receiveAndLockQueueMessage:Fe,receiveAndLockSubscriptionMessage:Le,completeMessage:Ne,abandonMessage:De,deadLetterMessage:$e,deferMessage:We,peekQueueDeadLetterMessages:qe,resubmitQueueDeadLetterMessages:tt,peekSubscriptionMessages:je,sendTopicMessage:Oe,receiveSubscriptionMessage:Me,purgeSubscription:Qe,monitorSubscription:Je,deleteSubscriptionMessages:Xe,resendSubscriptionMessages:nt,peekSubscriptionDeadLetterMessages:et,resubmitSubscriptionDeadLetterMessages:rt},ie.abandonMessage=De,ie.completeMessage=Ne,ie.deadLetterMessage=$e,ie.deferMessage=We,ie.deleteQueueMessages=He,ie.deleteSubscriptionMessages=Xe,ie.monitorQueue=Ye,ie.monitorSubscription=Je,ie.peekQueueDeadLetterMessages=qe,ie.peekQueueMessages=Pe,ie.peekSubscriptionDeadLetterMessages=et,ie.peekSubscriptionMessages=je,ie.purgeQueue=ze,ie.purgeSubscription=Qe,ie.receiveAndLockQueueMessage=Fe,ie.receiveAndLockSubscriptionMessage=Le,ie.receiveQueueMessage=Ue,ie.receiveSubscriptionMessage=Me,ie.resendQueueMessages=Ze,ie.resendSubscriptionMessages=nt,ie.resubmitQueueDeadLetterMessages=tt,ie.resubmitSubscriptionDeadLetterMessages=rt,ie.sendQueueMessage=Ie,ie.sendTopicMessage=Oe,Object.defineProperty(ie,Symbol.toStringTag,{value:"Module"})})(this.ServiceBusAPI=this.ServiceBusAPI||{});

(function(le){"use strict";function Je($){return $&&$.__esModule&&Object.prototype.hasOwnProperty.call($,"default")?$.default:$}function ve($){throw new Error('Could not dynamically require "'+$+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var be={exports:{}},Se;function Ve(){return Se||(Se=1,(function($,R){(function(m){$.exports=m()})(function(){return(function(){function m(k,v,l){function u(d,h){if(!v[d]){if(!k[d]){var i=typeof ve=="function"&&ve;if(!h&&i)return i(d,!0);if(_)return _(d,!0);var p=new Error("Cannot find module '"+d+"'");throw p.code="MODULE_NOT_FOUND",p}var j=v[d]={exports:{}};k[d][0].call(j.exports,function(T){var c=k[d][1][T];return u(c||T)},j,j.exports,m,k,v,l)}return v[d].exports}for(var _=typeof ve=="function"&&ve,A=0;A<l.length;A++)u(l[A]);return u}return m})()({1:[function(m,k,v){(function(l,u){(function(){var _=m("./errors.js"),A=m("./frames.js"),d=m("./log.js"),h=m("./sasl.js"),i=m("./util.js"),p=m("./endpoint.js"),j=m("./session.js"),T=m("./transport.js"),c=m("fs"),y=m("os"),C=m("path"),I=m("net"),F=m("tls"),P=m("events").EventEmitter,S=0;function B(){var g;l.env.MESSAGING_CONNECT_FILE?g=[l.env.MESSAGING_CONNECT_FILE]:g=[l.cwd(),C.join(y.homedir(),".config/messaging"),"/etc/messaging"].map(function(e){return C.join(e,"/connect.json")});for(var O=0;O<g.length;O++)if(c.existsSync(g[O])){var Y=JSON.parse(c.readFileSync(g[O],"utf8"));return d.config("using config from %s: %j",g[O],Y),Y}return{}}function x(){var g=B(),O={};return g.scheme==="amqps"&&(O.transport="tls"),g.host&&(O.host=g.host),g.port==="amqp"?O.port=5672:g.port==="amqps"?O.port=5671:O.port=g.port,g.sasl&&g.sasl.enabled===!1||(g.user?O.username=g.user:O.username="anonymous",g.password&&(O.password=g.password),g.sasl_mechanisms&&(O.sasl_mechanisms=g.sasl_mechanisms)),g.tls&&(g.tls.key&&(O.key=c.readFileSync(g.tls.key)),g.tls.cert&&(O.cert=c.readFileSync(g.tls.cert)),g.tls.ca&&(O.ca=[c.readFileSync(g.tls.ca)]),(g.verify===!1||g.tls.verify===!1)&&(O.rejectUnauthorized=!1)),O.transport==="tls"&&(O.servername=O.host),O}function w(g){return g.get_id_string?g.get_id_string():g.localAddress+":"+g.localPort+" -> "+g.remoteAddress+":"+g.remotePort}function r(g){var O=null;return{get_session:function(){return O||(O=g.create_session(),O.observers.on("session_close",function(){O=null}),O.begin()),O}}}function a(g,O){if(g){var Y=g,e;return function(o){return e!==o&&(Y=g,e=o),Y--?O(o):-1}}else return O}function E(g,O){var Y=g,e;return function(o){e!==o&&(Y=g,e=o);var b=Y,z=Y*2;return Y=O>z?z:O,b}}function M(g){if(g.transport===void 0||g.transport==="tcp")return I.connect;if(g.transport==="tls"||g.transport==="ssl")return F.connect;throw Error("Unrecognised transport: "+g.transport)}function L(g){var O={};return O.connect=g.connect?g.connect:M(g),O.host=g.host?g.host:"localhost",O.port=g.port?g.port:5672,O.options=g,O}var W=["container_id","hostname","max_frame_size","channel_max","idle_time_out","outgoing_locales","incoming_locales","offered_capabilities","desired_capabilities","properties"];function D(g){return function(){return this.remote.open?this.remote.open[g]:void 0}}function V(g){var O={};return W.forEach(function(Y){g[Y]!==void 0&&(O[Y]=g[Y])}),O}function H(g,O){if(typeof g=="boolean")if(g){var Y=O.get_option("initial_reconnect_delay",100),e=O.get_option("max_reconnect_delay",6e4);O.options.reconnect=a(O.get_option("reconnect_limit"),E(Y,e))}else O.options.reconnect=!1;else if(typeof g=="number"){var o=O.options.reconnect;O.options.reconnect=a(O.get_option("reconnect_limit"),function(){return o})}}var q=1,Q=function(g,O){if(this.options={},g){for(var Y in g)this.options[Y]=g[Y];(g.transport==="tls"||g.transport==="ssl")&&g.servername===void 0&&g.host!==void 0&&(this.options.servername=g.host)}else this.options=x();if(this.container=O,this.options.id||(this.options.id="connection-"+q++),this.options.container_id||(this.options.container_id=O?O.id:i.generate_uuid()),!this.options.connection_details){var o=this;this.options.connection_details=function(){return L(o.options)}}var e=this.get_option("reconnect",!0);H(e,this),this.registered=!1,this.state=new p,this.local_channel_map={},this.remote_channel_map={},this.local={},this.remote={},this.local.open=A.open(V(this.options)),this.local.close=A.close({}),this.session_policy=r(this),this.amqp_transport=new T(this.options.id,S,A.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.conn_established_counter=0,this.heartbeat_out=void 0,this.heartbeat_in=void 0,this.abort_idle=void 0,this.socket_ready=!1,this.scheduled_reconnect=void 0,this.default_sender=void 0,this.closed_with_non_fatal_error=!1;var o=this;W.forEach(function(b){Object.defineProperty(o,b,{get:D(b)})}),Object.defineProperty(this,"error",{get:function(){return this.remote.close?this.remote.close.error:void 0}})};Q.prototype=Object.create(P.prototype),Q.prototype.constructor=Q,Q.prototype.dispatch=function(g){return d.events("[%s] Connection got event: %s",this.options.id,g),this.listeners(g).length?(P.prototype.emit.apply(this,arguments),!0):this.container?this.container.dispatch.apply(this.container,arguments):!1},Q.prototype._disconnect=function(){this.state.disconnected();for(var g in this.local_channel_map)this.local_channel_map[g]._disconnect();this.socket_ready=!1},Q.prototype._reconnect=function(){this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0,this.local.close.error=void 0,this.state=new p,this.state.open()),this.state.reconnect(),this._reset_remote_state()},Q.prototype._reset_remote_state=function(){this.amqp_transport=new T(this.options.id,S,A.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.remote={},this.remote_channel_map={};var g=this.local_channel_map;for(var O in g)g[O]._reconnect()},Q.prototype.connect=function(){return this.is_server=!1,this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0),this._reset_remote_state(),this._connect(this.options.connection_details(this.conn_established_counter)),this.open(),this},Q.prototype.reconnect=function(){return this.scheduled_reconnect=void 0,d.reconnect("[%s] reconnecting...",this.options.id),this._reconnect(),this._connect(this.options.connection_details(this.conn_established_counter)),l.nextTick(this._process.bind(this)),this},Q.prototype.set_reconnect=function(g){H(g,this)},Q.prototype._connect=function(g){return g.connect?this.init(g.connect(g.port,g.host,g.options,this.connected.bind(this))):this.init(M(g)(g.port,g.host,g.options,this.connected.bind(this))),this},Q.prototype.accept=function(g){return this.is_server=!0,d.io("[%s] client accepted: %s",this.id,w(g)),this.socket_ready=!0,this.init(g)},Q.prototype.abort_socket=function(g){g===this.socket&&(this.abort_idle=void 0,d.io("[%s] aborting socket",this.options.id),this.socket.end(),this.socket.removeAllListeners&&(this.socket.removeAllListeners("data"),this.socket.removeAllListeners("error"),this.socket.removeAllListeners("end")),typeof this.socket.destroy=="function"&&this.socket.destroy(),this._disconnected())},Q.prototype.init=function(g){if(this.socket=g,this.get_option("tcp_no_delay",!1)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.socket.on("data",this.input.bind(this)),this.socket.on("error",this.on_error.bind(this)),this.socket.on("end",this.eof.bind(this)),this.is_server){var O;if(this.container&&Object.getOwnPropertyNames(this.container.sasl_server_mechanisms).length&&(O=this.container.sasl_server_mechanisms),this.socket.encrypted&&this.socket.authorized&&this.get_option("enable_sasl_external",!1)&&(O=h.server_add_external(O?i.clone(O):{})),O)O.ANONYMOUS!==void 0&&!this.get_option("require_sasl",!1)?this.sasl_transport=new h.Selective(this,O):this.sasl_transport=new h.Server(this,O);else if(!this.get_option("disable_sasl",!1)){var Y=h.server_mechanisms();Y.enable_anonymous(),this.sasl_transport=new h.Selective(this,Y)}}else{var e=this.get_option("sasl_mechanisms");if(!e){var o=this.get_option("username"),b=this.get_option("password"),z=this.get_option("token");o&&(e=h.client_mechanisms(),b?e.enable_plain(o,b):z?e.enable_xoauth2(o,z):e.enable_anonymous(o))}this.socket.encrypted&&this.options.cert&&this.get_option("enable_sasl_external",!1)&&(e||(e=h.client_mechanisms()),e.enable_external()),e&&(this.sasl_transport=new h.Client(this,e,this.options.sasl_init_hostname||this.options.servername||this.options.host))}return this.transport=this.sasl_transport?this.sasl_transport:this.amqp_transport,this},Q.prototype.attach_sender=function(g){return this.session_policy.get_session().attach_sender(g)},Q.prototype.open_sender=Q.prototype.attach_sender,Q.prototype.attach_receiver=function(g){return this.get_option("tcp_no_delay",!0)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.session_policy.get_session().attach_receiver(g)},Q.prototype.open_receiver=Q.prototype.attach_receiver,Q.prototype.get_option=function(g,O){return this.options[g]!==void 0?this.options[g]:this.container?this.container.get_option(g,O):O},Q.prototype.send=function(g){return this.default_sender===void 0&&(this.default_sender=this.open_sender({target:{}})),this.default_sender.send(g)},Q.prototype.connected=function(){this.socket_ready=!0,this.conn_established_counter++,d.io("[%s] connected %s",this.options.id,w(this.socket)),this.output()},Q.prototype.sasl_failed=function(g,O){this.transport_error=new _.ConnectionError(g,O||"amqp:unauthorized-access",this),this._handle_error(),this.socket.end()},Q.prototype._is_fatal=function(g){var O=this.get_option("all_errors_non_fatal",!1);if(O)return!1;var Y=this.get_option("non_fatal_errors",["amqp:connection:forced"]);return Y.indexOf(g)<0},Q.prototype._handle_error=function(){var g=this.get_error();if(g){var O=this.dispatch("connection_error",this._context({error:g}));return O=this.dispatch("connection_close",this._context({error:g}))||O,this._is_fatal(g.condition)?O||this.dispatch("error",new _.ConnectionError(g.description,g.condition,this)):this.state.local_open&&(this.closed_with_non_fatal_error=!0),!0}else return!1},Q.prototype.get_error=function(){if(this.transport_error)return this.transport_error;if(this.remote.close&&this.remote.close.error)return new _.ConnectionError(this.remote.close.error.description,this.remote.close.error.condition,this)},Q.prototype._get_peer_details=function(){var g="";return this.remote.open&&this.remote.open.container&&(g+=this.remote.open.container+" "),this.remote.open&&this.remote.open.properties&&(g+=JSON.stringify(this.remote.open.properties)),g},Q.prototype.output=function(){try{this.socket&&this.socket_ready&&(this.heartbeat_out&&clearTimeout(this.heartbeat_out),this.transport.write(this.socket),(this.is_closed()&&this.state.has_settled()||this.abort_idle||this.transport_error)&&!this.transport.has_writes_pending()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2)),this.local.open.idle_time_out&&this.heartbeat_in===void 0&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)))}catch(g){this.saved_error=g,g.name==="ProtocolError"?(console.error("["+this.options.id+"] error on write: "+g+" "+this._get_peer_details()+" "+g.name),this.dispatch("protocol_error",g)||console.error("["+this.options.id+"] error on write: "+g+" "+this._get_peer_details())):this.dispatch("error",g),this.socket.end()}};function ie(g){return g<16?"0x0"+Number(g).toString(16):"0x"+Number(g).toString(16)}function ne(g){for(var O=[],Y=0;Y<g.length;Y++)O.push(ie(g[Y]));return O.join(",")}Q.prototype.input=function(g){var O;try{this.heartbeat_in&&clearTimeout(this.heartbeat_in),d.io("[%s] read %d bytes",this.options.id,g.length),this.previous_input?(O=u.concat([this.previous_input,g],this.previous_input.length+g.length),this.previous_input=null):O=g;var Y=this.transport.read(O,this);Y<O.length&&(this.previous_input=O.slice(Y)),this.local.open.idle_time_out&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)),this.transport.has_writes_pending()?this.output():this.is_closed()&&this.state.has_settled()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&!this.heartbeat_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2))}catch(e){this.saved_error=e,e.name==="ProtocolError"?this.dispatch("protocol_error",e)||console.error("["+this.options.id+"] error on read: "+e+" "+this._get_peer_details()+" (buffer:"+ne(O)+")"):this.dispatch("error",e),this.socket.end()}},Q.prototype.idle=function(){this.is_closed()||(this.closed_with_non_fatal_error=!0,this.local.close.error={condition:"amqp:resource-limit-exceeded",description:"max idle time exceeded"},this.close(),this.abort_idle=setTimeout(this.abort_socket.bind(this,this.socket),1e3))},Q.prototype.on_error=function(g){this._disconnected(g)},Q.prototype.eof=function(g){var O=g||this.saved_error;this.saved_error=void 0,this._disconnected(O)},Q.prototype._disconnected=function(g){this.heartbeat_out&&(clearTimeout(this.heartbeat_out),this.heartbeat_out=void 0),this.heartbeat_in&&(clearTimeout(this.heartbeat_in),this.heartbeat_in=void 0),this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0);var O=this.closed_with_non_fatal_error;if(this.closed_with_non_fatal_error&&(this.closed_with_non_fatal_error=!1,this.options.reconnect&&this.open()),(!this.is_closed()||O)&&this.scheduled_reconnect===void 0){this._disconnect();var Y={};if(g&&(Y.error=g),!this.is_server&&!this.transport_error&&this.options.reconnect){var e=this.options.reconnect(this.conn_established_counter);e>=0?(d.reconnect("[%s] Scheduled reconnect in "+e+"ms",this.options.id),this.scheduled_reconnect=setTimeout(this.reconnect.bind(this),e),Y.reconnecting=!0):Y.reconnecting=!1}this.dispatch("disconnected",this._context(Y))||console.warn("["+this.options.id+"] disconnected %s",Y.error||"")}},Q.prototype.open=function(){this.state.open()&&this._register()},Q.prototype.close=function(g){g&&(this.local.close.error=g),this.state.close()&&this._register()},Q.prototype.is_open=function(){return this.state.is_open()},Q.prototype.is_remote_open=function(){return this.state.remote_open},Q.prototype.is_closed=function(){return this.state.is_closed()},Q.prototype.create_session=function(){for(var g=0;this.local_channel_map[g];)g++;var O=new j(this,g);return this.local_channel_map[g]=O,O},Q.prototype.find_sender=function(g){return this.find_link(i.sender_filter(g))},Q.prototype.find_receiver=function(g){return this.find_link(i.receiver_filter(g))},Q.prototype.find_link=function(g){for(var O in this.local_channel_map){var Y=this.local_channel_map[O],e=Y.find_link(g);if(e)return e}},Q.prototype.each_receiver=function(g,O){this.each_link(g,i.receiver_filter(O))},Q.prototype.each_sender=function(g,O){this.each_link(g,i.sender_filter(O))},Q.prototype.each_link=function(g,O){for(var Y in this.local_channel_map){var e=this.local_channel_map[Y];e.each_link(g,O)}},Q.prototype.on_open=function(g){if(this.state.remote_opened())this.remote.open=g.performative,this.open(),this.dispatch("connection_open",this._context());else throw new _.ProtocolError("Open already received")},Q.prototype.on_close=function(g){if(this.state.remote_closed()){this.remote.close=g.performative,this.remote.close.error?this._handle_error():this.dispatch("connection_close",this._context()),this.heartbeat_out&&clearTimeout(this.heartbeat_out);var O=this;l.nextTick(function(){O.close()})}else throw new _.ProtocolError("Close already received")},Q.prototype._register=function(){this.registered||(this.registered=!0,l.nextTick(this._process.bind(this)))},Q.prototype._process=function(){this.registered=!1;do{this.state.need_open()&&this._write_open();var g=this.local_channel_map;for(var O in g)g[O]._process();this.state.need_close()&&this._write_close()}while(!this.state.has_settled())},Q.prototype._write_frame=function(g,O,Y){this.amqp_transport.encode(A.amqp_frame(g,O,Y)),this.output()},Q.prototype._write_open=function(){this._write_frame(0,this.local.open)},Q.prototype._write_close=function(){this._write_frame(0,this.local.close),this.local.close.error=void 0},Q.prototype.on_begin=function(g){var O;if(g.performative.remote_channel===null||g.performative.remote_channel===void 0)O=this.create_session(),O.local.begin.remote_channel=g.channel;else if(O=this.local_channel_map[g.performative.remote_channel],!O)throw new _.ProtocolError("Invalid value for remote channel "+g.performative.remote_channel);O.on_begin(g),this.remote_channel_map[g.channel]=O},Q.prototype.get_peer_certificate=function(){if(this.socket&&this.socket.getPeerCertificate)return this.socket.getPeerCertificate()},Q.prototype.get_tls_socket=function(){if(this.socket&&(this.options.transport==="tls"||this.options.transport==="ssl"))return this.socket},Q.prototype._context=function(g){var O=g||{};return O.connection=this,this.container&&(O.container=this.container),O},Q.prototype.remove_session=function(g){this.remote_channel_map[g.remote.channel]===g&&delete this.remote_channel_map[g.remote.channel],this.local_channel_map[g.local.channel]===g&&delete this.local_channel_map[g.local.channel]},Q.prototype.remove_all_sessions=function(){ue(this.remote_channel_map),ue(this.local_channel_map)};function ue(g){for(var O in g)Object.prototype.hasOwnProperty.call(g,O)&&delete g[O]}function ce(g){Q.prototype["on_"+g]=function(O){var Y=this.remote_channel_map[O.channel];if(!Y)throw new _.ProtocolError(g+" received on invalid channel "+O.channel);Y["on_"+g](O)}}ce("end"),ce("attach"),ce("detach"),ce("transfer"),ce("disposition"),ce("flow"),k.exports=Q}).call(this)}).call(this,m("_process"),m("buffer").Buffer)},{"./endpoint.js":2,"./errors.js":3,"./frames.js":6,"./log.js":8,"./sasl.js":10,"./session.js":11,"./transport.js":13,"./util.js":15,_process:43,buffer:20,events:26,fs:19,net:19,os:41,path:42,tls:19}],2:[function(m,k,v){var l=function(){this.init()};l.prototype.init=function(){this.local_open=!1,this.remote_open=!1,this.open_requests=0,this.close_requests=0,this.initialised=!1,this.marker=void 0},l.prototype.mark=function(u){return this.marker=u||Date.now(),this.marker},l.prototype.open=function(){return this.marker=void 0,this.initialised=!0,this.local_open?!1:(this.local_open=!0,this.open_requests++,!0)},l.prototype.close=function(){return this.marker=void 0,this.local_open?(this.local_open=!1,this.close_requests++,!0):!1},l.prototype.disconnected=function(){var u=this.initialised;this.was_open=this.local_open,this.init(),this.initialised=u},l.prototype.reconnect=function(){this.was_open&&(this.open(),this.was_open=void 0)},l.prototype.remote_opened=function(){return this.remote_open?!1:(this.remote_open=!0,!0)},l.prototype.remote_closed=function(){return this.remote_open?(this.remote_open=!1,!0):!1},l.prototype.is_open=function(){return this.local_open&&this.remote_open},l.prototype.is_closed=function(){return this.initialised&&!(this.local_open||this.was_open)&&!this.remote_open},l.prototype.has_settled=function(){return this.open_requests===0&&this.close_requests===0},l.prototype.need_open=function(){return this.open_requests>0?(this.open_requests--,!0):!1},l.prototype.need_close=function(){return this.close_requests>0?(this.close_requests--,!0):!1},k.exports=l},{}],3:[function(m,k,v){var l=m("util");function u(d){Error.captureStackTrace(this,u),this.message=d,this.name="ProtocolError"}l.inherits(u,Error);function _(d){Error.captureStackTrace(this,_),this.message=d,this.name="TypeError"}l.inherits(_,u);function A(d,h,i){Error.captureStackTrace(this,A),this.message=d,this.name="ConnectionError",this.condition=h,this.description=d,Object.defineProperty(this,"connection",{value:i})}l.inherits(A,Error),A.prototype.toJSON=function(){return{type:this.name,code:this.condition,message:this.description}},k.exports={ProtocolError:u,TypeError:_,ConnectionError:A}},{util:46}],4:[function(m,k,v){var l;(function(d){d.message="message",d.receiverOpen="receiver_open",d.receiverDrained="receiver_drained",d.receiverFlow="receiver_flow",d.receiverError="receiver_error",d.receiverClose="receiver_close",d.settled="settled"})(l||(l={}));var u;(function(d){d.sendable="sendable",d.senderOpen="sender_open",d.senderDraining="sender_draining",d.senderFlow="sender_flow",d.senderError="sender_error",d.senderClose="sender_close",d.accepted="accepted",d.released="released",d.rejected="rejected",d.modified="modified",d.settled="settled"})(u||(u={}));var _;(function(d){d.sessionOpen="session_open",d.sessionError="session_error",d.sessionClose="session_close",d.settled="settled"})(_||(_={}));var A;(function(d){d.connectionOpen="connection_open",d.connectionClose="connection_close",d.connectionError="connection_error",d.protocolError="protocol_error",d.error="error",d.disconnected="disconnected",d.settled="settled"})(A||(A={})),k.exports={ReceiverEvents:l,SenderEvents:u,SessionEvents:_,ConnectionEvents:A}},{}],5:[function(m,k,v){var l=m("./types.js");k.exports={selector:function(u){return{"jms-selector":l.wrap_described(u,77567109365764)}}}},{"./types.js":14}],6:[function(m,k,v){var l=m("./types.js"),u=m("./errors.js"),_={},A={};_.read_header=function(w){var r=4,a={},E=w.toString("ascii",0,r);if(E!=="AMQP")throw new u.ProtocolError("Invalid protocol header for AMQP: "+w.toString("hex",0,r));if(a.protocol_id=w.readUInt8(r++),a.major=w.readUInt8(r++),a.minor=w.readUInt8(r++),a.revision=w.readUInt8(r++),a.protocol_id===0&&a.major===0&&a.minor===9&&a.revision===1)throw new u.ProtocolError("Unsupported AMQP version: 0-9-1");if(a.protocol_id===1&&a.major===1&&a.minor===0&&a.revision===10)throw new u.ProtocolError("Unsupported AMQP version: 0-10");if(a.major!==1||a.minor!==0)throw new u.ProtocolError("Unsupported AMQP version: "+JSON.stringify(a));return a},_.write_header=function(w,r){var a=4;return w.write("AMQP",0,a,"ascii"),w.writeUInt8(r.protocol_id,a++),w.writeUInt8(r.major,a++),w.writeUInt8(r.minor,a++),w.writeUInt8(r.revision,a++),8},_.TYPE_AMQP=0,_.TYPE_SASL=1,_.read_frame=function(w){var r=new l.Reader(w),a={};if(a.size=r.read_uint(4),r.remaining()<a.size-4)return null;var E=r.read_uint(1);if(E<2)throw new u.ProtocolError("Invalid data offset, must be at least 2 was "+E);if(a.type=r.read_uint(1),a.type===_.TYPE_AMQP)a.channel=r.read_uint(2);else if(a.type===_.TYPE_SASL)r.skip(2),a.channel=0;else throw new u.ProtocolError("Unknown frame type "+a.type);if(E>1&&r.skip(E*4-8),r.remaining()){a.performative=r.read();var M=A[a.performative.descriptor.value];M&&(a.performative=new M(a.performative.value)),r.remaining()&&(a.payload=r.read_bytes(r.remaining()))}return a},_.write_frame=function(w){var r=new l.Writer;if(r.skip(4),r.write_uint(2,1),r.write_uint(w.type,1),w.type===_.TYPE_AMQP)r.write_uint(w.channel,2);else if(w.type===_.TYPE_SASL)r.write_uint(0,2);else throw new u.ProtocolError("Unknown frame type "+w.type);w.performative&&(r.write(w.performative),w.payload&&r.write_bytes(w.payload));var a=r.toBuffer();return a.writeUInt32BE(a.length,0),a},_.amqp_frame=function(w,r,a){return{channel:w||0,type:_.TYPE_AMQP,performative:r,payload:a}},_.sasl_frame=function(w){return{channel:0,type:_.TYPE_SASL,performative:w}};function d(w,r){var a=l.define_composite(r);_[r.name]=a.create,A[Number(a.descriptor.numeric).toString(10)]=a,A[a.descriptor.symbolic]=a}var h={name:"open",code:16,fields:[{name:"container_id",type:"string",mandatory:!0},{name:"hostname",type:"string"},{name:"max_frame_size",type:"uint",default_value:4294967295},{name:"channel_max",type:"ushort",default_value:65535},{name:"idle_time_out",type:"uint"},{name:"outgoing_locales",type:"symbol",multiple:!0},{name:"incoming_locales",type:"symbol",multiple:!0},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]},i={name:"begin",code:17,fields:[{name:"remote_channel",type:"ushort"},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"incoming_window",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle_max",type:"uint",default_value:"4294967295"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]},p={name:"attach",code:18,fields:[{name:"name",type:"string",mandatory:!0},{name:"handle",type:"uint",mandatory:!0},{name:"role",type:"boolean",mandatory:!0},{name:"snd_settle_mode",type:"ubyte",default_value:2},{name:"rcv_settle_mode",type:"ubyte",default_value:0},{name:"source",type:"*"},{name:"target",type:"*"},{name:"unsettled",type:"map"},{name:"incomplete_unsettled",type:"boolean",default_value:!1},{name:"initial_delivery_count",type:"uint"},{name:"max_message_size",type:"ulong"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]},j={name:"flow",code:19,fields:[{name:"next_incoming_id",type:"uint"},{name:"incoming_window",type:"uint",mandatory:!0},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle",type:"uint"},{name:"delivery_count",type:"uint"},{name:"link_credit",type:"uint"},{name:"available",type:"uint"},{name:"drain",type:"boolean",default_value:!1},{name:"echo",type:"boolean",default_value:!1},{name:"properties",type:"symbolic_map"}]},T={name:"transfer",code:20,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"delivery_id",type:"uint"},{name:"delivery_tag",type:"binary"},{name:"message_format",type:"uint"},{name:"settled",type:"boolean"},{name:"more",type:"boolean",default_value:!1},{name:"rcv_settle_mode",type:"ubyte"},{name:"state",type:"delivery_state"},{name:"resume",type:"boolean",default_value:!1},{name:"aborted",type:"boolean",default_value:!1},{name:"batchable",type:"boolean",default_value:!1}]},c={name:"disposition",code:21,fields:[{name:"role",type:"boolean",mandatory:!0},{name:"first",type:"uint",mandatory:!0},{name:"last",type:"uint"},{name:"settled",type:"boolean",default_value:!1},{name:"state",type:"*"},{name:"batchable",type:"boolean",default_value:!1}]},y={name:"detach",code:22,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"closed",type:"boolean",default_value:!1},{name:"error",type:"error"}]},C={name:"end",code:23,fields:[{name:"error",type:"error"}]},I={name:"close",code:24,fields:[{name:"error",type:"error"}]};d(_.TYPE_AMQP,h),d(_.TYPE_AMQP,i),d(_.TYPE_AMQP,p),d(_.TYPE_AMQP,j),d(_.TYPE_AMQP,T),d(_.TYPE_AMQP,c),d(_.TYPE_AMQP,y),d(_.TYPE_AMQP,C),d(_.TYPE_AMQP,I);var F={name:"sasl_mechanisms",code:64,fields:[{name:"sasl_server_mechanisms",type:"symbol",multiple:!0,mandatory:!0}]},P={name:"sasl_init",code:65,fields:[{name:"mechanism",type:"symbol",mandatory:!0},{name:"initial_response",type:"binary"},{name:"hostname",type:"string"}]},S={name:"sasl_challenge",code:66,fields:[{name:"challenge",type:"binary",mandatory:!0}]},B={name:"sasl_response",code:67,fields:[{name:"response",type:"binary",mandatory:!0}]},x={name:"sasl_outcome",code:68,fields:[{name:"code",type:"ubyte",mandatory:!0},{name:"additional_data",type:"binary"}]};d(_.TYPE_SASL,F),d(_.TYPE_SASL,P),d(_.TYPE_SASL,S),d(_.TYPE_SASL,B),d(_.TYPE_SASL,x),k.exports=_},{"./errors.js":3,"./types.js":14}],7:[function(m,k,v){(function(l,u){(function(){var _=m("./frames.js"),A=m("./log.js"),d=m("./message.js"),h=m("./terminus.js"),i=m("./endpoint.js"),p=function(x){this.window=x};p.prototype.update=function(x){var w=this.window-x.receiver.credit;w>=this.window/4&&x.receiver.flow(w)};function j(x){x.delivery.settled=!0}function T(x){x.delivery.update(void 0,d.accepted().described())}function c(x,w,r){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=x,this.condition=w,this.description=x,Object.defineProperty(this,"link",{value:r})}m("util").inherits(c,Error);var y=m("events").EventEmitter,C=Object.create(y.prototype);C.dispatch=function(x){return A.events("[%s] Link got event: %s",this.connection.options.id,x),y.prototype.emit.apply(this.observers,arguments),this.listeners(x).length?(y.prototype.emit.apply(this,arguments),!0):this.session.dispatch.apply(this.session,arguments)},C.set_source=function(x){this.local.attach.source=h.source(x).described()},C.set_target=function(x){this.local.attach.target=h.target(x).described()},C.attach=function(){this.state.open()&&this.connection._register()},C.open=C.attach,C.detach=function(){this.local.detach.closed=!1,this.state.close()&&this.connection._register()},C.close=function(x){x&&(this.local.detach.error=x),this.local.detach.closed=!0,this.state.close()&&this.connection._register()},C.remove=function(){this.session.remove_link(this)},C.is_open=function(){return this.session.is_open()&&this.state.is_open()},C.is_remote_open=function(){return this.session.is_remote_open()&&this.state.remote_open},C.is_itself_closed=function(){return this.state.is_closed()},C.is_closed=function(){return this.session.is_closed()||this.is_itself_closed()},C._process=function(){do this.state.need_open()&&this.session.output(this.local.attach),this.issue_flow&&this.state.local_open&&(this.session._write_flow(this),this.issue_flow=!1),this.state.need_close()&&this.session.output(this.local.detach);while(!this.state.has_settled())},C.on_attach=function(x){if(this.state.remote_opened())this.remote.handle||(this.remote.handle=x.handle),x.performative.source=h.unwrap(x.performative.source),x.performative.target=h.unwrap(x.performative.target),this.remote.attach=x.performative,this.open(),this.dispatch(this.is_receiver()?"receiver_open":"sender_open",this._context());else throw Error("Attach already received")},C.prefix_event=function(x){return(this.local.attach.role?"receiver_":"sender_")+x},C.on_detach=function(x){if(this.state.remote_closed()){this._incomplete&&(this._incomplete.settled=!0),this.remote.detach=x.performative;var w=this.remote.detach.error;if(w){var r=this.dispatch(this.prefix_event("error"),this._context());r=this.dispatch(this.prefix_event("close"),this._context())||r,r||y.prototype.emit.call(this.connection.container,"error",new c(w.description,w.condition,this))}else this.dispatch(this.prefix_event("close"),this._context());var a=this,E=this.state.mark();l.nextTick(function(){a.state.marker===E&&(a.close(),l.nextTick(function(){a.remove()}))})}else throw Error("Detach already received")};function I(x){switch(x){case"name":case"handle":case"role":case"initial_delivery_count":return!0;default:return!1}}var F=["snd_settle_mode","rcv_settle_mode","source","target","max_message_size","offered_capabilities","desired_capabilities","properties"];function P(x){return function(){return this.remote.attach?this.remote.attach[x]:void 0}}C.init=function(x,w,r,a,E){this.session=x,this.connection=x.connection,this.name=w,this.options=a===void 0?{}:a,this.state=new i,this.issue_flow=!1,this.local={handle:r},this.local.attach=_.attach({handle:r,name:w,role:E});for(var M in this.local.attach)!I(M)&&this.options[M]!==void 0&&(this.local.attach[M]=this.options[M]);this.local.detach=_.detach({handle:r,closed:!0}),this.remote={handle:void 0},this.delivery_count=0,this.credit=0,this.observers=new y;var L=this;F.forEach(function(W){Object.defineProperty(L,W,{get:P(W)})}),Object.defineProperty(this,"error",{get:function(){return this.remote.detach?this.remote.detach.error:void 0}})},C._disconnect=function(){this.state.disconnected(),this.state.was_open||this.remove()},C._reconnect=function(){this.state.reconnect(),this.remote={handle:void 0},this.delivery_count=0,this.credit=0},C.has_credit=function(){return this.credit>0},C.is_receiver=function(){return this.local.attach.role},C.is_sender=function(){return!this.is_receiver()},C._context=function(x){var w=x||{};return this.is_receiver()?w.receiver=this:w.sender=this,this.session._context(w)},C.get_option=function(x,w){return this.options[x]!==void 0?this.options[x]:this.session.get_option(x,w)};var S=function(x,w,r,a){this.init(x,w,r,a,!1),this._draining=!1,this._drained=!1,this.local.attach.initial_delivery_count=0,this.tag=0,this.get_option("autosettle",!0)&&this.observers.on("settled",j);var E=this;this.get_option("treat_modified_as_released",!0)&&this.observers.on("modified",function(M){E.dispatch("released",M)})};S.prototype=Object.create(C),S.prototype.constructor=S,S.prototype._get_drain=function(){if(this._draining&&this._drained&&this.credit){for(;this.credit;)++this.delivery_count,--this.credit;return!0}else return!1},S.prototype.set_drained=function(x){this._drained=x,this._draining&&this._drained&&(this.issue_flow=!0)},S.prototype.next_tag=function(){return u.from(new String(this.tag++))},S.prototype.sendable=function(){return!!(this.credit&&this.session.outgoing.available())},S.prototype.on_flow=function(x){var w=x.performative;this.credit=w.delivery_count+w.link_credit-this.delivery_count,this._draining=w.drain,this._drained=this.credit>0,this.is_open()&&(this.dispatch("sender_flow",this._context()),this._draining&&this.dispatch("sender_draining",this._context()),this.sendable()&&this.dispatch("sendable",this._context()))},S.prototype.on_transfer=function(){throw Error("got transfer on sending link")},S.prototype.send=function(x,w,r){var a=r===void 0?d.encode(x):x,E=this.session.send(this,w||this.next_tag(),a,r);return this.local.attach.snd_settle_mode===1&&(E.settled=!0),E};var B=function(x,w,r,a){this.init(x,w,r,a,!0),this.drain=!1,this.set_credit_window(this.get_option("credit_window",1e3)),this.get_option("autoaccept",!0)&&this.observers.on("message",T),this.local.attach.rcv_settle_mode===1&&this.get_option("autosettle",!0)&&this.observers.on("settled",j)};B.prototype=Object.create(C),B.prototype.constructor=B,B.prototype.on_flow=function(x){this.dispatch("receiver_flow",this._context()),x.performative.drain&&(this.credit=x.performative.link_credit,this.delivery_count=x.performative.delivery_count,x.performative.link_credit>0?console.error("ERROR: received flow with drain set, but non zero credit"):this.dispatch("receiver_drained",this._context()))},B.prototype.flow=function(x){x>0&&(this.credit+=x,this.issue_flow=!0,this.connection._register())},B.prototype.drain_credit=function(){this.drain=!0,this.issue_flow=!0,this.connection._register()},B.prototype.add_credit=B.prototype.flow,B.prototype._get_drain=function(){return this.drain},B.prototype.set_credit_window=function(x){if(x>0){var w=new p(x),r=w.update.bind(w);this.observers.on("message",r),this.observers.on("receiver_open",r)}},k.exports={Sender:S,Receiver:B}}).call(this)}).call(this,m("_process"),m("buffer").Buffer)},{"./endpoint.js":2,"./frames.js":6,"./log.js":8,"./message.js":9,"./terminus.js":12,_process:43,buffer:20,events:26,util:46}],8:[function(m,k,v){var l=m("debug");l.formatters&&(l.formatters.h=function(u){return u.toString("hex")}),k.exports={config:l("rhea:config"),frames:l("rhea:frames"),raw:l("rhea:raw"),reconnect:l("rhea:reconnect"),events:l("rhea:events"),message:l("rhea:message"),flow:l("rhea:flow"),io:l("rhea:io")}},{debug:23}],9:[function(m,k,v){var l=m("./log.js"),u=m("./types.js"),_={},A={},d=[],h={};function i(S,B,x){B.descriptor=S,A[S.symbolic]=B,A[Number(S.numeric).toString(10)]=B,x&&d.push(x)}function p(S){var B=u.define_composite(S);h[S.name]=B.create,_[Number(B.descriptor.numeric).toString(10)]=B,_[B.descriptor.symbolic]=B;var x=function(r,a){for(var E=new B(a.value),M=0;M<S.fields.length;M++){var L=S.fields[M],W=E[L.name];W!=null&&(r[L.name]=W)}},w=function(r,a){r.push(B.create(a).described())};i(B.descriptor,x,w)}function j(S,B){var x=B?u.wrap_symbolic_map:u.wrap_map,w={numeric:S.code};w.symbolic="amqp:"+S.name.replace(/_/g,"-")+":map";var r=function(E,M){E[S.name]=u.unwrap_map_simple(M)},a=function(E,M){M[S.name]&&E.push(u.described_nc(u.wrap_ulong(w.numeric),x(M[S.name])))};i(w,r,a)}function T(S,B,x){this.typecode=S,this.content=B,this.multiple=x}T.prototype.described=function(S){return u.described(u.wrap_ulong(this.typecode),u.wrap(S||this.content))},T.prototype.collect_sections=function(S){if(this.multiple)for(var B=0;B<this.content.length;B++)S.push(this.described(this.content[B]));else S.push(this.described())},p({name:"header",code:112,fields:[{name:"durable",type:"boolean",default_value:!1},{name:"priority",type:"ubyte",default_value:4},{name:"ttl",type:"uint"},{name:"first_acquirer",type:"boolean",default_value:!1},{name:"delivery_count",type:"uint",default_value:0}]}),j({name:"delivery_annotations",code:113},!0),j({name:"message_annotations",code:114},!0),p({name:"properties",code:115,fields:[{name:"message_id",type:"message_id"},{name:"user_id",type:"binary"},{name:"to",type:"string"},{name:"subject",type:"string"},{name:"reply_to",type:"string"},{name:"correlation_id",type:"message_id"},{name:"content_type",type:"symbol"},{name:"content_encoding",type:"symbol"},{name:"absolute_expiry_time",type:"timestamp"},{name:"creation_time",type:"timestamp"},{name:"group_id",type:"string"},{name:"group_sequence",type:"uint"},{name:"reply_to_group_id",type:"string"}]}),j({name:"application_properties",code:116});function c(S,B,x){S.body===void 0?S.body=new T(x,u.unwrap(B)):S.body.constructor===T&&S.body.typecode===x&&(S.body.multiple?S.body.content.push(u.unwrap(B)):(S.body.multiple=!0,S.body.content=[S.body.content,u.unwrap(B)]))}i({numeric:117,symbolic:"amqp:data:binary"},function(S,B){c(S,B,117)}),i({numeric:118,symbolic:"amqp:amqp-sequence:list"},function(S,B){c(S,B,118)}),i({numeric:119,symbolic:"amqp:value:*"},function(S,B){S.body=u.unwrap(B)}),j({name:"footer",code:120});function y(S,B){B.body&&B.body.collect_sections?B.body.collect_sections(S):S.push(u.described(u.wrap_ulong(119),u.wrap(B.body)))}d.push(y),h.data_section=function(S){return new T(117,S)},h.sequence_section=function(S){return new T(118,S)},h.data_sections=function(S){return new T(117,S,!0)},h.sequence_sections=function(S){return new T(118,S,!0)};function C(S,B){for(var x in S){var w=S[x];typeof w=="object"?C(w,B[x]):B[x]=w}}function I(S){S&&C(S,this)}I.prototype.toJSON=function(){var S={};for(var B in this)typeof this[B]!="function"&&(S[B]=this[B]);return S},I.prototype.toString=function(){return JSON.stringify(this.toJSON())},h.encode=function(S){var B=[];d.forEach(function(a){a(B,S)});for(var x=new u.Writer,w=0;w<B.length;w++)l.message("Encoding section %d of %d: %o",w+1,B.length,B[w]),x.write(B[w]);var r=x.toBuffer();return l.message("encoded %d bytes",r.length),r},h.decode=function(S){for(var B=new I,x=new u.Reader(S);x.remaining();){var w=x.read();if(l.message("decoding section: %o of type: %o",w,w.descriptor),w.descriptor){var r=A[w.descriptor.value];r?r(B,w):console.warn("WARNING: did not recognise message section with descriptor "+w.descriptor)}else console.warn("WARNING: expected described message section got "+JSON.stringify(w))}return B};var F={};function P(S){var B=u.define_composite(S);B.composite_type=S.name,h[S.name]=B.create,F[Number(B.descriptor.numeric).toString(10)]=B,F[B.descriptor.symbolic]=B,h["is_"+S.name]=function(x){if(x&&x.descriptor){var w=F[x.descriptor.value];if(w)return w.descriptor.numeric===S.code}return!1}}h.unwrap_outcome=function(S){if(S&&S.descriptor){var B=F[S.descriptor.value];if(B)return new B(S.value)}return console.error("unrecognised outcome: "+JSON.stringify(S)),S},h.are_outcomes_equivalent=function(S,B){return S===void 0&&B===void 0?!0:S===void 0||B===void 0?!1:S.descriptor.value===B.descriptor.value&&S.descriptor.value===36},P({name:"received",code:35,fields:[{name:"section_number",type:"uint",mandatory:!0},{name:"section_offset",type:"ulong",mandatory:!0}]}),P({name:"accepted",code:36,fields:[]}),P({name:"rejected",code:37,fields:[{name:"error",type:"error"}]}),P({name:"released",code:38,fields:[]}),P({name:"modified",code:39,fields:[{name:"delivery_failed",type:"boolean"},{name:"undeliverable_here",type:"boolean"},{name:"message_annotations",type:"map"}]}),k.exports=h},{"./log.js":8,"./types.js":14}],10:[function(m,k,v){var l=m("./errors.js"),u=m("./frames.js"),_=m("./transport.js"),A=m("./util.js"),d={OK:0,AUTH:1,SYS:2,SYS_PERM:3,SYS_TEMP:4},h=3;function i(w){for(var r=[],a=0,E=0;E<w.length;)w[E]===0?(E>a?r.push(w.toString("utf8",a,E)):r.push(null),a=++E):++E;return E>a?r.push(w.toString("utf8",a,E)):r.push(null),r}var p=function(w){this.callback=w,this.outcome=void 0,this.username=void 0};p.prototype.start=function(w,r){var a=i(w);if(a.length!==3)return Promise.reject("Unexpected response in PLAIN, got "+a.length+" fields, expected 3");var E=this;return Promise.resolve(this.callback(a[1],a[2],r)).then(function(M){M?(E.outcome=!0,E.username=a[1]):E.outcome=!1})};var j=function(w,r){this.username=w,this.password=r};j.prototype.start=function(w){var r=A.allocate_buffer(1+this.username.length+1+this.password.length);r.writeUInt8(0,0),r.write(this.username,1),r.writeUInt8(0,1+this.username.length),r.write(this.password,1+this.username.length+1),w(void 0,r)};var T=function(){this.outcome=void 0,this.username=void 0};T.prototype.start=function(w){this.outcome=!0,this.username=w?w.toString("utf8"):"anonymous"};var c=function(w){this.username=w||"anonymous"};c.prototype.start=function(w){var r=A.allocate_buffer(1+this.username.length);r.writeUInt8(0,0),r.write(this.username,1),w(void 0,r)};var y=function(){this.outcome=void 0,this.username=void 0};y.prototype.start=function(){this.outcome=!0};var C=function(){this.username=void 0};C.prototype.start=function(w){w(void 0,"")},C.prototype.step=function(w){w(void 0,"")};var I=function(w,r){this.username=w,this.token=r};I.prototype.start=function(w){var r=A.allocate_buffer(this.username.length+this.token.length+5+12+3),a=0;r.write("user=",a),a+=5,r.write(this.username,a),a+=this.username.length,r.writeUInt8(1,a),a+=1,r.write("auth=Bearer ",a),a+=12,r.write(this.token,a),a+=this.token.length,r.writeUInt8(1,a),a+=1,r.writeUInt8(1,a),a+=1,w(void 0,r)};var F=function(w,r){this.connection=w,this.transport=new _(w.amqp_transport.identifier,h,u.TYPE_SASL,this),this.next=w.amqp_transport,this.mechanisms=r,this.mechanism=void 0,this.outcome=void 0,this.username=void 0;var a=Object.getOwnPropertyNames(r);this.transport.encode(u.sasl_frame(u.sasl_mechanisms({sasl_server_mechanisms:a})))};F.prototype.do_step=function(w){if(this.mechanism.outcome===void 0)this.transport.encode(u.sasl_frame(u.sasl_challenge({challenge:w}))),this.connection.output();else{this.outcome=this.mechanism.outcome?d.OK:d.AUTH;var r=u.sasl_frame(u.sasl_outcome({code:this.outcome}));this.transport.encode(r),this.connection.output(),this.outcome===d.OK&&(this.username=this.mechanism.username,this.transport.write_complete=!0,this.transport.read_complete=!0)}},F.prototype.on_sasl_init=function(w){var r=this.mechanisms[w.performative.mechanism];r?(this.mechanism=r(),Promise.resolve(this.mechanism.start(w.performative.initial_response,w.performative.hostname)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))):(this.outcome=d.AUTH,this.transport.encode(u.sasl_frame(u.sasl_outcome({code:this.outcome}))))},F.prototype.on_sasl_response=function(w){Promise.resolve(this.mechanism.step(w.performative.response)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))},F.prototype.do_fail=function(w){var r=u.sasl_frame(u.sasl_outcome({code:d.SYS}));this.transport.encode(r),this.connection.output();try{this.connection.sasl_failed("Sasl callback promise failed with "+w,"amqp:internal-error")}catch(a){console.error("Uncaught error: ",a.message)}},F.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},F.prototype.write=function(w){return this.transport.write_complete&&this.transport.pending.length===0?this.next.write(w):this.transport.write(w)},F.prototype.read=function(w){return this.transport.read_complete?this.next.read(w):this.transport.read(w)};var P=function(w,r,a){this.connection=w,this.transport=new _(w.amqp_transport.identifier,h,u.TYPE_SASL,this),this.next=w.amqp_transport,this.mechanisms=r,this.mechanism=void 0,this.mechanism_name=void 0,this.hostname=a,this.failed=!1};P.prototype.on_sasl_mechanisms=function(w){var r=[];Array.isArray(w.performative.sasl_server_mechanisms)?r=w.performative.sasl_server_mechanisms:w.performative.sasl_server_mechanisms&&(r=[w.performative.sasl_server_mechanisms]);for(var a=0;this.mechanism===void 0&&a<r.length;a++){var E=r[a],M=this.mechanisms[E];M&&(this.mechanism=typeof M=="function"?M():M,this.mechanism_name=E)}if(this.mechanism){var L=this;this.mechanism.start(function(W,D){if(W)L.failed=!0,L.connection.sasl_failed("SASL mechanism init failed: "+W);else{var V={mechanism:L.mechanism_name,initial_response:D};L.hostname&&(V.hostname=L.hostname),L.transport.encode(u.sasl_frame(u.sasl_init(V))),L.connection.output()}})}else this.failed=!0,this.connection.sasl_failed("No suitable mechanism; server supports "+w.performative.sasl_server_mechanisms)},P.prototype.on_sasl_challenge=function(w){var r=this;this.mechanism.step(w.performative.challenge,function(a,E){a?(r.failed=!0,r.connection.sasl_failed("SASL mechanism challenge failed: "+a)):(r.transport.encode(u.sasl_frame(u.sasl_response({response:E}))),r.connection.output())})},P.prototype.on_sasl_outcome=function(w){switch(w.performative.code){case d.OK:this.transport.read_complete=!0,this.transport.write_complete=!0;break;case d.SYS:case d.SYS_PERM:case d.SYS_TEMP:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+w.performative.code,"amqp:internal-error");break;default:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+w.performative.code)}},P.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},P.prototype.write=function(w){return this.transport.write_complete?this.next.write(w):this.transport.write(w)},P.prototype.read=function(w){return this.transport.read_complete?this.next.read(w):this.transport.read(w)};var S=function(w,r){this.header_received=!1,this.transports={0:w.amqp_transport,3:new F(w,r)},this.selected=void 0};S.prototype.has_writes_pending=function(){return this.header_received&&this.selected.has_writes_pending()},S.prototype.write=function(w){return this.selected?this.selected.write(w):0},S.prototype.read=function(w){if(!this.header_received){if(w.length<8)return 0;if(this.header_received=u.read_header(w),this.selected=this.transports[this.header_received.protocol_id],this.selected===void 0)throw new l.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id)}return this.selected.read(w)};var B={enable_anonymous:function(){this.ANONYMOUS=function(){return new T}},enable_plain:function(w){this.PLAIN=function(){return new p(w)}}},x={enable_anonymous:function(w){this.ANONYMOUS=function(){return new c(w)}},enable_plain:function(w,r){this.PLAIN=function(){return new j(w,r)}},enable_external:function(){this.EXTERNAL=function(){return new C}},enable_xoauth2:function(w,r){if(w&&r)this.XOAUTH2=function(){return new I(w,r)};else{if(r===void 0)throw Error("token must be specified");if(w===void 0)throw Error("username must be specified")}}};k.exports={Client:P,Server:F,Selective:S,server_mechanisms:function(){return Object.create(B)},client_mechanisms:function(){return Object.create(x)},server_add_external:function(w){return w.EXTERNAL=function(){return new y},w}}},{"./errors.js":3,"./frames.js":6,"./transport.js":13,"./util.js":15}],11:[function(m,k,v){(function(l,u){(function(){var _=m("./frames.js"),A=m("./link.js"),d=m("./log.js"),h=m("./message.js"),i=m("./types.js"),p=m("./util.js"),j=m("./endpoint.js"),T=m("events").EventEmitter;function c(r,a,E){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=r,this.condition=a,this.description=r,Object.defineProperty(this,"session",{value:E})}m("util").inherits(c,Error);var y=function(r){this.capacity=r,this.size=0,this.head=0,this.tail=0,this.entries=[]};y.prototype.available=function(){return this.capacity-this.size},y.prototype.push=function(r){if(this.size<this.capacity)this.entries[this.tail]=r,this.tail=(this.tail+1)%this.capacity,this.size++;else throw Error("circular buffer overflow: head="+this.head+" tail="+this.tail+" size="+this.size+" capacity="+this.capacity)},y.prototype.pop_if=function(r){for(var a=0;this.size&&r(this.entries[this.head]);)this.entries[this.head]=void 0,this.head=(this.head+1)%this.capacity,this.size--,a++;return a},y.prototype.by_id=function(r){if(this.size>0){var a=r-this.entries[this.head].id;if(a<this.size)return this.entries[(this.head+a)%this.capacity]}},y.prototype.get_head=function(){return this.size>0?this.entries[this.head]:void 0},y.prototype.get_tail=function(){return this.size>0?this.entries[(this.head+this.size-1)%this.capacity]:void 0};function C(r){var a,E,M,L,W;for(L=0;L<r.length;L++)W=r[L],a===void 0&&(a=W,E=W,M=W.id),a!==E&&!h.are_outcomes_equivalent(E.state,W.state)||E.settled!==W.settled||M!==W.id?(a.link.session.output(_.disposition({role:a.link.is_receiver(),first:a.id,last:E.id,state:a.state,settled:a.settled})),a=W,E=W,M=W.id):(E.id!==W.id&&(E=W),M++);a!==void 0&&E!==void 0&&a.link.session.output(_.disposition({role:a.link.is_receiver(),first:a.id,last:E.id,state:a.state,settled:a.settled}))}var I=function(r){this.deliveries=new y(2048),this.updated=[],this.pending_dispositions=[],this.next_delivery_id=0,this.next_pending_delivery=0,this.next_transfer_id=0,this.window=i.MAX_UINT,this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.connection=r};I.prototype.available=function(){return this.deliveries.available()},I.prototype.compute_max_payload=function(r){if(this.connection.max_frame_size)return this.connection.max_frame_size-(50+r.length)},I.prototype.send=function(r,a,E,M){var L=[],W=this.compute_max_payload(a);if(W&&E.length>W)for(var D=0;D<E.length;){var V=Math.min(D+W,E.length);L.push(E.slice(D,V)),D=V}else L.push(E);var H={id:this.next_delivery_id++,tag:a,link:r,data:L,format:M||0,sent:!1,settled:!1,state:void 0,remote_settled:!1,remote_state:void 0},q=this;return H.update=function(Q,ie){q.update(H,Q,ie)},this.deliveries.push(H),H},I.prototype.on_begin=function(r){this.remote_window=r.incoming_window},I.prototype.on_flow=function(r){this.remote_next_transfer_id=r.next_incoming_id,this.remote_window=r.incoming_window},I.prototype.on_disposition=function(r){for(var a=r.last?r.last:r.first,E=r.first;E<=a;E++){var M=this.deliveries.by_id(E);if(M&&!M.remote_settled){var L=!1;r.settled&&(M.remote_settled=r.settled,L=!0),r.state&&r.state!==M.remote_state&&(M.remote_state=h.unwrap_outcome(r.state),L=!0),L&&this.updated.push(M)}}},I.prototype.update=function(r,a,E){r&&(r.settled=a,E!==void 0&&(r.state=E),r.remote_settled||this.pending_dispositions.push(r),r.link.connection._register())},I.prototype.transfer_window=function(){return this.remote_window?this.remote_window-(this.next_transfer_id-this.remote_next_transfer_id):0},I.prototype.process=function(){for(var r;this.next_pending_delivery<this.next_delivery_id;)if(r=this.deliveries.by_id(this.next_pending_delivery),r)if(r.link.has_credit())if(this.transfer_window()>=r.data.length){this.window-=r.data.length;for(var a=0;a<r.data.length;a++){this.next_transfer_id++;var E=a+1<r.data.length,M=_.transfer({handle:r.link.local.handle,message_format:r.format,delivery_id:r.id,delivery_tag:r.tag,settled:r.settled,more:E});r.link.session.output(M,r.data[a]),r.settled&&(r.remote_settled=!0)}r.link.credit--,r.link.delivery_count++,this.next_pending_delivery++}else{d.flow("[%s] Incoming window of peer preventing sending further transfers: remote_window=%d, remote_next_transfer_id=%d, next_transfer_id=%d",this.connection.options.id,this.remote_window,this.remote_next_transfer_id,this.next_transfer_id);break}else{d.flow("[%s] Link has no credit",this.connection.options.id);break}else{console.error("ERROR: Next pending delivery not found: "+this.next_pending_delivery);break}for(var a=0;a<this.updated.length;a++)r=this.updated[a],r.remote_state&&r.remote_state.constructor.composite_type&&r.link.dispatch(r.remote_state.constructor.composite_type,r.link._context({delivery:r})),r.remote_settled&&r.link.dispatch("settled",r.link._context({delivery:r}));this.updated=[],this.pending_dispositions.length&&(C(this.pending_dispositions),this.pending_dispositions=[]),this.deliveries.pop_if(function(L){return L.settled&&L.remote_settled})};var F=function(){this.deliveries=new y(2048),this.updated=[],this.next_transfer_id=0,this.next_delivery_id=void 0,Object.defineProperty(this,"window",{get:function(){return this.deliveries.available()}}),this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.max_transfer_id=this.next_transfer_id+this.window};F.prototype.update=function(r,a,E){r&&(r.settled=a,E!==void 0&&(r.state=E),r.remote_settled||this.updated.push(r),r.link.connection._register())},F.prototype.on_transfer=function(r,a){if(this.next_transfer_id++,a.is_remote_open()){this.next_delivery_id===void 0&&(this.next_delivery_id=r.performative.delivery_id);var E,M;if(a._incomplete){if(E=a._incomplete,p.is_defined(r.performative.delivery_id)&&E.id!==r.performative.delivery_id)throw Error("frame sequence error: delivery "+E.id+" not complete, got "+r.performative.delivery_id);r.payload?M=u.concat([E.data,r.payload],E.data.length+r.payload.length):M=E.data}else if(this.next_delivery_id===r.performative.delivery_id){E={id:r.performative.delivery_id,tag:r.performative.delivery_tag,format:r.performative.message_format,link:a,settled:!1,state:void 0,remote_settled:r.performative.settled===void 0?!1:r.performative.settled,remote_state:r.performative.state};var L=this;E.update=function(D,V){var H=D;H===void 0&&(H=a.local.attach.rcv_settle_mode!==1),L.update(E,H,V)},E.accept=function(){this.update(void 0,h.accepted().described())},E.release=function(D){D?this.update(void 0,h.modified(D).described()):this.update(void 0,h.released().described())},E.reject=function(D){this.update(void 0,h.rejected({error:D}).described())},E.modified=function(D){this.update(void 0,h.modified(D).described())},this.deliveries.push(E),this.next_delivery_id++,M=r.payload}else throw Error("frame sequence error: expected "+this.next_delivery_id+", got "+r.performative.delivery_id);if(E.incomplete=r.performative.more,E.incomplete)a._incomplete=E,E.data=M;else{a._incomplete=void 0,a.credit>0?a.credit--:console.error("Received transfer when credit was %d",a.credit),a.delivery_count++;var W=E.format===0?{message:h.decode(M),delivery:E}:{message:M,delivery:E,format:E.format};a.dispatch("message",a._context(W))}}else throw Error("transfer after detach")},F.prototype.process=function(r){this.updated.length>0&&(C(this.updated),this.updated=[]),this.deliveries.pop_if(function(a){return a.settled}),this.max_transfer_id-this.next_transfer_id<this.window/2&&r._write_flow()},F.prototype.on_begin=function(r){this.remote_window=r.outgoing_window,this.remote_next_transfer_id=r.next_outgoing_id},F.prototype.on_flow=function(r){this.remote_next_transfer_id=r.next_outgoing_id,this.remote_window=r.outgoing_window},F.prototype.on_disposition=function(r){for(var a=r.last?r.last:r.first,E=r.first;E<=a;E++){var M=this.deliveries.by_id(E);M&&!M.remote_settled&&(r.state&&r.state!==M.remote_state&&(M.remote_state=h.unwrap_outcome(r.state)),r.settled&&(M.remote_settled=r.settled,M.link.dispatch("settled",M.link._context({delivery:M}))))}};var P=function(r,a){this.connection=r,this.outgoing=new I(r),this.incoming=new F,this.state=new j,this.local={channel:a,handles:{}},this.local.begin=_.begin({next_outgoing_id:this.outgoing.next_transfer_id,incoming_window:this.incoming.window,outgoing_window:this.outgoing.window}),this.local.end=_.end(),this.remote={handles:{}},this.links={},this.options={},Object.defineProperty(this,"error",{get:function(){return this.remote.end?this.remote.end.error:void 0}}),this.observers=new T};P.prototype=Object.create(T.prototype),P.prototype.constructor=P,P.prototype._disconnect=function(){this.state.disconnected();for(var r in this.links)this.links[r]._disconnect();this.state.was_open||this.remove()},P.prototype._reconnect=function(){this.state.reconnect(),this.outgoing=new I(this.connection),this.incoming=new F,this.remote={handles:{}};for(var r in this.links)this.links[r]._reconnect()},P.prototype.dispatch=function(r){return d.events("[%s] Session got event: %s",this.connection.options.id,r),T.prototype.emit.apply(this.observers,arguments),this.listeners(r).length?(T.prototype.emit.apply(this,arguments),!0):this.connection.dispatch.apply(this.connection,arguments)},P.prototype.output=function(r,a){this.connection._write_frame(this.local.channel,r,a)},P.prototype.create_sender=function(r,a){return a||(a=this.get_option("sender_options",{})),this.create_link(r,A.Sender,a)},P.prototype.create_receiver=function(r,a){return a||(a=this.get_option("receiver_options",{})),this.create_link(r,A.Receiver,a)};function S(r,a){for(var E in a)E==="properties"&&r.properties?S(r.properties,a.properties):r[E]=a[E]}function B(r,a,E,M){var L=Object.create(M||{});typeof a=="string"?L[E]=a:a&&S(L,a),L.name||(L.name=p.generate_uuid());var W=r(L.name,L);for(var D in{source:0,target:0})L[D]&&(typeof L[D]=="string"&&(L[D]={address:L[D]}),W["set_"+D](L[D]));return W.is_sender()&&L.source===void 0&&(L.source=W.set_source({})),W.is_receiver()&&L.target===void 0&&(L.target=W.set_target({})),W.attach(),W}P.prototype.get_option=function(r,a){return this.options[r]!==void 0?this.options[r]:this.connection.get_option(r,a)},P.prototype.attach_sender=function(r){return B(this.create_sender.bind(this),r,"target",this.get_option("sender_options",{}))},P.prototype.open_sender=P.prototype.attach_sender,P.prototype.attach_receiver=function(r){return B(this.create_receiver.bind(this),r,"source",this.get_option("receiver_options",{}))},P.prototype.open_receiver=P.prototype.attach_receiver,P.prototype.find_sender=function(r){return this.find_link(p.sender_filter(r))},P.prototype.find_receiver=function(r){return this.find_link(p.receiver_filter(r))},P.prototype.find_link=function(r){for(var a in this.links){var E=this.links[a];if(r(E))return E}},P.prototype.each_receiver=function(r,a){this.each_link(r,p.receiver_filter(a))},P.prototype.each_sender=function(r,a){this.each_link(r,p.sender_filter(a))},P.prototype.each_link=function(r,a){for(var E in this.links){var M=this.links[E];(a===void 0||a(M))&&r(M)}},P.prototype.create_link=function(r,a,E){for(var M=0;this.local.handles[M];)M++;var L=new a(this,r,M,E);return this.links[r]=L,this.local.handles[M]=L,L},P.prototype.begin=function(){this.state.open()&&this.connection._register()},P.prototype.open=P.prototype.begin,P.prototype.end=function(r){r&&(this.local.end.error=r),this.state.close()&&this.connection._register()},P.prototype.close=P.prototype.end,P.prototype.is_open=function(){return this.connection.is_open()&&this.state.is_open()},P.prototype.is_remote_open=function(){return this.connection.is_remote_open()&&this.state.remote_open},P.prototype.is_itself_closed=function(){return this.state.is_closed()},P.prototype.is_closed=function(){return this.connection.is_closed()||this.is_itself_closed()};function x(r){r.dispatch("sendable",r._context())}function w(r){return r.is_open()&&r.sendable()}P.prototype._process=function(){do{this.state.need_open()&&this.output(this.local.begin);var r=this.outgoing.deliveries.available()===0;this.outgoing.process(),r&&this.outgoing.deliveries.available()&&this.each_sender(x,w),this.incoming.process(this);for(var a in this.links)this.links[a]._process();this.state.need_close()&&this.output(this.local.end)}while(!this.state.has_settled())},P.prototype.send=function(r,a,E,M){var L=this.outgoing.send(r,a,E,M);return this.connection._register(),L},P.prototype._write_flow=function(r){var a={next_incoming_id:this.incoming.next_transfer_id,incoming_window:this.incoming.window,next_outgoing_id:this.outgoing.next_transfer_id,outgoing_window:this.outgoing.window};this.incoming.max_transfer_id=a.next_incoming_id+a.incoming_window,r&&(r._get_drain()&&(a.drain=!0),a.delivery_count=r.delivery_count,a.handle=r.local.handle,a.link_credit=r.credit),this.output(_.flow(a))},P.prototype.on_begin=function(r){if(this.state.remote_opened())this.remote.channel||(this.remote.channel=r.channel),this.remote.begin=r.performative,this.outgoing.on_begin(r.performative),this.incoming.on_begin(r.performative),this.open(),this.dispatch("session_open",this._context());else throw Error("Begin already received")},P.prototype.on_end=function(r){if(this.state.remote_closed()){this.remote.end=r.performative;var a=this.remote.end.error;if(a){var E=this.dispatch("session_error",this._context());E=this.dispatch("session_close",this._context())||E,E||T.prototype.emit.call(this.connection.container,"error",new c(a.description,a.condition,this))}else this.dispatch("session_close",this._context());var M=this,L=this.state.mark();l.nextTick(function(){M.state.marker===L&&(M.close(),l.nextTick(function(){M.remove()}))})}else throw Error("End already received")},P.prototype.on_attach=function(r){var a=r.performative.name,E=this.links[a];E||(E=r.performative.role?this.create_sender(a):this.create_receiver(a)),this.remote.handles[r.performative.handle]=E,E.on_attach(r),E.remote.attach=r.performative},P.prototype.on_disposition=function(r){r.performative.role?(d.events("[%s] Received disposition for outgoing transfers",this.connection.options.id),this.outgoing.on_disposition(r.performative)):(d.events("[%s] Received disposition for incoming transfers",this.connection.options.id),this.incoming.on_disposition(r.performative)),this.connection._register()},P.prototype.on_flow=function(r){this.outgoing.on_flow(r.performative),this.incoming.on_flow(r.performative),p.is_defined(r.performative.handle)&&this._get_link(r).on_flow(r),this.connection._register()},P.prototype._context=function(r){var a=r||{};return a.session=this,this.connection._context(a)},P.prototype._get_link=function(r){var a=r.performative.handle,E=this.remote.handles[a];if(!E)throw Error("Invalid handle "+a);return E},P.prototype.on_detach=function(r){this._get_link(r).on_detach(r)},P.prototype.remove_link=function(r){delete this.remote.handles[r.remote.handle],delete this.local.handles[r.local.handle],delete this.links[r.name]},P.prototype.remove=function(){this.connection.remove_session(this)},P.prototype.on_transfer=function(r){this.incoming.on_transfer(r,this._get_link(r))},k.exports=P}).call(this)}).call(this,m("_process"),m("buffer").Buffer)},{"./endpoint.js":2,"./frames.js":6,"./link.js":7,"./log.js":8,"./message.js":9,"./types.js":14,"./util.js":15,_process:43,buffer:20,events:26,util:46}],12:[function(m,k,v){var l=m("./types.js"),u={},_={};function A(d){var h=l.define_composite(d);u[d.name]=h.create,_[Number(h.descriptor.numeric).toString(10)]=h,_[h.descriptor.symbolic]=h}u.unwrap=function(d){if(d&&d.descriptor){var h=_[d.descriptor.value];if(h)return new h(d.value);console.warn("Unknown terminus: "+d.descriptor)}return null},A({name:"source",code:40,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"distribution_mode",type:"symbol"},{name:"filter",type:"symbolic_map"},{name:"default_outcome",type:"*"},{name:"outcomes",type:"symbol",multiple:!0},{name:"capabilities",type:"symbol",multiple:!0}]}),A({name:"target",code:41,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"capabilities",type:"symbol",multiple:!0}]}),k.exports=u},{"./types.js":14}],13:[function(m,k,v){var l=m("./errors.js"),u=m("./frames.js"),_=m("./log.js"),A=m("./util.js"),d=function(h,i,p,j){this.identifier=h,this.protocol_id=i,this.frame_type=p,this.handler=j,this.pending=[],this.header_sent=void 0,this.header_received=void 0,this.write_complete=!1,this.read_complete=!1};d.prototype.has_writes_pending=function(){return this.pending.length>0||!this.header_sent},d.prototype.encode=function(h){this.pending.push(h)},d.prototype.write=function(h){if(!this.header_sent){var i=A.allocate_buffer(8),p={protocol_id:this.protocol_id,major:1,minor:0,revision:0};_.frames("[%s] -> %o",this.identifier,p),u.write_header(i,p),h.write(i),this.header_sent=p}for(var j=0;j<this.pending.length;j++){var T=this.pending[j],i=u.write_frame(T);h.write(i),T.performative?_.frames("[%s]:%s -> %s %j",this.identifier,T.channel,T.performative.constructor,T.performative,T.payload||""):_.frames("[%s]:%s -> empty",this.identifier,T.channel),_.raw("[%s] SENT: %d %h",this.identifier,i.length,i)}this.pending=[]},d.prototype.read=function(h){var i=0;if(!this.header_received){if(h.length<8)return i;if(this.header_received=u.read_header(h),_.frames("[%s] <- %o",this.identifier,this.header_received),this.header_received.protocol_id!==this.protocol_id)throw this.protocol_id===3&&this.header_received.protocol_id===0?new l.ProtocolError("Expecting SASL layer"):this.protocol_id===0&&this.header_received.protocol_id===3?new l.ProtocolError("SASL layer not enabled"):new l.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id+" expecting: "+this.protocol_id);i=8}for(;i<h.length-4&&!this.read_complete;){var p=h.readUInt32BE(i);if(_.io("[%s] got frame of size %d",this.identifier,p),h.length<i+p){_.io("[%s] incomplete frame; have only %d of %d",this.identifier,h.length-i,p);break}else{var j=h.slice(i,i+p);_.raw("[%s] RECV: %d %h",this.identifier,j.length,j);var T=u.read_frame(j);if(T.performative?_.frames("[%s]:%s <- %s %j",this.identifier,T.channel,T.performative.constructor,T.performative,T.payload||""):_.frames("[%s]:%s <- empty",this.identifier,T.channel),T.type!==this.frame_type)throw new l.ProtocolError("Invalid frame type: "+T.type);i+=p,T.performative&&T.performative.dispatch(this.handler,T)}}return i},k.exports=d},{"./errors.js":3,"./frames.js":6,"./log.js":8,"./util.js":15}],14:[function(m,k,v){(function(l){(function(){var u=m("./errors.js"),_=m("./util.js"),A=1,d=2,h=3,i=4;function p(e,o,b,z){this.type=e,this.value=o,b&&(this.array_constructor={typecode:b},z&&(this.array_constructor.descriptor=z))}p.prototype.toString=function(){return this.value?this.value.toString():null},p.prototype.toLocaleString=function(){return this.value?this.value.toLocaleString():null},p.prototype.valueOf=function(){return this.value},p.prototype.toJSON=function(){return this.value&&this.value.toJSON?this.value.toJSON():this.value},p.prototype.toRheaTyped=function(){return this};function j(e,o,b,z){this.name=e,this.typecode=o;var J=o>>>4;switch(J){case 4:this.width=0,this.category=A;break;case 5:this.width=1,this.category=A;break;case 6:this.width=2,this.category=A;break;case 7:this.width=4,this.category=A;break;case 8:this.width=8,this.category=A;break;case 9:this.width=16,this.category=A;break;case 10:this.width=1,this.category=d;break;case 11:this.width=4,this.category=d;break;case 12:this.width=1,this.category=h;break;case 13:this.width=4,this.category=h;break;case 14:this.width=1,this.category=i;break;case 15:this.width=4,this.category=i;break}b&&(b.read&&(this.read=b.read),b.write&&(this.write=b.write),b.encoding&&(this.encoding=b.encoding));var X=this;J===4?this.create=function(){return new p(X,z)}:J===14||J===15?this.create=function(K,Z,ee){return new p(X,K,Z,ee)}:this.create=function(K){return new p(X,K)}}j.prototype.toString=function(){return this.name+"#"+T(this.typecode)};function T(e){return Number(e).toString(16)}var c={by_code:{}};Object.defineProperty(c,"MAX_UINT",{value:4294967295,writable:!1,configurable:!1}),Object.defineProperty(c,"MAX_USHORT",{value:65535,writable:!1,configurable:!1});function y(e,o,b,z){var J=new j(e,o,b,z);J.create.typecode=J.typecode,c.by_code[J.typecode]=J,c[e]=J.create}function C(){return{read:function(e,o){return e.readUInt8(o)},write:function(e,o,b){e.writeUInt8(o,b)}}}function I(){return{read:function(e,o){return e.readUInt16BE(o)},write:function(e,o,b){e.writeUInt16BE(o,b)}}}function F(){return{read:function(e,o){return e.readUInt32BE(o)},write:function(e,o,b){e.writeUInt32BE(o,b)}}}function P(){return{read:function(e,o){return e.readInt8(o)},write:function(e,o,b){e.writeInt8(o,b)}}}function S(){return{read:function(e,o){return e.readInt16BE(o)},write:function(e,o,b){e.writeInt16BE(o,b)}}}function B(){return{read:function(e,o){return e.readInt32BE(o)},write:function(e,o,b){e.writeInt32BE(o,b)}}}function x(){return{read:function(e,o){return e.readFloatBE(o)},write:function(e,o,b){e.writeFloatBE(o,b)}}}function w(){return{read:function(e,o){return e.readDoubleBE(o)},write:function(e,o,b){e.writeDoubleBE(o,b)}}}var r=4294967296,a=-2147483647;function E(e,o,b){if(typeof o=="number"||o instanceof Number){var z=Math.floor(o/r),J=o%r;e.writeUInt32BE(z,b),e.writeUInt32BE(J,b+4)}else o.copy(e,b)}function M(e,o){var b=e.readUInt32BE(o),z=e.readUInt32BE(o+4);return b<2097153?b*r+z:e.slice(o,o+8)}function L(e,o,b){if(typeof o=="number"||o instanceof Number){var z=Math.abs(o),J=Math.floor(z/r),X=z%r;if(e.writeInt32BE(J,b),e.writeUInt32BE(X,b+4),o<0)for(var K=1,Z=0;Z<8;Z++){var ee=b+(7-Z),ae=(e[ee]^255)+K;e[ee]=ae&255,K=ae>>8}}else o.copy(e,b)}function W(e,o,b){return typeof o=="object"&&o!==null&&typeof o.getTime=="function"&&(o=o.getTime()),L(e,o,b)}function D(e,o){var b=e.readInt32BE(o),z=e.readUInt32BE(o+4);return b<2097153&&b>-2097153?b*r+z:e.slice(o,o+8)}function V(e,o){const b=D(e,o);return new Date(b)}y("Null",64,void 0,null),y("Boolean",86,C()),y("True",65,void 0,!0),y("False",66,void 0,!1),y("Ubyte",80,C()),y("Ushort",96,I()),y("Uint",112,F()),y("SmallUint",82,C()),y("Uint0",67,void 0,0),y("Ulong",128,{write:E,read:M}),y("SmallUlong",83,C()),y("Ulong0",68,void 0,0),y("Byte",81,P()),y("Short",97,S()),y("Int",113,B()),y("SmallInt",84,P()),y("Long",129,{write:L,read:D}),y("SmallLong",85,P()),y("Float",114,x()),y("Double",130,w()),y("Decimal32",116),y("Decimal64",132),y("Decimal128",148),y("CharUTF32",115,F()),y("Timestamp",131,{write:W,read:V}),y("Uuid",152),y("Vbin8",160),y("Vbin32",176),y("Str8",161,{encoding:"utf8"}),y("Str32",177,{encoding:"utf8"}),y("Sym8",163,{encoding:"ascii"}),y("Sym32",179,{encoding:"ascii"}),y("List0",69,void 0,[]),y("List8",192),y("List32",208),y("Map8",193),y("Map32",209),y("Array8",224),y("Array32",240);function H(e,o){for(var b=0;b<o.length;b++)if(e.type.typecode===o[b].typecode)return!0;return!1}function q(e,o,b){for(var z=0;z<o&&z<e.length;z++)if(e[z]!==(b?255:0))return!1;return!0}c.is_ulong=function(e){return H(e,[c.Ulong,c.Ulong0,c.SmallUlong])},c.is_string=function(e){return H(e,[c.Str8,c.Str32])},c.is_symbol=function(e){return H(e,[c.Sym8,c.Sym32])},c.is_list=function(e){return H(e,[c.List0,c.List8,c.List32])},c.is_map=function(e){return H(e,[c.Map8,c.Map32])},c.wrap_boolean=function(e){return e?c.True():c.False()},c.wrap_ulong=function(e){return l.isBuffer(e)?q(e,8,!1)?c.Ulong0():q(e,7,!1)?c.SmallUlong(e[7]):c.Ulong(e):e===0?c.Ulong0():e>255?c.Ulong(e):c.SmallUlong(e)},c.wrap_uint=function(e){return e===0?c.Uint0():e>255?c.Uint(e):c.SmallUint(e)},c.wrap_ushort=function(e){return c.Ushort(e)},c.wrap_ubyte=function(e){return c.Ubyte(e)},c.wrap_long=function(e){if(l.isBuffer(e)){var o=(e[0]&128)!==0;return q(e,7,o)&&(e[7]&128)===(o?128:0)?c.SmallLong(o?-((e[7]^255)+1):e[7]):c.Long(e)}else return e>127||e<-128?c.Long(e):c.SmallLong(e)},c.wrap_int=function(e){return e>127||e<-128?c.Int(e):c.SmallInt(e)},c.wrap_short=function(e){return c.Short(e)},c.wrap_byte=function(e){return c.Byte(e)},c.wrap_float=function(e){return c.Float(e)},c.wrap_double=function(e){return c.Double(e)},c.wrap_timestamp=function(e){return c.Timestamp(e)},c.wrap_char=function(e){return c.CharUTF32(e)},c.wrap_uuid=function(e){return c.Uuid(e)},c.wrap_binary=function(e){return e.length>255?c.Vbin32(e):c.Vbin8(e)},c.wrap_string=function(e){return l.byteLength(e)>255?c.Str32(e):c.Str8(e)},c.wrap_symbol=function(e){return l.byteLength(e)>255?c.Sym32(e):c.Sym8(e)},c.wrap_list=function(e){if(e.length===0)return c.List0();var o=e.map(c.wrap);return c.List32(o)},c.wrap_set_as_list=function(e){if(e.size===0)return c.List0();var o=Array.from(e,c.wrap);return c.List32(o)},c.wrap_map=function(e,o){var b=[];for(var z in e)b.push(o?o(z):c.wrap(z)),b.push(c.wrap(e[z]));return c.Map32(b)},c.wrap_map_as_map=function(e){var o=[];for(var[b,z]of e)o.push(c.wrap(b)),o.push(c.wrap(z));return c.Map32(o)},c.wrap_symbolic_map=function(e){return c.wrap_map(e,c.wrap_symbol)},c.wrap_array=function(e,o,b){if(o)return c.Array32(e,o,b);throw console.trace("An array must specify a type for its elements"),new u.TypeError("An array must specify a type for its elements")},c.wrap=function(e){var o=typeof e;return o==="object"&&e!==null&&typeof e.toRheaTyped=="function"?e.toRheaTyped():o==="string"?c.wrap_string(e):o==="boolean"?e?c.True():c.False():o==="number"||e instanceof Number?isNaN(e)?c.Null():Math.floor(e)-e!==0?c.Double(e):e>0?e<r?c.wrap_uint(e):c.wrap_ulong(e):e>a?c.wrap_int(e):c.wrap_long(e):e instanceof Date?c.wrap_timestamp(e.getTime()):e instanceof l||e instanceof Uint8Array?c.wrap_binary(e):o==="undefined"||e===null?c.Null():Array.isArray(e)?c.wrap_list(e):e instanceof Map?c.wrap_map_as_map(e):e instanceof Set?c.wrap_set_as_list(e):c.wrap_map(e)},c.wrap_described=function(e,o){var b=c.wrap(e);return o&&(typeof o=="string"?b=c.described(c.wrap_symbol(o),b):(typeof o=="number"||o instanceof Number)&&(b=c.described(c.wrap_ulong(o),b))),b},c.wrap_message_id=function(e){var o=typeof e;if(o==="string")return c.wrap_string(e);if(o==="number"||e instanceof Number)return c.wrap_ulong(e);if(l.isBuffer(e))return c.wrap_uuid(e);throw new u.TypeError("invalid message id:"+e)};function Q(e){for(var o={},b=0;b+1<e.length;)o[e[b++]]=e[b++];return o}var ie={};c.unwrap_map_simple=function(e){return Q(e.value.map(function(o){return c.unwrap(o,!0)}))},c.unwrap=function(e,o){if(e instanceof p){if(e.descriptor){var b=ie[e.descriptor.value];if(b)return new b(e.value);if(o)return e}var z=c.unwrap(e.value,!0);return c.is_map(e)?Q(z):z}else return Array.isArray(e)?e.map(function(J){return c.unwrap(J,!0)}):e},c.described_nc=function(e,o){return e.length?(o.descriptor=e.shift(),c.described(e,o)):(o.descriptor=e,o)},c.described=c.described_nc;function ne(e){var o=c.by_code[e];if(!o)throw new u.TypeError("Unrecognised typecode: "+T(e));return o}c.Reader=function(e){this.buffer=e,this.position=0},c.Reader.prototype.read_typecode=function(){return this.read_uint(1)},c.Reader.prototype.read_uint=function(e){var o=this.position;if(this.position+=e,e===1)return this.buffer.readUInt8(o);if(e===2)return this.buffer.readUInt16BE(o);if(e===4)return this.buffer.readUInt32BE(o);throw new u.TypeError("Unexpected width for uint "+e)},c.Reader.prototype.read_fixed_width=function(e){var o=this.position;return this.position+=e.width,e.read?e.read(this.buffer,o):this.buffer.slice(o,this.position)},c.Reader.prototype.read_variable_width=function(e){var o=this.read_uint(e.width),b=this.read_bytes(o);return e.encoding?b.toString(e.encoding):b},c.Reader.prototype.read=function(){var e=this.read_constructor(),o=this.read_value(ne(e.typecode));return e.descriptor?c.described_nc(e.descriptor,o):o},c.Reader.prototype.read_constructor=function(e){var o=this.read_typecode();return o===0?(e===void 0&&(e=[]),e.push(this.read()),this.read_constructor(e)):e===void 0?{typecode:o}:e.length===1?{typecode:o,descriptor:e[0]}:{typecode:o,descriptor:e[0],descriptors:e}},c.Reader.prototype.read_value=function(e){if(e.width===0)return e.create();if(e.category===A)return e.create(this.read_fixed_width(e));if(e.category===d)return e.create(this.read_variable_width(e));if(e.category===h)return this.read_compound(e);if(e.category===i)return this.read_array(e);throw new u.TypeError("Invalid category for type: "+e)},c.Reader.prototype.read_array_items=function(e,o){for(var b=[];b.length<e;)b.push(this.read_value(o));return b},c.Reader.prototype.read_n=function(e){for(var o=new Array(e),b=0;b<e;b++)o[b]=this.read();return o},c.Reader.prototype.read_size_count=function(e){return{size:this.read_uint(e),count:this.read_uint(e)}},c.Reader.prototype.read_compound=function(e){var o=this.read_size_count(e.width);return e.create(this.read_n(o.count))},c.Reader.prototype.read_array=function(e){var o=this.read_size_count(e.width),b=this.read_constructor();return e.create(this.read_array_items(o.count,ne(b.typecode)),b.typecode,b.descriptor)},c.Reader.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var o=this.position;o<this.buffer.length;o++)o>0&&(e+=","),e+="0x"+Number(this.buffer[o]).toString(16);return e},c.Reader.prototype.reset=function(){this.position=0},c.Reader.prototype.skip=function(e){this.position+=e},c.Reader.prototype.read_bytes=function(e){var o=this.position;return this.position+=e,this.buffer.slice(o,this.position)},c.Reader.prototype.remaining=function(){return this.buffer.length-this.position},c.Writer=function(e){this.buffer=e||_.allocate_buffer(1024),this.position=0},c.Writer.prototype.toBuffer=function(){return this.buffer.slice(0,this.position)};function ue(e,o){return e>o?e:o}c.Writer.prototype.ensure=function(e){if(this.buffer.length<e){var o=_.allocate_buffer(ue(this.buffer.length*2,e));this.buffer.copy(o),this.buffer=o}},c.Writer.prototype.write_typecode=function(e){this.write_uint(e,1)},c.Writer.prototype.write_uint=function(e,o){var b=this.position;if(this.ensure(this.position+o),this.position+=o,o===1)return this.buffer.writeUInt8(e,b);if(o===2)return this.buffer.writeUInt16BE(e,b);if(o===4)return this.buffer.writeUInt32BE(e,b);throw new u.TypeError("Unexpected width for uint "+o)},c.Writer.prototype.write_fixed_width=function(e,o){var b=this.position;if(this.ensure(this.position+e.width),this.position+=e.width,e.write)e.write(this.buffer,o,b);else if(o.copy)o.copy(this.buffer,b);else throw new u.TypeError("Cannot handle write for "+e)},c.Writer.prototype.write_variable_width=function(e,o){var b=e.encoding?l.from(o,e.encoding):l.from(o);this.write_uint(b.length,e.width),this.write_bytes(b)},c.Writer.prototype.write_bytes=function(e){var o=this.position;this.ensure(this.position+e.length),this.position+=e.length,e.copy(this.buffer,o)},c.Writer.prototype.write_constructor=function(e,o){o&&(this.write_typecode(0),this.write(o)),this.write_typecode(e)},c.Writer.prototype.write=function(e){if(e.type===void 0)if(e.described)this.write(e.described());else throw new u.TypeError("Cannot write "+JSON.stringify(e));else this.write_constructor(e.type.typecode,e.descriptor),this.write_value(e.type,e.value,e.array_constructor)},c.Writer.prototype.write_value=function(e,o,b){if(e.width!==0)if(e.category===A)this.write_fixed_width(e,o);else if(e.category===d)this.write_variable_width(e,o);else if(e.category===h)this.write_compound(e,o);else if(e.category===i)this.write_array(e,o,b);else throw new u.TypeError("Invalid category "+e.category+" for type: "+e)},c.Writer.prototype.backfill_size=function(e,o){var b=this.position-o;this.position=o,this.write_uint(b-e,e),this.position+=b-e},c.Writer.prototype.write_compound=function(e,o){var b=this.position;this.position+=e.width,this.write_uint(o.length,e.width);for(var z=0;z<o.length;z++)o[z]===void 0||o[z]===null?this.write(c.Null()):this.write(o[z]);this.backfill_size(e.width,b)},c.Writer.prototype.write_array=function(e,o,b){var z=this.position;this.position+=e.width,this.write_uint(o.length,e.width),this.write_constructor(b.typecode,b.descriptor);for(var J=ne(b.typecode),X=0;X<o.length;X++)this.write_value(J,o[X]);this.backfill_size(e.width,z)},c.Writer.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var o=0;o<this.position;o++)o>0&&(e+=","),e+=("00"+Number(this.buffer[o]).toString(16)).slice(-2);return e},c.Writer.prototype.skip=function(e){this.ensure(this.position+e),this.position+=e},c.Writer.prototype.clear=function(){this.buffer.fill(0),this.position=0},c.Writer.prototype.remaining=function(){return this.buffer.length-this.position};function ce(e){if(e==="symbol")return{typecode:c.Sym8.typecode};throw new u.TypeError("TODO: Array of type "+e+" not yet supported")}function g(e,o){if(o!=null)if(Array.isArray(o)){if(!e.multiple)throw new u.TypeError("Field "+e.name+" does not support multiple values, got "+JSON.stringify(o));var b=ce(e.type);return c.wrap_array(o,b.typecode,b.descriptor)}else{if(e.type==="*")return o;var z=c["wrap_"+e.type];if(z)return z(o);throw new u.TypeError("No wrapper for field "+e.name+" of type "+e.type)}else{if(e.mandatory)throw new u.TypeError("Field "+e.name+" is mandatory");return c.Null()}}function O(e,o){var b;o.type==="*"?b=function(){return this.value[e]}:b=function(){return c.unwrap(this.value[e])};var z=function(J){this.value[e]=g(o,J)};return{get:b,set:z,enumerable:!0,configurable:!1}}c.define_composite=function(e){var o=function(J){this.value=J||[]};o.descriptor={numeric:e.code,symbolic:"amqp:"+e.name+":list"},o.prototype.dispatch=function(J,X){J["on_"+e.name](X)};for(var b=0;b<e.fields.length;b++){var z=e.fields[b];Object.defineProperty(o.prototype,z.name,O(b,z))}return o.toString=function(){return e.name+"#"+Number(e.code).toString(16)},o.prototype.toJSON=function(){var J={};for(var X in this)X!=="value"&&this[X]&&(J[X]=this[X]);return J},o.create=function(J){var X=new o;for(var K in J)X[K]=J[K];return X},o.prototype.described=function(){return c.described_nc(c.wrap_ulong(o.descriptor.numeric),c.wrap_list(this.value))},o};function Y(e){var o=c.define_composite(e);c["wrap_"+e.name]=function(b){return o.create(b).described()},ie[Number(o.descriptor.numeric).toString(10)]=o,ie[o.descriptor.symbolic]=o}Y({name:"error",code:29,fields:[{name:"condition",type:"symbol",mandatory:!0},{name:"description",type:"string"},{name:"info",type:"map"}]}),k.exports=c}).call(this)}).call(this,m("buffer").Buffer)},{"./errors.js":3,"./util.js":15,buffer:20}],15:[function(m,k,v){(function(l){(function(){var u=m("./errors.js"),_={};_.allocate_buffer=function(d){return l.alloc?l.alloc(d):new l(d)},_.generate_uuid=function(){return _.uuid_to_string(_.uuid4())},_.uuid4=function(){for(var d=_.allocate_buffer(16),h=0;h<d.length;h++)d[h]=Math.random()*255|0;return d[7]&=15,d[7]|=64,d[8]&=63,d[8]|=128,d},_.uuid_to_string=function(d){if(d.length===16){var h=[d.slice(0,4),d.slice(4,6),d.slice(6,8),d.slice(8,10),d.slice(10,16)];return h.map(function(i){return i.toString("hex")}).join("-")}else throw new u.TypeError("Not a UUID, expecting 16 byte buffer")};var A=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/;_.string_to_uuid=function(d){var h=A.exec(d.toLowerCase());if(h)return l.from(h.slice(1).join(""),"hex");throw new u.TypeError("Not a valid UUID string: "+d)},_.clone=function(d){for(var h=Object.create(d.prototype||{}),i=Object.getOwnPropertyNames(d),p=0;p<i.length;p++){var j=i[p];h[j]=d[j]}return h},_.and=function(d,h){return h===void 0?d:function(i){return d(i)&&h(i)}},_.is_sender=function(d){return d.is_sender()},_.is_receiver=function(d){return d.is_receiver()},_.sender_filter=function(d){return _.and(_.is_sender,d)},_.receiver_filter=function(d){return _.and(_.is_receiver,d)},_.is_defined=function(d){return d!=null},k.exports=_}).call(this)}).call(this,m("buffer").Buffer)},{"./errors.js":3,buffer:20}],16:[function(m,k,v){(function(l){(function(){function u(h){return h}function _(h){return h instanceof ArrayBuffer?l.from(new Uint8Array(h)):l.from(h)}function A(h){return new Uint8Array(h)}function d(h){var i=u,p=u;return h.binaryType&&(h.binaryType="arraybuffer",i=_,p=A),{end:function(){h.close()},write:function(j){try{h.send(p(j),{binary:!0})}catch(T){h.onerror(T)}},on:function(j,T){j==="data"?h.onmessage=function(c){T(i(c.data))}:j==="end"?h.onclose=T:j==="error"?h.onerror=T:console.error("ERROR: Attempt to set unrecognised handler on websocket wrapper: "+j)},get_id_string:function(){return h.url}}}k.exports={connect:function(h){return function(i,p,j){return function(){return{connect:function(T,c,y,C){var I=new h(i,p,j);return I.onopen=C,d(I)}}}}},wrap:d}}).call(this)}).call(this,m("buffer").Buffer)},{buffer:20}],17:[function(m,k,v){(function(l){(function(){var u=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],_=typeof globalThis>"u"?l:globalThis;k.exports=function(){for(var d=[],h=0;h<u.length;h++)typeof _[u[h]]=="function"&&(d[d.length]=u[h]);return d}}).call(this)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],18:[function(m,k,v){v.byteLength=p,v.toByteArray=T,v.fromByteArray=C;for(var l=[],u=[],_=typeof Uint8Array<"u"?Uint8Array:Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,h=A.length;d<h;++d)l[d]=A[d],u[A.charCodeAt(d)]=d;u[45]=62,u[95]=63;function i(I){var F=I.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var P=I.indexOf("=");P===-1&&(P=F);var S=P===F?0:4-P%4;return[P,S]}function p(I){var F=i(I),P=F[0],S=F[1];return(P+S)*3/4-S}function j(I,F,P){return(F+P)*3/4-P}function T(I){var F,P=i(I),S=P[0],B=P[1],x=new _(j(I,S,B)),w=0,r=B>0?S-4:S,a;for(a=0;a<r;a+=4)F=u[I.charCodeAt(a)]<<18|u[I.charCodeAt(a+1)]<<12|u[I.charCodeAt(a+2)]<<6|u[I.charCodeAt(a+3)],x[w++]=F>>16&255,x[w++]=F>>8&255,x[w++]=F&255;return B===2&&(F=u[I.charCodeAt(a)]<<2|u[I.charCodeAt(a+1)]>>4,x[w++]=F&255),B===1&&(F=u[I.charCodeAt(a)]<<10|u[I.charCodeAt(a+1)]<<4|u[I.charCodeAt(a+2)]>>2,x[w++]=F>>8&255,x[w++]=F&255),x}function c(I){return l[I>>18&63]+l[I>>12&63]+l[I>>6&63]+l[I&63]}function y(I,F,P){for(var S,B=[],x=F;x<P;x+=3)S=(I[x]<<16&16711680)+(I[x+1]<<8&65280)+(I[x+2]&255),B.push(c(S));return B.join("")}function C(I){for(var F,P=I.length,S=P%3,B=[],x=16383,w=0,r=P-S;w<r;w+=x)B.push(y(I,w,w+x>r?r:w+x));return S===1?(F=I[P-1],B.push(l[F>>2]+l[F<<4&63]+"==")):S===2&&(F=(I[P-2]<<8)+I[P-1],B.push(l[F>>10]+l[F>>4&63]+l[F<<2&63]+"=")),B.join("")}},{}],19:[function(m,k,v){},{}],20:[function(m,k,v){(function(l){(function(){var u=m("base64-js"),_=m("ieee754");v.Buffer=i,v.SlowBuffer=S,v.INSPECT_MAX_BYTES=50;var A=2147483647;v.kMaxLength=A,i.TYPED_ARRAY_SUPPORT=d(),!i.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function d(){try{var f=new Uint8Array(1);return f.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},f.foo()===42}catch{return!1}}Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}});function h(f){if(f>A)throw new RangeError('The value "'+f+'" is invalid for option "size"');var t=new Uint8Array(f);return t.__proto__=i.prototype,t}function i(f,t,n){if(typeof f=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return c(f)}return p(f,t,n)}typeof Symbol<"u"&&Symbol.species!=null&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192;function p(f,t,n){if(typeof f=="string")return y(f,t);if(ArrayBuffer.isView(f))return C(f);if(f==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f);if(he(f,ArrayBuffer)||f&&he(f.buffer,ArrayBuffer))return I(f,t,n);if(typeof f=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var s=f.valueOf&&f.valueOf();if(s!=null&&s!==f)return i.from(s,t,n);var U=F(f);if(U)return U;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof f[Symbol.toPrimitive]=="function")return i.from(f[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f)}i.from=function(f,t,n){return p(f,t,n)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array;function j(f){if(typeof f!="number")throw new TypeError('"size" argument must be of type number');if(f<0)throw new RangeError('The value "'+f+'" is invalid for option "size"')}function T(f,t,n){return j(f),f<=0?h(f):t!==void 0?typeof n=="string"?h(f).fill(t,n):h(f).fill(t):h(f)}i.alloc=function(f,t,n){return T(f,t,n)};function c(f){return j(f),h(f<0?0:P(f)|0)}i.allocUnsafe=function(f){return c(f)},i.allocUnsafeSlow=function(f){return c(f)};function y(f,t){if((typeof t!="string"||t==="")&&(t="utf8"),!i.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=B(f,t)|0,s=h(n),U=s.write(f,t);return U!==n&&(s=s.slice(0,U)),s}function C(f){for(var t=f.length<0?0:P(f.length)|0,n=h(t),s=0;s<t;s+=1)n[s]=f[s]&255;return n}function I(f,t,n){if(t<0||f.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(f.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var s;return t===void 0&&n===void 0?s=new Uint8Array(f):n===void 0?s=new Uint8Array(f,t):s=new Uint8Array(f,t,n),s.__proto__=i.prototype,s}function F(f){if(i.isBuffer(f)){var t=P(f.length)|0,n=h(t);return n.length===0||f.copy(n,0,0,t),n}if(f.length!==void 0)return typeof f.length!="number"||de(f.length)?h(0):C(f);if(f.type==="Buffer"&&Array.isArray(f.data))return C(f.data)}function P(f){if(f>=A)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+A.toString(16)+" bytes");return f|0}function S(f){return+f!=f&&(f=0),i.alloc(+f)}i.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==i.prototype},i.compare=function(t,n){if(he(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),he(n,Uint8Array)&&(n=i.from(n,n.offset,n.byteLength)),!i.isBuffer(t)||!i.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===n)return 0;for(var s=t.length,U=n.length,N=0,G=Math.min(s,U);N<G;++N)if(t[N]!==n[N]){s=t[N],U=n[N];break}return s<U?-1:U<s?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,n){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return i.alloc(0);var s;if(n===void 0)for(n=0,s=0;s<t.length;++s)n+=t[s].length;var U=i.allocUnsafe(n),N=0;for(s=0;s<t.length;++s){var G=t[s];if(he(G,Uint8Array)&&(G=i.from(G)),!i.isBuffer(G))throw new TypeError('"list" argument must be an Array of Buffers');G.copy(U,N),N+=G.length}return U};function B(f,t){if(i.isBuffer(f))return f.length;if(ArrayBuffer.isView(f)||he(f,ArrayBuffer))return f.byteLength;if(typeof f!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof f);var n=f.length,s=arguments.length>2&&arguments[2]===!0;if(!s&&n===0)return 0;for(var U=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return K(f).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return n*2;case"hex":return n>>>1;case"base64":return ae(f).length;default:if(U)return s?-1:K(f).length;t=(""+t).toLowerCase(),U=!0}}i.byteLength=B;function x(f,t,n){var s=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((n===void 0||n>this.length)&&(n=this.length),n<=0)||(n>>>=0,t>>>=0,n<=t))return"";for(f||(f="utf8");;)switch(f){case"hex":return ce(this,t,n);case"utf8":case"utf-8":return q(this,t,n);case"ascii":return ne(this,t,n);case"latin1":case"binary":return ue(this,t,n);case"base64":return H(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),s=!0}}i.prototype._isBuffer=!0;function w(f,t,n){var s=f[t];f[t]=f[n],f[n]=s}i.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)w(this,n,n+1);return this},i.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)w(this,n,n+3),w(this,n+1,n+2);return this},i.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)w(this,n,n+7),w(this,n+1,n+6),w(this,n+2,n+5),w(this,n+3,n+4);return this},i.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?q(this,0,t):x.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:i.compare(this,t)===0},i.prototype.inspect=function(){var t="",n=v.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},i.prototype.compare=function(t,n,s,U,N){if(he(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),!i.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(n===void 0&&(n=0),s===void 0&&(s=t?t.length:0),U===void 0&&(U=0),N===void 0&&(N=this.length),n<0||s>t.length||U<0||N>this.length)throw new RangeError("out of range index");if(U>=N&&n>=s)return 0;if(U>=N)return-1;if(n>=s)return 1;if(n>>>=0,s>>>=0,U>>>=0,N>>>=0,this===t)return 0;for(var G=N-U,te=s-n,re=Math.min(G,te),oe=this.slice(U,N),fe=t.slice(n,s),se=0;se<re;++se)if(oe[se]!==fe[se]){G=oe[se],te=fe[se];break}return G<te?-1:te<G?1:0};function r(f,t,n,s,U){if(f.length===0)return-1;if(typeof n=="string"?(s=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,de(n)&&(n=U?0:f.length-1),n<0&&(n=f.length+n),n>=f.length){if(U)return-1;n=f.length-1}else if(n<0)if(U)n=0;else return-1;if(typeof t=="string"&&(t=i.from(t,s)),i.isBuffer(t))return t.length===0?-1:a(f,t,n,s,U);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?U?Uint8Array.prototype.indexOf.call(f,t,n):Uint8Array.prototype.lastIndexOf.call(f,t,n):a(f,[t],n,s,U);throw new TypeError("val must be string, number or Buffer")}function a(f,t,n,s,U){var N=1,G=f.length,te=t.length;if(s!==void 0&&(s=String(s).toLowerCase(),s==="ucs2"||s==="ucs-2"||s==="utf16le"||s==="utf-16le")){if(f.length<2||t.length<2)return-1;N=2,G/=2,te/=2,n/=2}function re(Qe,Ye){return N===1?Qe[Ye]:Qe.readUInt16BE(Ye*N)}var oe;if(U){var fe=-1;for(oe=n;oe<G;oe++)if(re(f,oe)===re(t,fe===-1?0:oe-fe)){if(fe===-1&&(fe=oe),oe-fe+1===te)return fe*N}else fe!==-1&&(oe-=oe-fe),fe=-1}else for(n+te>G&&(n=G-te),oe=n;oe>=0;oe--){for(var se=!0,we=0;we<te;we++)if(re(f,oe+we)!==re(t,we)){se=!1;break}if(se)return oe}return-1}i.prototype.includes=function(t,n,s){return this.indexOf(t,n,s)!==-1},i.prototype.indexOf=function(t,n,s){return r(this,t,n,s,!0)},i.prototype.lastIndexOf=function(t,n,s){return r(this,t,n,s,!1)};function E(f,t,n,s){n=Number(n)||0;var U=f.length-n;s?(s=Number(s),s>U&&(s=U)):s=U;var N=t.length;s>N/2&&(s=N/2);for(var G=0;G<s;++G){var te=parseInt(t.substr(G*2,2),16);if(de(te))return G;f[n+G]=te}return G}function M(f,t,n,s){return pe(K(t,f.length-n),f,n,s)}function L(f,t,n,s){return pe(Z(t),f,n,s)}function W(f,t,n,s){return L(f,t,n,s)}function D(f,t,n,s){return pe(ae(t),f,n,s)}function V(f,t,n,s){return pe(ee(t,f.length-n),f,n,s)}i.prototype.write=function(t,n,s,U){if(n===void 0)U="utf8",s=this.length,n=0;else if(s===void 0&&typeof n=="string")U=n,s=this.length,n=0;else if(isFinite(n))n=n>>>0,isFinite(s)?(s=s>>>0,U===void 0&&(U="utf8")):(U=s,s=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var N=this.length-n;if((s===void 0||s>N)&&(s=N),t.length>0&&(s<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");U||(U="utf8");for(var G=!1;;)switch(U){case"hex":return E(this,t,n,s);case"utf8":case"utf-8":return M(this,t,n,s);case"ascii":return L(this,t,n,s);case"latin1":case"binary":return W(this,t,n,s);case"base64":return D(this,t,n,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,t,n,s);default:if(G)throw new TypeError("Unknown encoding: "+U);U=(""+U).toLowerCase(),G=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function H(f,t,n){return t===0&&n===f.length?u.fromByteArray(f):u.fromByteArray(f.slice(t,n))}function q(f,t,n){n=Math.min(f.length,n);for(var s=[],U=t;U<n;){var N=f[U],G=null,te=N>239?4:N>223?3:N>191?2:1;if(U+te<=n){var re,oe,fe,se;switch(te){case 1:N<128&&(G=N);break;case 2:re=f[U+1],(re&192)===128&&(se=(N&31)<<6|re&63,se>127&&(G=se));break;case 3:re=f[U+1],oe=f[U+2],(re&192)===128&&(oe&192)===128&&(se=(N&15)<<12|(re&63)<<6|oe&63,se>2047&&(se<55296||se>57343)&&(G=se));break;case 4:re=f[U+1],oe=f[U+2],fe=f[U+3],(re&192)===128&&(oe&192)===128&&(fe&192)===128&&(se=(N&15)<<18|(re&63)<<12|(oe&63)<<6|fe&63,se>65535&&se<1114112&&(G=se))}}G===null?(G=65533,te=1):G>65535&&(G-=65536,s.push(G>>>10&1023|55296),G=56320|G&1023),s.push(G),U+=te}return ie(s)}var Q=4096;function ie(f){var t=f.length;if(t<=Q)return String.fromCharCode.apply(String,f);for(var n="",s=0;s<t;)n+=String.fromCharCode.apply(String,f.slice(s,s+=Q));return n}function ne(f,t,n){var s="";n=Math.min(f.length,n);for(var U=t;U<n;++U)s+=String.fromCharCode(f[U]&127);return s}function ue(f,t,n){var s="";n=Math.min(f.length,n);for(var U=t;U<n;++U)s+=String.fromCharCode(f[U]);return s}function ce(f,t,n){var s=f.length;(!t||t<0)&&(t=0),(!n||n<0||n>s)&&(n=s);for(var U="",N=t;N<n;++N)U+=X(f[N]);return U}function g(f,t,n){for(var s=f.slice(t,n),U="",N=0;N<s.length;N+=2)U+=String.fromCharCode(s[N]+s[N+1]*256);return U}i.prototype.slice=function(t,n){var s=this.length;t=~~t,n=n===void 0?s:~~n,t<0?(t+=s,t<0&&(t=0)):t>s&&(t=s),n<0?(n+=s,n<0&&(n=0)):n>s&&(n=s),n<t&&(n=t);var U=this.subarray(t,n);return U.__proto__=i.prototype,U};function O(f,t,n){if(f%1!==0||f<0)throw new RangeError("offset is not uint");if(f+t>n)throw new RangeError("Trying to access beyond buffer length")}i.prototype.readUIntLE=function(t,n,s){t=t>>>0,n=n>>>0,s||O(t,n,this.length);for(var U=this[t],N=1,G=0;++G<n&&(N*=256);)U+=this[t+G]*N;return U},i.prototype.readUIntBE=function(t,n,s){t=t>>>0,n=n>>>0,s||O(t,n,this.length);for(var U=this[t+--n],N=1;n>0&&(N*=256);)U+=this[t+--n]*N;return U},i.prototype.readUInt8=function(t,n){return t=t>>>0,n||O(t,1,this.length),this[t]},i.prototype.readUInt16LE=function(t,n){return t=t>>>0,n||O(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUInt16BE=function(t,n){return t=t>>>0,n||O(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUInt32LE=function(t,n){return t=t>>>0,n||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},i.prototype.readUInt32BE=function(t,n){return t=t>>>0,n||O(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,n,s){t=t>>>0,n=n>>>0,s||O(t,n,this.length);for(var U=this[t],N=1,G=0;++G<n&&(N*=256);)U+=this[t+G]*N;return N*=128,U>=N&&(U-=Math.pow(2,8*n)),U},i.prototype.readIntBE=function(t,n,s){t=t>>>0,n=n>>>0,s||O(t,n,this.length);for(var U=n,N=1,G=this[t+--U];U>0&&(N*=256);)G+=this[t+--U]*N;return N*=128,G>=N&&(G-=Math.pow(2,8*n)),G},i.prototype.readInt8=function(t,n){return t=t>>>0,n||O(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},i.prototype.readInt16LE=function(t,n){t=t>>>0,n||O(t,2,this.length);var s=this[t]|this[t+1]<<8;return s&32768?s|4294901760:s},i.prototype.readInt16BE=function(t,n){t=t>>>0,n||O(t,2,this.length);var s=this[t+1]|this[t]<<8;return s&32768?s|4294901760:s},i.prototype.readInt32LE=function(t,n){return t=t>>>0,n||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,n){return t=t>>>0,n||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,n){return t=t>>>0,n||O(t,4,this.length),_.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,n){return t=t>>>0,n||O(t,4,this.length),_.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,n){return t=t>>>0,n||O(t,8,this.length),_.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,n){return t=t>>>0,n||O(t,8,this.length),_.read(this,t,!1,52,8)};function Y(f,t,n,s,U,N){if(!i.isBuffer(f))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>U||t<N)throw new RangeError('"value" argument is out of bounds');if(n+s>f.length)throw new RangeError("Index out of range")}i.prototype.writeUIntLE=function(t,n,s,U){if(t=+t,n=n>>>0,s=s>>>0,!U){var N=Math.pow(2,8*s)-1;Y(this,t,n,s,N,0)}var G=1,te=0;for(this[n]=t&255;++te<s&&(G*=256);)this[n+te]=t/G&255;return n+s},i.prototype.writeUIntBE=function(t,n,s,U){if(t=+t,n=n>>>0,s=s>>>0,!U){var N=Math.pow(2,8*s)-1;Y(this,t,n,s,N,0)}var G=s-1,te=1;for(this[n+G]=t&255;--G>=0&&(te*=256);)this[n+G]=t/te&255;return n+s},i.prototype.writeUInt8=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,1,255,0),this[n]=t&255,n+1},i.prototype.writeUInt16LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,65535,0),this[n]=t&255,this[n+1]=t>>>8,n+2},i.prototype.writeUInt16BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,65535,0),this[n]=t>>>8,this[n+1]=t&255,n+2},i.prototype.writeUInt32LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,4294967295,0),this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=t&255,n+4},i.prototype.writeUInt32BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,4294967295,0),this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t&255,n+4},i.prototype.writeIntLE=function(t,n,s,U){if(t=+t,n=n>>>0,!U){var N=Math.pow(2,8*s-1);Y(this,t,n,s,N-1,-N)}var G=0,te=1,re=0;for(this[n]=t&255;++G<s&&(te*=256);)t<0&&re===0&&this[n+G-1]!==0&&(re=1),this[n+G]=(t/te>>0)-re&255;return n+s},i.prototype.writeIntBE=function(t,n,s,U){if(t=+t,n=n>>>0,!U){var N=Math.pow(2,8*s-1);Y(this,t,n,s,N-1,-N)}var G=s-1,te=1,re=0;for(this[n+G]=t&255;--G>=0&&(te*=256);)t<0&&re===0&&this[n+G+1]!==0&&(re=1),this[n+G]=(t/te>>0)-re&255;return n+s},i.prototype.writeInt8=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,1,127,-128),t<0&&(t=255+t+1),this[n]=t&255,n+1},i.prototype.writeInt16LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,32767,-32768),this[n]=t&255,this[n+1]=t>>>8,n+2},i.prototype.writeInt16BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,2,32767,-32768),this[n]=t>>>8,this[n+1]=t&255,n+2},i.prototype.writeInt32LE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,2147483647,-2147483648),this[n]=t&255,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24,n+4},i.prototype.writeInt32BE=function(t,n,s){return t=+t,n=n>>>0,s||Y(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t&255,n+4};function e(f,t,n,s,U,N){if(n+s>f.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function o(f,t,n,s,U){return t=+t,n=n>>>0,U||e(f,t,n,4),_.write(f,t,n,s,23,4),n+4}i.prototype.writeFloatLE=function(t,n,s){return o(this,t,n,!0,s)},i.prototype.writeFloatBE=function(t,n,s){return o(this,t,n,!1,s)};function b(f,t,n,s,U){return t=+t,n=n>>>0,U||e(f,t,n,8),_.write(f,t,n,s,52,8),n+8}i.prototype.writeDoubleLE=function(t,n,s){return b(this,t,n,!0,s)},i.prototype.writeDoubleBE=function(t,n,s){return b(this,t,n,!1,s)},i.prototype.copy=function(t,n,s,U){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),!U&&U!==0&&(U=this.length),n>=t.length&&(n=t.length),n||(n=0),U>0&&U<s&&(U=s),U===s||t.length===0||this.length===0)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(U<0)throw new RangeError("sourceEnd out of bounds");U>this.length&&(U=this.length),t.length-n<U-s&&(U=t.length-n+s);var N=U-s;if(this===t&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(n,s,U);else if(this===t&&s<n&&n<U)for(var G=N-1;G>=0;--G)t[G+n]=this[G+s];else Uint8Array.prototype.set.call(t,this.subarray(s,U),n);return N},i.prototype.fill=function(t,n,s,U){if(typeof t=="string"){if(typeof n=="string"?(U=n,n=0,s=this.length):typeof s=="string"&&(U=s,s=this.length),U!==void 0&&typeof U!="string")throw new TypeError("encoding must be a string");if(typeof U=="string"&&!i.isEncoding(U))throw new TypeError("Unknown encoding: "+U);if(t.length===1){var N=t.charCodeAt(0);(U==="utf8"&&N<128||U==="latin1")&&(t=N)}}else typeof t=="number"&&(t=t&255);if(n<0||this.length<n||this.length<s)throw new RangeError("Out of range index");if(s<=n)return this;n=n>>>0,s=s===void 0?this.length:s>>>0,t||(t=0);var G;if(typeof t=="number")for(G=n;G<s;++G)this[G]=t;else{var te=i.isBuffer(t)?t:i.from(t,U),re=te.length;if(re===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(G=0;G<s-n;++G)this[G+n]=te[G%re]}return this};var z=/[^+/0-9A-Za-z-_]/g;function J(f){if(f=f.split("=")[0],f=f.trim().replace(z,""),f.length<2)return"";for(;f.length%4!==0;)f=f+"=";return f}function X(f){return f<16?"0"+f.toString(16):f.toString(16)}function K(f,t){t=t||1/0;for(var n,s=f.length,U=null,N=[],G=0;G<s;++G){if(n=f.charCodeAt(G),n>55295&&n<57344){if(!U){if(n>56319){(t-=3)>-1&&N.push(239,191,189);continue}else if(G+1===s){(t-=3)>-1&&N.push(239,191,189);continue}U=n;continue}if(n<56320){(t-=3)>-1&&N.push(239,191,189),U=n;continue}n=(U-55296<<10|n-56320)+65536}else U&&(t-=3)>-1&&N.push(239,191,189);if(U=null,n<128){if((t-=1)<0)break;N.push(n)}else if(n<2048){if((t-=2)<0)break;N.push(n>>6|192,n&63|128)}else if(n<65536){if((t-=3)<0)break;N.push(n>>12|224,n>>6&63|128,n&63|128)}else if(n<1114112){if((t-=4)<0)break;N.push(n>>18|240,n>>12&63|128,n>>6&63|128,n&63|128)}else throw new Error("Invalid code point")}return N}function Z(f){for(var t=[],n=0;n<f.length;++n)t.push(f.charCodeAt(n)&255);return t}function ee(f,t){for(var n,s,U,N=[],G=0;G<f.length&&!((t-=2)<0);++G)n=f.charCodeAt(G),s=n>>8,U=n%256,N.push(U),N.push(s);return N}function ae(f){return u.toByteArray(J(f))}function pe(f,t,n,s){for(var U=0;U<s&&!(U+n>=t.length||U>=f.length);++U)t[U+n]=f[U];return U}function he(f,t){return f instanceof t||f!=null&&f.constructor!=null&&f.constructor.name!=null&&f.constructor.name===t.name}function de(f){return f!==f}}).call(this)}).call(this,m("buffer").Buffer)},{"base64-js":18,buffer:20,ieee754:35}],21:[function(m,k,v){var l=m("get-intrinsic"),u=m("./"),_=u(l("String.prototype.indexOf"));k.exports=function(d,h){var i=l(d,!!h);return typeof i=="function"&&_(d,".prototype.")>-1?u(i):i}},{"./":22,"get-intrinsic":30}],22:[function(m,k,v){var l=m("function-bind"),u=m("get-intrinsic"),_=u("%Function.prototype.apply%"),A=u("%Function.prototype.call%"),d=u("%Reflect.apply%",!0)||l.call(A,_),h=u("%Object.getOwnPropertyDescriptor%",!0),i=u("%Object.defineProperty%",!0),p=u("%Math.max%");if(i)try{i({},"a",{value:1})}catch{i=null}k.exports=function(c){var y=d(l,A,arguments);if(h&&i){var C=h(y,"length");C.configurable&&i(y,"length",{value:1+p(0,c.length-(arguments.length-1))})}return y};var j=function(){return d(l,_,arguments)};i?i(k.exports,"apply",{value:j}):k.exports.apply=j},{"function-bind":29,"get-intrinsic":30}],23:[function(m,k,v){(function(l){(function(){v.formatArgs=_,v.save=A,v.load=d,v.useColors=u,v.storage=h(),v.destroy=(()=>{let p=!1;return()=>{p||(p=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),v.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function u(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function _(p){if(p[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+p[0]+(this.useColors?"%c ":" ")+"+"+k.exports.humanize(this.diff),!this.useColors)return;const j="color: "+this.color;p.splice(1,0,j,"color: inherit");let T=0,c=0;p[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(T++,y==="%c"&&(c=T))}),p.splice(c,0,j)}v.log=console.debug||console.log||(()=>{});function A(p){try{p?v.storage.setItem("debug",p):v.storage.removeItem("debug")}catch{}}function d(){let p;try{p=v.storage.getItem("debug")}catch{}return!p&&typeof l<"u"&&"env"in l&&(p=l.env.DEBUG),p}function h(){try{return localStorage}catch{}}k.exports=m("./common")(v);const{formatters:i}=k.exports;i.j=function(p){try{return JSON.stringify(p)}catch(j){return"[UnexpectedJSONParseError]: "+j.message}}}).call(this)}).call(this,m("_process"))},{"./common":24,_process:43}],24:[function(m,k,v){function l(u){A.debug=A,A.default=A,A.coerce=T,A.disable=i,A.enable=h,A.enabled=p,A.humanize=m("ms"),A.destroy=c,Object.keys(u).forEach(y=>{A[y]=u[y]}),A.names=[],A.skips=[],A.formatters={};function _(y){let C=0;for(let I=0;I<y.length;I++)C=(C<<5)-C+y.charCodeAt(I),C|=0;return A.colors[Math.abs(C)%A.colors.length]}A.selectColor=_;function A(y){let C,I=null,F,P;function S(...B){if(!S.enabled)return;const x=S,w=Number(new Date),r=w-(C||w);x.diff=r,x.prev=C,x.curr=w,C=w,B[0]=A.coerce(B[0]),typeof B[0]!="string"&&B.unshift("%O");let a=0;B[0]=B[0].replace(/%([a-zA-Z%])/g,(M,L)=>{if(M==="%%")return"%";a++;const W=A.formatters[L];if(typeof W=="function"){const D=B[a];M=W.call(x,D),B.splice(a,1),a--}return M}),A.formatArgs.call(x,B),(x.log||A.log).apply(x,B)}return S.namespace=y,S.useColors=A.useColors(),S.color=A.selectColor(y),S.extend=d,S.destroy=A.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>I!==null?I:(F!==A.namespaces&&(F=A.namespaces,P=A.enabled(y)),P),set:B=>{I=B}}),typeof A.init=="function"&&A.init(S),S}function d(y,C){const I=A(this.namespace+(typeof C>"u"?":":C)+y);return I.log=this.log,I}function h(y){A.save(y),A.namespaces=y,A.names=[],A.skips=[];let C;const I=(typeof y=="string"?y:"").split(/[\s,]+/),F=I.length;for(C=0;C<F;C++)I[C]&&(y=I[C].replace(/\*/g,".*?"),y[0]==="-"?A.skips.push(new RegExp("^"+y.slice(1)+"$")):A.names.push(new RegExp("^"+y+"$")))}function i(){const y=[...A.names.map(j),...A.skips.map(j).map(C=>"-"+C)].join(",");return A.enable(""),y}function p(y){if(y[y.length-1]==="*")return!0;let C,I;for(C=0,I=A.skips.length;C<I;C++)if(A.skips[C].test(y))return!1;for(C=0,I=A.names.length;C<I;C++)if(A.names[C].test(y))return!0;return!1}function j(y){return y.toString().substring(2,y.toString().length-2).replace(/\.\*\?$/,"*")}function T(y){return y instanceof Error?y.stack||y.message:y}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return A.enable(A.load()),A}k.exports=l},{ms:40}],25:[function(m,k,v){var l=m("get-intrinsic"),u=l("%Object.getOwnPropertyDescriptor%",!0);if(u)try{u([],"length")}catch{u=null}k.exports=u},{"get-intrinsic":30}],26:[function(m,k,v){var l=typeof Reflect=="object"?Reflect:null,u=l&&typeof l.apply=="function"?l.apply:function(a,E,M){return Function.prototype.apply.call(a,E,M)},_;l&&typeof l.ownKeys=="function"?_=l.ownKeys:Object.getOwnPropertySymbols?_=function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:_=function(a){return Object.getOwnPropertyNames(a)};function A(r){console&&console.warn&&console.warn(r)}var d=Number.isNaN||function(a){return a!==a};function h(){h.init.call(this)}k.exports=h,k.exports.once=B,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var i=10;function p(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(r){if(typeof r!="number"||r<0||d(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");i=r}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||d(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this};function j(r){return r._maxListeners===void 0?h.defaultMaxListeners:r._maxListeners}h.prototype.getMaxListeners=function(){return j(this)},h.prototype.emit=function(a){for(var E=[],M=1;M<arguments.length;M++)E.push(arguments[M]);var L=a==="error",W=this._events;if(W!==void 0)L=L&&W.error===void 0;else if(!L)return!1;if(L){var D;if(E.length>0&&(D=E[0]),D instanceof Error)throw D;var V=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw V.context=D,V}var H=W[a];if(H===void 0)return!1;if(typeof H=="function")u(H,this,E);else for(var q=H.length,Q=F(H,q),M=0;M<q;++M)u(Q[M],this,E);return!0};function T(r,a,E,M){var L,W,D;if(p(E),W=r._events,W===void 0?(W=r._events=Object.create(null),r._eventsCount=0):(W.newListener!==void 0&&(r.emit("newListener",a,E.listener?E.listener:E),W=r._events),D=W[a]),D===void 0)D=W[a]=E,++r._eventsCount;else if(typeof D=="function"?D=W[a]=M?[E,D]:[D,E]:M?D.unshift(E):D.push(E),L=j(r),L>0&&D.length>L&&!D.warned){D.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=r,V.type=a,V.count=D.length,A(V)}return r}h.prototype.addListener=function(a,E){return T(this,a,E,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(a,E){return T(this,a,E,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(r,a,E){var M={fired:!1,wrapFn:void 0,target:r,type:a,listener:E},L=c.bind(M);return L.listener=E,M.wrapFn=L,L}h.prototype.once=function(a,E){return p(E),this.on(a,y(this,a,E)),this},h.prototype.prependOnceListener=function(a,E){return p(E),this.prependListener(a,y(this,a,E)),this},h.prototype.removeListener=function(a,E){var M,L,W,D,V;if(p(E),L=this._events,L===void 0)return this;if(M=L[a],M===void 0)return this;if(M===E||M.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete L[a],L.removeListener&&this.emit("removeListener",a,M.listener||E));else if(typeof M!="function"){for(W=-1,D=M.length-1;D>=0;D--)if(M[D]===E||M[D].listener===E){V=M[D].listener,W=D;break}if(W<0)return this;W===0?M.shift():P(M,W),M.length===1&&(L[a]=M[0]),L.removeListener!==void 0&&this.emit("removeListener",a,V||E)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(a){var E,M,L;if(M=this._events,M===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[a]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete M[a]),this;if(arguments.length===0){var W=Object.keys(M),D;for(L=0;L<W.length;++L)D=W[L],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=M[a],typeof E=="function")this.removeListener(a,E);else if(E!==void 0)for(L=E.length-1;L>=0;L--)this.removeListener(a,E[L]);return this};function C(r,a,E){var M=r._events;if(M===void 0)return[];var L=M[a];return L===void 0?[]:typeof L=="function"?E?[L.listener||L]:[L]:E?S(L):F(L,L.length)}h.prototype.listeners=function(a){return C(this,a,!0)},h.prototype.rawListeners=function(a){return C(this,a,!1)},h.listenerCount=function(r,a){return typeof r.listenerCount=="function"?r.listenerCount(a):I.call(r,a)},h.prototype.listenerCount=I;function I(r){var a=this._events;if(a!==void 0){var E=a[r];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function F(r,a){for(var E=new Array(a),M=0;M<a;++M)E[M]=r[M];return E}function P(r,a){for(;a+1<r.length;a++)r[a]=r[a+1];r.pop()}function S(r){for(var a=new Array(r.length),E=0;E<a.length;++E)a[E]=r[E].listener||r[E];return a}function B(r,a){return new Promise(function(E,M){function L(D){r.removeListener(a,W),M(D)}function W(){typeof r.removeListener=="function"&&r.removeListener("error",L),E([].slice.call(arguments))}w(r,a,W,{once:!0}),a!=="error"&&x(r,L,{once:!0})})}function x(r,a,E){typeof r.on=="function"&&w(r,"error",a,E)}function w(r,a,E,M){if(typeof r.on=="function")M.once?r.once(a,E):r.on(a,E);else if(typeof r.addEventListener=="function")r.addEventListener(a,function L(W){M.once&&r.removeEventListener(a,L),E(W)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}},{}],27:[function(m,k,v){var l=Object.prototype.hasOwnProperty,u=Object.prototype.toString;k.exports=function(A,d,h){if(u.call(d)!=="[object Function]")throw new TypeError("iterator must be a function");var i=A.length;if(i===+i)for(var p=0;p<i;p++)d.call(h,A[p],p,A);else for(var j in A)l.call(A,j)&&d.call(h,A[j],j,A)}},{}],28:[function(m,k,v){var l="Function.prototype.bind called on incompatible ",u=Array.prototype.slice,_=Object.prototype.toString,A="[object Function]";k.exports=function(h){var i=this;if(typeof i!="function"||_.call(i)!==A)throw new TypeError(l+i);for(var p=u.call(arguments,1),j,T=function(){if(this instanceof j){var F=i.apply(this,p.concat(u.call(arguments)));return Object(F)===F?F:this}else return i.apply(h,p.concat(u.call(arguments)))},c=Math.max(0,i.length-p.length),y=[],C=0;C<c;C++)y.push("$"+C);if(j=Function("binder","return function ("+y.join(",")+"){ return binder.apply(this,arguments); }")(T),i.prototype){var I=function(){};I.prototype=i.prototype,j.prototype=new I,I.prototype=null}return j}},{}],29:[function(m,k,v){var l=m("./implementation");k.exports=Function.prototype.bind||l},{"./implementation":28}],30:[function(m,k,v){var l,u=SyntaxError,_=Function,A=TypeError,d=function(W){try{return _('"use strict"; return ('+W+").constructor;")()}catch{}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch{h=null}var i=function(){throw new A},p=h?(function(){try{return arguments.callee,i}catch{try{return h(arguments,"callee").get}catch{return i}}})():i,j=m("has-symbols")(),T=Object.getPrototypeOf||function(W){return W.__proto__},c={},y=typeof Uint8Array>"u"?l:T(Uint8Array),C={"%AggregateError%":typeof AggregateError>"u"?l:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?l:ArrayBuffer,"%ArrayIteratorPrototype%":j?T([][Symbol.iterator]()):l,"%AsyncFromSyncIteratorPrototype%":l,"%AsyncFunction%":c,"%AsyncGenerator%":c,"%AsyncGeneratorFunction%":c,"%AsyncIteratorPrototype%":c,"%Atomics%":typeof Atomics>"u"?l:Atomics,"%BigInt%":typeof BigInt>"u"?l:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?l:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?l:Float32Array,"%Float64Array%":typeof Float64Array>"u"?l:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?l:FinalizationRegistry,"%Function%":_,"%GeneratorFunction%":c,"%Int8Array%":typeof Int8Array>"u"?l:Int8Array,"%Int16Array%":typeof Int16Array>"u"?l:Int16Array,"%Int32Array%":typeof Int32Array>"u"?l:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":j?T(T([][Symbol.iterator]())):l,"%JSON%":typeof JSON=="object"?JSON:l,"%Map%":typeof Map>"u"?l:Map,"%MapIteratorPrototype%":typeof Map>"u"||!j?l:T(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?l:Promise,"%Proxy%":typeof Proxy>"u"?l:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?l:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?l:Set,"%SetIteratorPrototype%":typeof Set>"u"||!j?l:T(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?l:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":j?T(""[Symbol.iterator]()):l,"%Symbol%":j?Symbol:l,"%SyntaxError%":u,"%ThrowTypeError%":p,"%TypedArray%":y,"%TypeError%":A,"%Uint8Array%":typeof Uint8Array>"u"?l:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?l:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?l:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?l:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?l:WeakMap,"%WeakRef%":typeof WeakRef>"u"?l:WeakRef,"%WeakSet%":typeof WeakSet>"u"?l:WeakSet},I=function W(D){var V;if(D==="%AsyncFunction%")V=d("async function () {}");else if(D==="%GeneratorFunction%")V=d("function* () {}");else if(D==="%AsyncGeneratorFunction%")V=d("async function* () {}");else if(D==="%AsyncGenerator%"){var H=W("%AsyncGeneratorFunction%");H&&(V=H.prototype)}else if(D==="%AsyncIteratorPrototype%"){var q=W("%AsyncGenerator%");q&&(V=T(q.prototype))}return C[D]=V,V},F={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},P=m("function-bind"),S=m("has"),B=P.call(Function.call,Array.prototype.concat),x=P.call(Function.apply,Array.prototype.splice),w=P.call(Function.call,String.prototype.replace),r=P.call(Function.call,String.prototype.slice),a=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,E=/\\(\\)?/g,M=function(D){var V=r(D,0,1),H=r(D,-1);if(V==="%"&&H!=="%")throw new u("invalid intrinsic syntax, expected closing `%`");if(H==="%"&&V!=="%")throw new u("invalid intrinsic syntax, expected opening `%`");var q=[];return w(D,a,function(Q,ie,ne,ue){q[q.length]=ne?w(ue,E,"$1"):ie||Q}),q},L=function(D,V){var H=D,q;if(S(F,H)&&(q=F[H],H="%"+q[0]+"%"),S(C,H)){var Q=C[H];if(Q===c&&(Q=I(H)),typeof Q>"u"&&!V)throw new A("intrinsic "+D+" exists, but is not available. Please file an issue!");return{alias:q,name:H,value:Q}}throw new u("intrinsic "+D+" does not exist!")};k.exports=function(D,V){if(typeof D!="string"||D.length===0)throw new A("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof V!="boolean")throw new A('"allowMissing" argument must be a boolean');var H=M(D),q=H.length>0?H[0]:"",Q=L("%"+q+"%",V),ie=Q.name,ne=Q.value,ue=!1,ce=Q.alias;ce&&(q=ce[0],x(H,B([0,1],ce)));for(var g=1,O=!0;g<H.length;g+=1){var Y=H[g],e=r(Y,0,1),o=r(Y,-1);if((e==='"'||e==="'"||e==="`"||o==='"'||o==="'"||o==="`")&&e!==o)throw new u("property names with quotes must have matching quotes");if((Y==="constructor"||!O)&&(ue=!0),q+="."+Y,ie="%"+q+"%",S(C,ie))ne=C[ie];else if(ne!=null){if(!(Y in ne)){if(!V)throw new A("base intrinsic for "+D+" exists, but the property is not available.");return}if(h&&g+1>=H.length){var b=h(ne,Y);O=!!b,O&&"get"in b&&!("originalValue"in b.get)?ne=b.get:ne=ne[Y]}else O=S(ne,Y),ne=ne[Y];O&&!ue&&(C[ie]=ne)}}return ne}},{"function-bind":29,has:34,"has-symbols":31}],31:[function(m,k,v){var l=typeof Symbol<"u"&&Symbol,u=m("./shams");k.exports=function(){return typeof l!="function"||typeof Symbol!="function"||typeof l("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:u()}},{"./shams":32}],32:[function(m,k,v){k.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var u={},_=Symbol("test"),A=Object(_);if(typeof _=="string"||Object.prototype.toString.call(_)!=="[object Symbol]"||Object.prototype.toString.call(A)!=="[object Symbol]")return!1;var d=42;u[_]=d;for(_ in u)return!1;if(typeof Object.keys=="function"&&Object.keys(u).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(u).length!==0)return!1;var h=Object.getOwnPropertySymbols(u);if(h.length!==1||h[0]!==_||!Object.prototype.propertyIsEnumerable.call(u,_))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(u,_);if(i.value!==d||i.enumerable!==!0)return!1}return!0}},{}],33:[function(m,k,v){var l=m("has-symbols/shams");k.exports=function(){return l()&&!!Symbol.toStringTag}},{"has-symbols/shams":32}],34:[function(m,k,v){var l=m("function-bind");k.exports=l.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":29}],35:[function(m,k,v){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */v.read=function(l,u,_,A,d){var h,i,p=d*8-A-1,j=(1<<p)-1,T=j>>1,c=-7,y=_?d-1:0,C=_?-1:1,I=l[u+y];for(y+=C,h=I&(1<<-c)-1,I>>=-c,c+=p;c>0;h=h*256+l[u+y],y+=C,c-=8);for(i=h&(1<<-c)-1,h>>=-c,c+=A;c>0;i=i*256+l[u+y],y+=C,c-=8);if(h===0)h=1-T;else{if(h===j)return i?NaN:(I?-1:1)*(1/0);i=i+Math.pow(2,A),h=h-T}return(I?-1:1)*i*Math.pow(2,h-A)},v.write=function(l,u,_,A,d,h){var i,p,j,T=h*8-d-1,c=(1<<T)-1,y=c>>1,C=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=A?0:h-1,F=A?1:-1,P=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(p=isNaN(u)?1:0,i=c):(i=Math.floor(Math.log(u)/Math.LN2),u*(j=Math.pow(2,-i))<1&&(i--,j*=2),i+y>=1?u+=C/j:u+=C*Math.pow(2,1-y),u*j>=2&&(i++,j/=2),i+y>=c?(p=0,i=c):i+y>=1?(p=(u*j-1)*Math.pow(2,d),i=i+y):(p=u*Math.pow(2,y-1)*Math.pow(2,d),i=0));d>=8;l[_+I]=p&255,I+=F,p/=256,d-=8);for(i=i<<d|p,T+=d;T>0;l[_+I]=i&255,I+=F,i/=256,T-=8);l[_+I-F]|=P*128}},{}],36:[function(m,k,v){typeof Object.create=="function"?k.exports=function(u,_){_&&(u.super_=_,u.prototype=Object.create(_.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}))}:k.exports=function(u,_){if(_){u.super_=_;var A=function(){};A.prototype=_.prototype,u.prototype=new A,u.prototype.constructor=u}}},{}],37:[function(m,k,v){var l=m("has-tostringtag/shams")(),u=m("call-bind/callBound"),_=u("Object.prototype.toString"),A=function(p){return l&&p&&typeof p=="object"&&Symbol.toStringTag in p?!1:_(p)==="[object Arguments]"},d=function(p){return A(p)?!0:p!==null&&typeof p=="object"&&typeof p.length=="number"&&p.length>=0&&_(p)!=="[object Array]"&&_(p.callee)==="[object Function]"},h=(function(){return A(arguments)})();A.isLegacyArguments=d,k.exports=h?A:d},{"call-bind/callBound":21,"has-tostringtag/shams":33}],38:[function(m,k,v){var l=Object.prototype.toString,u=Function.prototype.toString,_=/^\s*(?:function)?\*/,A=m("has-tostringtag/shams")(),d=Object.getPrototypeOf,h=function(){if(!A)return!1;try{return Function("return function*() {}")()}catch{}},i;k.exports=function(j){if(typeof j!="function")return!1;if(_.test(u.call(j)))return!0;if(!A){var T=l.call(j);return T==="[object GeneratorFunction]"}if(!d)return!1;if(typeof i>"u"){var c=h();i=c?d(c):!1}return d(j)===i}},{"has-tostringtag/shams":33}],39:[function(m,k,v){(function(l){(function(){var u=m("foreach"),_=m("available-typed-arrays"),A=m("call-bind/callBound"),d=A("Object.prototype.toString"),h=m("has-tostringtag/shams")(),i=typeof globalThis>"u"?l:globalThis,p=_(),j=A("Array.prototype.indexOf",!0)||function(P,S){for(var B=0;B<P.length;B+=1)if(P[B]===S)return B;return-1},T=A("String.prototype.slice"),c={},y=m("es-abstract/helpers/getOwnPropertyDescriptor"),C=Object.getPrototypeOf;h&&y&&C&&u(p,function(F){var P=new i[F];if(Symbol.toStringTag in P){var S=C(P),B=y(S,Symbol.toStringTag);if(!B){var x=C(S);B=y(x,Symbol.toStringTag)}c[F]=B.get}});var I=function(P){var S=!1;return u(c,function(B,x){if(!S)try{S=B.call(P)===x}catch{}}),S};k.exports=function(P){if(!P||typeof P!="object")return!1;if(!h||!(Symbol.toStringTag in P)){var S=T(d(P),8,-1);return j(p,S)>-1}return y?I(P):!1}}).call(this)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":17,"call-bind/callBound":21,"es-abstract/helpers/getOwnPropertyDescriptor":25,foreach:27,"has-tostringtag/shams":33}],40:[function(m,k,v){var l=1e3,u=l*60,_=u*60,A=_*24,d=A*7,h=A*365.25;k.exports=function(c,y){y=y||{};var C=typeof c;if(C==="string"&&c.length>0)return i(c);if(C==="number"&&isFinite(c))return y.long?j(c):p(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function i(c){if(c=String(c),!(c.length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(y){var C=parseFloat(y[1]),I=(y[2]||"ms").toLowerCase();switch(I){case"years":case"year":case"yrs":case"yr":case"y":return C*h;case"weeks":case"week":case"w":return C*d;case"days":case"day":case"d":return C*A;case"hours":case"hour":case"hrs":case"hr":case"h":return C*_;case"minutes":case"minute":case"mins":case"min":case"m":return C*u;case"seconds":case"second":case"secs":case"sec":case"s":return C*l;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return C;default:return}}}}function p(c){var y=Math.abs(c);return y>=A?Math.round(c/A)+"d":y>=_?Math.round(c/_)+"h":y>=u?Math.round(c/u)+"m":y>=l?Math.round(c/l)+"s":c+"ms"}function j(c){var y=Math.abs(c);return y>=A?T(c,y,A,"day"):y>=_?T(c,y,_,"hour"):y>=u?T(c,y,u,"minute"):y>=l?T(c,y,l,"second"):c+" ms"}function T(c,y,C,I){var F=y>=C*1.5;return Math.round(c/C)+" "+I+(F?"s":"")}},{}],41:[function(m,k,v){v.endianness=function(){return"LE"},v.hostname=function(){return typeof location<"u"?location.hostname:""},v.loadavg=function(){return[]},v.uptime=function(){return 0},v.freemem=function(){return Number.MAX_VALUE},v.totalmem=function(){return Number.MAX_VALUE},v.cpus=function(){return[]},v.type=function(){return"Browser"},v.release=function(){return typeof navigator<"u"?navigator.appVersion:""},v.networkInterfaces=v.getNetworkInterfaces=function(){return{}},v.arch=function(){return"javascript"},v.platform=function(){return"browser"},v.tmpdir=v.tmpDir=function(){return"/tmp"},v.EOL=`
`,v.homedir=function(){return"/"}},{}],42:[function(m,k,v){(function(l){(function(){function u(h){if(typeof h!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(h))}function _(h,i){for(var p="",j=0,T=-1,c=0,y,C=0;C<=h.length;++C){if(C<h.length)y=h.charCodeAt(C);else{if(y===47)break;y=47}if(y===47){if(!(T===C-1||c===1))if(T!==C-1&&c===2){if(p.length<2||j!==2||p.charCodeAt(p.length-1)!==46||p.charCodeAt(p.length-2)!==46){if(p.length>2){var I=p.lastIndexOf("/");if(I!==p.length-1){I===-1?(p="",j=0):(p=p.slice(0,I),j=p.length-1-p.lastIndexOf("/")),T=C,c=0;continue}}else if(p.length===2||p.length===1){p="",j=0,T=C,c=0;continue}}i&&(p.length>0?p+="/..":p="..",j=2)}else p.length>0?p+="/"+h.slice(T+1,C):p=h.slice(T+1,C),j=C-T-1;T=C,c=0}else y===46&&c!==-1?++c:c=-1}return p}function A(h,i){var p=i.dir||i.root,j=i.base||(i.name||"")+(i.ext||"");return p?p===i.root?p+j:p+h+j:j}var d={resolve:function(){for(var i="",p=!1,j,T=arguments.length-1;T>=-1&&!p;T--){var c;T>=0?c=arguments[T]:(j===void 0&&(j=l.cwd()),c=j),u(c),c.length!==0&&(i=c+"/"+i,p=c.charCodeAt(0)===47)}return i=_(i,!p),p?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(i){if(u(i),i.length===0)return".";var p=i.charCodeAt(0)===47,j=i.charCodeAt(i.length-1)===47;return i=_(i,!p),i.length===0&&!p&&(i="."),i.length>0&&j&&(i+="/"),p?"/"+i:i},isAbsolute:function(i){return u(i),i.length>0&&i.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var i,p=0;p<arguments.length;++p){var j=arguments[p];u(j),j.length>0&&(i===void 0?i=j:i+="/"+j)}return i===void 0?".":d.normalize(i)},relative:function(i,p){if(u(i),u(p),i===p||(i=d.resolve(i),p=d.resolve(p),i===p))return"";for(var j=1;j<i.length&&i.charCodeAt(j)===47;++j);for(var T=i.length,c=T-j,y=1;y<p.length&&p.charCodeAt(y)===47;++y);for(var C=p.length,I=C-y,F=c<I?c:I,P=-1,S=0;S<=F;++S){if(S===F){if(I>F){if(p.charCodeAt(y+S)===47)return p.slice(y+S+1);if(S===0)return p.slice(y+S)}else c>F&&(i.charCodeAt(j+S)===47?P=S:S===0&&(P=0));break}var B=i.charCodeAt(j+S),x=p.charCodeAt(y+S);if(B!==x)break;B===47&&(P=S)}var w="";for(S=j+P+1;S<=T;++S)(S===T||i.charCodeAt(S)===47)&&(w.length===0?w+="..":w+="/..");return w.length>0?w+p.slice(y+P):(y+=P,p.charCodeAt(y)===47&&++y,p.slice(y))},_makeLong:function(i){return i},dirname:function(i){if(u(i),i.length===0)return".";for(var p=i.charCodeAt(0),j=p===47,T=-1,c=!0,y=i.length-1;y>=1;--y)if(p=i.charCodeAt(y),p===47){if(!c){T=y;break}}else c=!1;return T===-1?j?"/":".":j&&T===1?"//":i.slice(0,T)},basename:function(i,p){if(p!==void 0&&typeof p!="string")throw new TypeError('"ext" argument must be a string');u(i);var j=0,T=-1,c=!0,y;if(p!==void 0&&p.length>0&&p.length<=i.length){if(p.length===i.length&&p===i)return"";var C=p.length-1,I=-1;for(y=i.length-1;y>=0;--y){var F=i.charCodeAt(y);if(F===47){if(!c){j=y+1;break}}else I===-1&&(c=!1,I=y+1),C>=0&&(F===p.charCodeAt(C)?--C===-1&&(T=y):(C=-1,T=I))}return j===T?T=I:T===-1&&(T=i.length),i.slice(j,T)}else{for(y=i.length-1;y>=0;--y)if(i.charCodeAt(y)===47){if(!c){j=y+1;break}}else T===-1&&(c=!1,T=y+1);return T===-1?"":i.slice(j,T)}},extname:function(i){u(i);for(var p=-1,j=0,T=-1,c=!0,y=0,C=i.length-1;C>=0;--C){var I=i.charCodeAt(C);if(I===47){if(!c){j=C+1;break}continue}T===-1&&(c=!1,T=C+1),I===46?p===-1?p=C:y!==1&&(y=1):p!==-1&&(y=-1)}return p===-1||T===-1||y===0||y===1&&p===T-1&&p===j+1?"":i.slice(p,T)},format:function(i){if(i===null||typeof i!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof i);return A("/",i)},parse:function(i){u(i);var p={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return p;var j=i.charCodeAt(0),T=j===47,c;T?(p.root="/",c=1):c=0;for(var y=-1,C=0,I=-1,F=!0,P=i.length-1,S=0;P>=c;--P){if(j=i.charCodeAt(P),j===47){if(!F){C=P+1;break}continue}I===-1&&(F=!1,I=P+1),j===46?y===-1?y=P:S!==1&&(S=1):y!==-1&&(S=-1)}return y===-1||I===-1||S===0||S===1&&y===I-1&&y===C+1?I!==-1&&(C===0&&T?p.base=p.name=i.slice(1,I):p.base=p.name=i.slice(C,I)):(C===0&&T?(p.name=i.slice(1,y),p.base=i.slice(1,I)):(p.name=i.slice(C,y),p.base=i.slice(C,I)),p.ext=i.slice(y,I)),C>0?p.dir=i.slice(0,C-1):T&&(p.dir="/"),p},sep:"/",delimiter:":",win32:null,posix:null};d.posix=d,k.exports=d}).call(this)}).call(this,m("_process"))},{_process:43}],43:[function(m,k,v){var l=k.exports={},u,_;function A(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?u=setTimeout:u=A}catch{u=A}try{typeof clearTimeout=="function"?_=clearTimeout:_=d}catch{_=d}})();function h(P){if(u===setTimeout)return setTimeout(P,0);if((u===A||!u)&&setTimeout)return u=setTimeout,setTimeout(P,0);try{return u(P,0)}catch{try{return u.call(null,P,0)}catch{return u.call(this,P,0)}}}function i(P){if(_===clearTimeout)return clearTimeout(P);if((_===d||!_)&&clearTimeout)return _=clearTimeout,clearTimeout(P);try{return _(P)}catch{try{return _.call(null,P)}catch{return _.call(this,P)}}}var p=[],j=!1,T,c=-1;function y(){!j||!T||(j=!1,T.length?p=T.concat(p):c=-1,p.length&&C())}function C(){if(!j){var P=h(y);j=!0;for(var S=p.length;S;){for(T=p,p=[];++c<S;)T&&T[c].run();c=-1,S=p.length}T=null,j=!1,i(P)}}l.nextTick=function(P){var S=new Array(arguments.length-1);if(arguments.length>1)for(var B=1;B<arguments.length;B++)S[B-1]=arguments[B];p.push(new I(P,S)),p.length===1&&!j&&h(C)};function I(P,S){this.fun=P,this.array=S}I.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={};function F(){}l.on=F,l.addListener=F,l.once=F,l.off=F,l.removeListener=F,l.removeAllListeners=F,l.emit=F,l.prependListener=F,l.prependOnceListener=F,l.listeners=function(P){return[]},l.binding=function(P){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(P){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],44:[function(m,k,v){k.exports=function(u){return u&&typeof u=="object"&&typeof u.copy=="function"&&typeof u.fill=="function"&&typeof u.readUInt8=="function"}},{}],45:[function(m,k,v){var l=m("is-arguments"),u=m("is-generator-function"),_=m("which-typed-array"),A=m("is-typed-array");function d(s){return s.call.bind(s)}var h=typeof BigInt<"u",i=typeof Symbol<"u",p=d(Object.prototype.toString),j=d(Number.prototype.valueOf),T=d(String.prototype.valueOf),c=d(Boolean.prototype.valueOf);if(h)var y=d(BigInt.prototype.valueOf);if(i)var C=d(Symbol.prototype.valueOf);function I(s,U){if(typeof s!="object")return!1;try{return U(s),!0}catch{return!1}}v.isArgumentsObject=l,v.isGeneratorFunction=u,v.isTypedArray=A;function F(s){return typeof Promise<"u"&&s instanceof Promise||s!==null&&typeof s=="object"&&typeof s.then=="function"&&typeof s.catch=="function"}v.isPromise=F;function P(s){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):A(s)||e(s)}v.isArrayBufferView=P;function S(s){return _(s)==="Uint8Array"}v.isUint8Array=S;function B(s){return _(s)==="Uint8ClampedArray"}v.isUint8ClampedArray=B;function x(s){return _(s)==="Uint16Array"}v.isUint16Array=x;function w(s){return _(s)==="Uint32Array"}v.isUint32Array=w;function r(s){return _(s)==="Int8Array"}v.isInt8Array=r;function a(s){return _(s)==="Int16Array"}v.isInt16Array=a;function E(s){return _(s)==="Int32Array"}v.isInt32Array=E;function M(s){return _(s)==="Float32Array"}v.isFloat32Array=M;function L(s){return _(s)==="Float64Array"}v.isFloat64Array=L;function W(s){return _(s)==="BigInt64Array"}v.isBigInt64Array=W;function D(s){return _(s)==="BigUint64Array"}v.isBigUint64Array=D;function V(s){return p(s)==="[object Map]"}V.working=typeof Map<"u"&&V(new Map);function H(s){return typeof Map>"u"?!1:V.working?V(s):s instanceof Map}v.isMap=H;function q(s){return p(s)==="[object Set]"}q.working=typeof Set<"u"&&q(new Set);function Q(s){return typeof Set>"u"?!1:q.working?q(s):s instanceof Set}v.isSet=Q;function ie(s){return p(s)==="[object WeakMap]"}ie.working=typeof WeakMap<"u"&&ie(new WeakMap);function ne(s){return typeof WeakMap>"u"?!1:ie.working?ie(s):s instanceof WeakMap}v.isWeakMap=ne;function ue(s){return p(s)==="[object WeakSet]"}ue.working=typeof WeakSet<"u"&&ue(new WeakSet);function ce(s){return ue(s)}v.isWeakSet=ce;function g(s){return p(s)==="[object ArrayBuffer]"}g.working=typeof ArrayBuffer<"u"&&g(new ArrayBuffer);function O(s){return typeof ArrayBuffer>"u"?!1:g.working?g(s):s instanceof ArrayBuffer}v.isArrayBuffer=O;function Y(s){return p(s)==="[object DataView]"}Y.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Y(new DataView(new ArrayBuffer(1),0,1));function e(s){return typeof DataView>"u"?!1:Y.working?Y(s):s instanceof DataView}v.isDataView=e;var o=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function b(s){return p(s)==="[object SharedArrayBuffer]"}function z(s){return typeof o>"u"?!1:(typeof b.working>"u"&&(b.working=b(new o)),b.working?b(s):s instanceof o)}v.isSharedArrayBuffer=z;function J(s){return p(s)==="[object AsyncFunction]"}v.isAsyncFunction=J;function X(s){return p(s)==="[object Map Iterator]"}v.isMapIterator=X;function K(s){return p(s)==="[object Set Iterator]"}v.isSetIterator=K;function Z(s){return p(s)==="[object Generator]"}v.isGeneratorObject=Z;function ee(s){return p(s)==="[object WebAssembly.Module]"}v.isWebAssemblyCompiledModule=ee;function ae(s){return I(s,j)}v.isNumberObject=ae;function pe(s){return I(s,T)}v.isStringObject=pe;function he(s){return I(s,c)}v.isBooleanObject=he;function de(s){return h&&I(s,y)}v.isBigIntObject=de;function f(s){return i&&I(s,C)}v.isSymbolObject=f;function t(s){return ae(s)||pe(s)||he(s)||de(s)||f(s)}v.isBoxedPrimitive=t;function n(s){return typeof Uint8Array<"u"&&(O(s)||z(s))}v.isAnyArrayBuffer=n,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(s){Object.defineProperty(v,s,{enumerable:!1,value:function(){throw new Error(s+" is not supported in userland")}})})},{"is-arguments":37,"is-generator-function":38,"is-typed-array":39,"which-typed-array":47}],46:[function(m,k,v){(function(l){(function(){var u=Object.getOwnPropertyDescriptors||function(o){for(var b=Object.keys(o),z={},J=0;J<b.length;J++)z[b[J]]=Object.getOwnPropertyDescriptor(o,b[J]);return z},_=/%[sdj%]/g;v.format=function(e){if(!a(e)){for(var o=[],b=0;b<arguments.length;b++)o.push(i(arguments[b]));return o.join(" ")}for(var b=1,z=arguments,J=z.length,X=String(e).replace(_,function(Z){if(Z==="%%")return"%";if(b>=J)return Z;switch(Z){case"%s":return String(z[b++]);case"%d":return Number(z[b++]);case"%j":try{return JSON.stringify(z[b++])}catch{return"[Circular]"}default:return Z}}),K=z[b];b<J;K=z[++b])x(K)||!W(K)?X+=" "+K:X+=" "+i(K);return X},v.deprecate=function(e,o){if(typeof l<"u"&&l.noDeprecation===!0)return e;if(typeof l>"u")return function(){return v.deprecate(e,o).apply(this,arguments)};var b=!1;function z(){if(!b){if(l.throwDeprecation)throw new Error(o);l.traceDeprecation?console.trace(o):console.error(o),b=!0}return e.apply(this,arguments)}return z};var A={},d=/^$/;if(l.env.NODE_DEBUG){var h=l.env.NODE_DEBUG;h=h.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),d=new RegExp("^"+h+"$","i")}v.debuglog=function(e){if(e=e.toUpperCase(),!A[e])if(d.test(e)){var o=l.pid;A[e]=function(){var b=v.format.apply(v,arguments);console.error("%s %d: %s",e,o,b)}}else A[e]=function(){};return A[e]};function i(e,o){var b={seen:[],stylize:j};return arguments.length>=3&&(b.depth=arguments[2]),arguments.length>=4&&(b.colors=arguments[3]),B(o)?b.showHidden=o:o&&v._extend(b,o),M(b.showHidden)&&(b.showHidden=!1),M(b.depth)&&(b.depth=2),M(b.colors)&&(b.colors=!1),M(b.customInspect)&&(b.customInspect=!0),b.colors&&(b.stylize=p),c(b,e,b.depth)}v.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function p(e,o){var b=i.styles[o];return b?"\x1B["+i.colors[b][0]+"m"+e+"\x1B["+i.colors[b][1]+"m":e}function j(e,o){return e}function T(e){var o={};return e.forEach(function(b,z){o[b]=!0}),o}function c(e,o,b){if(e.customInspect&&o&&H(o.inspect)&&o.inspect!==v.inspect&&!(o.constructor&&o.constructor.prototype===o)){var z=o.inspect(b,e);return a(z)||(z=c(e,z,b)),z}var J=y(e,o);if(J)return J;var X=Object.keys(o),K=T(X);if(e.showHidden&&(X=Object.getOwnPropertyNames(o)),V(o)&&(X.indexOf("message")>=0||X.indexOf("description")>=0))return C(o);if(X.length===0){if(H(o)){var Z=o.name?": "+o.name:"";return e.stylize("[Function"+Z+"]","special")}if(L(o))return e.stylize(RegExp.prototype.toString.call(o),"regexp");if(D(o))return e.stylize(Date.prototype.toString.call(o),"date");if(V(o))return C(o)}var ee="",ae=!1,pe=["{","}"];if(S(o)&&(ae=!0,pe=["[","]"]),H(o)){var he=o.name?": "+o.name:"";ee=" [Function"+he+"]"}if(L(o)&&(ee=" "+RegExp.prototype.toString.call(o)),D(o)&&(ee=" "+Date.prototype.toUTCString.call(o)),V(o)&&(ee=" "+C(o)),X.length===0&&(!ae||o.length==0))return pe[0]+ee+pe[1];if(b<0)return L(o)?e.stylize(RegExp.prototype.toString.call(o),"regexp"):e.stylize("[Object]","special");e.seen.push(o);var de;return ae?de=I(e,o,b,K,X):de=X.map(function(f){return F(e,o,b,K,f,ae)}),e.seen.pop(),P(de,ee,pe)}function y(e,o){if(M(o))return e.stylize("undefined","undefined");if(a(o)){var b="'"+JSON.stringify(o).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(b,"string")}if(r(o))return e.stylize(""+o,"number");if(B(o))return e.stylize(""+o,"boolean");if(x(o))return e.stylize("null","null")}function C(e){return"["+Error.prototype.toString.call(e)+"]"}function I(e,o,b,z,J){for(var X=[],K=0,Z=o.length;K<Z;++K)ce(o,String(K))?X.push(F(e,o,b,z,String(K),!0)):X.push("");return J.forEach(function(ee){ee.match(/^\d+$/)||X.push(F(e,o,b,z,ee,!0))}),X}function F(e,o,b,z,J,X){var K,Z,ee;if(ee=Object.getOwnPropertyDescriptor(o,J)||{value:o[J]},ee.get?ee.set?Z=e.stylize("[Getter/Setter]","special"):Z=e.stylize("[Getter]","special"):ee.set&&(Z=e.stylize("[Setter]","special")),ce(z,J)||(K="["+J+"]"),Z||(e.seen.indexOf(ee.value)<0?(x(b)?Z=c(e,ee.value,null):Z=c(e,ee.value,b-1),Z.indexOf(`
`)>-1&&(X?Z=Z.split(`
`).map(function(ae){return"  "+ae}).join(`
`).substr(2):Z=`
`+Z.split(`
`).map(function(ae){return"   "+ae}).join(`
`))):Z=e.stylize("[Circular]","special")),M(K)){if(X&&J.match(/^\d+$/))return Z;K=JSON.stringify(""+J),K.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(K=K.substr(1,K.length-2),K=e.stylize(K,"name")):(K=K.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),K=e.stylize(K,"string"))}return K+": "+Z}function P(e,o,b){var z=e.reduce(function(J,X){return X.indexOf(`
`)>=0,J+X.replace(/\u001b\[\d\d?m/g,"").length+1},0);return z>60?b[0]+(o===""?"":o+`
 `)+" "+e.join(`,
  `)+" "+b[1]:b[0]+o+" "+e.join(", ")+" "+b[1]}v.types=m("./support/types");function S(e){return Array.isArray(e)}v.isArray=S;function B(e){return typeof e=="boolean"}v.isBoolean=B;function x(e){return e===null}v.isNull=x;function w(e){return e==null}v.isNullOrUndefined=w;function r(e){return typeof e=="number"}v.isNumber=r;function a(e){return typeof e=="string"}v.isString=a;function E(e){return typeof e=="symbol"}v.isSymbol=E;function M(e){return e===void 0}v.isUndefined=M;function L(e){return W(e)&&Q(e)==="[object RegExp]"}v.isRegExp=L,v.types.isRegExp=L;function W(e){return typeof e=="object"&&e!==null}v.isObject=W;function D(e){return W(e)&&Q(e)==="[object Date]"}v.isDate=D,v.types.isDate=D;function V(e){return W(e)&&(Q(e)==="[object Error]"||e instanceof Error)}v.isError=V,v.types.isNativeError=V;function H(e){return typeof e=="function"}v.isFunction=H;function q(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e>"u"}v.isPrimitive=q,v.isBuffer=m("./support/isBuffer");function Q(e){return Object.prototype.toString.call(e)}function ie(e){return e<10?"0"+e.toString(10):e.toString(10)}var ne=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ue(){var e=new Date,o=[ie(e.getHours()),ie(e.getMinutes()),ie(e.getSeconds())].join(":");return[e.getDate(),ne[e.getMonth()],o].join(" ")}v.log=function(){console.log("%s - %s",ue(),v.format.apply(v,arguments))},v.inherits=m("inherits"),v._extend=function(e,o){if(!o||!W(o))return e;for(var b=Object.keys(o),z=b.length;z--;)e[b[z]]=o[b[z]];return e};function ce(e,o){return Object.prototype.hasOwnProperty.call(e,o)}var g=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;v.promisify=function(o){if(typeof o!="function")throw new TypeError('The "original" argument must be of type Function');if(g&&o[g]){var b=o[g];if(typeof b!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(b,g,{value:b,enumerable:!1,writable:!1,configurable:!0}),b}function b(){for(var z,J,X=new Promise(function(ee,ae){z=ee,J=ae}),K=[],Z=0;Z<arguments.length;Z++)K.push(arguments[Z]);K.push(function(ee,ae){ee?J(ee):z(ae)});try{o.apply(this,K)}catch(ee){J(ee)}return X}return Object.setPrototypeOf(b,Object.getPrototypeOf(o)),g&&Object.defineProperty(b,g,{value:b,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(b,u(o))},v.promisify.custom=g;function O(e,o){if(!e){var b=new Error("Promise was rejected with a falsy value");b.reason=e,e=b}return o(e)}function Y(e){if(typeof e!="function")throw new TypeError('The "original" argument must be of type Function');function o(){for(var b=[],z=0;z<arguments.length;z++)b.push(arguments[z]);var J=b.pop();if(typeof J!="function")throw new TypeError("The last argument must be of type Function");var X=this,K=function(){return J.apply(X,arguments)};e.apply(this,b).then(function(Z){l.nextTick(K.bind(null,null,Z))},function(Z){l.nextTick(O.bind(null,Z,K))})}return Object.setPrototypeOf(o,Object.getPrototypeOf(e)),Object.defineProperties(o,u(e)),o}v.callbackify=Y}).call(this)}).call(this,m("_process"))},{"./support/isBuffer":44,"./support/types":45,_process:43,inherits:36}],47:[function(m,k,v){(function(l){(function(){var u=m("foreach"),_=m("available-typed-arrays"),A=m("call-bind/callBound"),d=A("Object.prototype.toString"),h=m("has-tostringtag/shams")(),i=typeof globalThis>"u"?l:globalThis,p=_(),j=A("String.prototype.slice"),T={},c=m("es-abstract/helpers/getOwnPropertyDescriptor"),y=Object.getPrototypeOf;h&&c&&y&&u(p,function(F){if(typeof i[F]=="function"){var P=new i[F];if(Symbol.toStringTag in P){var S=y(P),B=c(S,Symbol.toStringTag);if(!B){var x=y(S);B=c(x,Symbol.toStringTag)}T[F]=B.get}}});var C=function(P){var S=!1;return u(T,function(B,x){if(!S)try{var w=B.call(P);w===x&&(S=w)}catch{}}),S},I=m("is-typed-array");k.exports=function(P){return I(P)?!h||!(Symbol.toStringTag in P)?j(d(P),8,-1):C(P):!1}}).call(this)}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":17,"call-bind/callBound":21,"es-abstract/helpers/getOwnPropertyDescriptor":25,foreach:27,"has-tostringtag/shams":33,"is-typed-array":39}],rhea:[function(m,k,v){(function(l){(function(){var u=m("./connection.js"),_=m("./log.js"),A=m("./sasl.js"),d=m("./util.js"),h=m("./eventTypes.js"),i=m("net"),p=m("tls"),j=m("events").EventEmitter,T=function(y){this.options=y?Object.create(y):{},this.options.id||(this.options.id=d.generate_uuid()),this.id=this.options.id,this.sasl_server_mechanisms=A.server_mechanisms()};T.prototype=Object.create(j.prototype),T.prototype.constructor=T,T.prototype.dispatch=function(y){return _.events("[%s] Container got event: "+y,this.id),j.prototype.emit.apply(this,arguments),!!this.listeners(y).length},T.prototype.connect=function(y){return new u(y,this).connect()},T.prototype.create_connection=function(y){return new u(y,this)},T.prototype.listen=function(y){var C=this,I;if(y.transport===void 0||y.transport==="tcp")I=i.createServer(y),I.on("connection",function(F){new u(y,C).accept(F)});else if(y.transport==="tls"||y.transport==="ssl")I=p.createServer(y),I.on("secureConnection",function(F){new u(y,C).accept(F)});else throw Error("Unrecognised transport: "+y.transport);return l.version.match(/v0\.10\.\d+/)?I.listen(y.port,y.host):I.listen(y),I},T.prototype.create_container=function(y){return new T(y)},T.prototype.get_option=function(y,C){return this.options[y]!==void 0?this.options[y]:C},T.prototype.generate_uuid=d.generate_uuid,T.prototype.string_to_uuid=d.string_to_uuid,T.prototype.uuid_to_string=d.uuid_to_string;var c=m("./ws.js");T.prototype.websocket_accept=function(y,C){new u(C,this).accept(c.wrap(y))},T.prototype.websocket_connect=c.connect,T.prototype.filter=m("./filter.js"),T.prototype.types=m("./types.js"),T.prototype.message=m("./message.js"),T.prototype.sasl=A,T.prototype.ReceiverEvents=h.ReceiverEvents,T.prototype.SenderEvents=h.SenderEvents,T.prototype.SessionEvents=h.SessionEvents,T.prototype.ConnectionEvents=h.ConnectionEvents,k.exports=new T}).call(this)}).call(this,m("_process"))},{"./connection.js":1,"./eventTypes.js":4,"./filter.js":5,"./log.js":8,"./message.js":9,"./sasl.js":10,"./types.js":14,"./util.js":15,"./ws.js":16,_process:43,events:26,net:19,tls:19}]},{},[])("rhea")})})(be)),be.exports}var He=Ve();const ye=Je(He);class me{constructor(R,m){this.connection=null,this.cbsAuthenticated=!1,this.namespace=R,this.token=m,this.hostname=`${R}.servicebus.windows.net`}async connect(){return new Promise((R,m)=>{const k=`wss://${this.hostname}:443/$servicebus/websocket`,v=ye.websocket_connect(WebSocket);this.connection=ye.connect({connection_details:v(k,["AMQPWSB10"],{}),host:this.hostname,hostname:this.hostname,port:443,transport:"ssl",reconnect:!1}),this.connection.on("connection_open",()=>{R()}),this.connection.on("connection_error",l=>{m(new Error(l.error?l.error.toString():"Connection error"))}),this.connection.on("disconnected",l=>{l.error&&!this.cbsAuthenticated&&m(new Error(l.error.toString()))})})}async authenticateCBS(R){if(!this.connection)throw new Error("Connection not established");return new Promise((m,k)=>{const v=this.connection.open_sender("$cbs"),l=this.connection.open_receiver("$cbs");l.on("message",u=>{const _=u.message.application_properties["status-code"],A=u.message.application_properties["status-description"];l.close(),v.close(),_===200||_===202?(this.cbsAuthenticated=!0,m({statusCode:_,statusDesc:A})):k(new Error(`CBS auth failed: ${_} - ${A}`))}),v.on("sender_open",()=>{const u={application_properties:{operation:"put-token",type:"jwt",name:`sb://${this.hostname}/${R}`},body:this.token};v.send(u)}),setTimeout(()=>k(new Error("CBS authentication timeout")),1e4)})}close(){this.connection&&this.connection.close()}}class Xe{constructor(R,m){this.sender=null,this.receiver=null,this.replyTo=null,this.connection=R,this.entityPath=m,this.managementAddress=`${m}/$management`}async open(){if(!this.connection.connection)throw new Error("Connection not established");return new Promise((R,m)=>{this.replyTo=`mgmt-reply-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,this.sender=this.connection.connection.open_sender({target:{address:this.managementAddress}}),this.receiver=this.connection.connection.open_receiver({source:{address:this.managementAddress},target:{address:this.replyTo}});let k=!1,v=!1;const l=()=>{k&&v&&R()};this.sender.on("sender_open",()=>{k=!0,l()}),this.receiver.on("receiver_open",()=>{v=!0,l()}),this.sender.on("sender_error",u=>{m(new Error(u.sender.error?u.sender.error.toString():"Sender error"))}),this.receiver.on("receiver_error",u=>{m(new Error(u.receiver.error?u.receiver.error.toString():"Receiver error"))}),setTimeout(()=>m(new Error("Management client open timeout")),1e4)})}async peekMessages(R=0,m=1){if(!this.sender||!this.receiver||!this.replyTo)throw new Error("Management client not opened");return new Promise((k,v)=>{const l=this.replyTo,u=d=>{const h=d.message.application_properties?.statusCode,i=d.message.application_properties?.statusDescription;if(h===200||h===204){const p=d.message.body;let j=[];if(h===204){k([]),this.receiver.removeListener("message",u);return}if(p&&p.messages){const T=Array.isArray(p.messages)?p.messages:[p.messages];for(const c of T)if(c.message)try{const y=Ke(c.message);j.push(y)}catch(y){console.error("Failed to decode message:",y)}}k(j)}else v(new Error(`Peek failed: ${h} - ${i}`));this.receiver.removeListener("message",u)};this.receiver.on("message",u);const _={};_["from-sequence-number"]=ye.types.wrap_long(R),_["message-count"]=ye.types.wrap_int(m);const A={body:_,reply_to:l,application_properties:{operation:"com.microsoft:peek-message"},message_id:`peek-${Date.now()}`};this.sender.send(A),setTimeout(()=>{this.receiver.removeListener("message",u),v(new Error("Peek request timeout"))},1e4)})}async deleteMessagesBySequenceNumbers(R){if(!this.sender||!this.receiver||!this.replyTo)throw new Error("Management client not opened");return new Promise((m,k)=>{const v=this.replyTo,l=d=>{const h=d.message.application_properties?.statusCode,i=d.message.application_properties?.statusDescription;h===200||h===204?m():k(new Error(`Delete failed: ${h} - ${i}`)),this.receiver.removeListener("message",l)};this.receiver.on("message",l);const u=R.map(d=>{const h=globalThis.Buffer.alloc(8);return h.writeBigInt64BE(BigInt(d)),h}),_={};_["sequence-numbers"]=ye.types.wrap_array(u,129,void 0),_["receiver-settle-mode"]=ye.types.wrap_uint(0);const A={body:_,reply_to:v,application_properties:{operation:"com.microsoft:receive-by-sequence-number"},message_id:`delete-${Date.now()}`};this.sender.send(A),setTimeout(()=>{this.receiver.removeListener("message",l),k(new Error("Delete request timeout"))},1e4)})}close(){this.sender&&this.sender.close(),this.receiver&&this.receiver.close()}}function Ke($){let R;if($.type==="Buffer"&&Array.isArray($.data))R=new Uint8Array($.data);else if($ instanceof Uint8Array)R=$;else throw new Error("Invalid message buffer format");return ye.message.decode(R)}class Te{constructor(R,m,k={}){this.receiver=null,this.messageCount=0,this.connection=R,this.queueName=m,this.options={peekMode:k.peekMode||!1,maxMessages:k.maxMessages??null,autoClose:k.autoClose!==!1}}receive(R,m){if(!this.connection.connection)throw new Error("Connection not established");const k=this.options.peekMode?1:0;this.receiver=this.connection.connection.open_receiver({source:{address:this.queueName},credit_window:this.options.maxMessages||10,autoaccept:!this.options.peekMode,rcv_settle_mode:k}),this.receiver.on("message",v=>{this.messageCount++,R&&R(v.message),this.options.maxMessages&&this.messageCount>=this.options.maxMessages&&this.options.autoClose&&(this.close(),this.connection.close())}),this.receiver.on("receiver_error",v=>{if(m){const l=v.receiver.error;m(new Error(l?l.toString():"Receiver error"))}})}close(){this.receiver&&this.receiver.close()}}class Ze{constructor(R,m){this.sender=null,this.connection=R,this.entityPath=m}async open(){if(!this.connection.connection)throw new Error("Connection not established");return new Promise((R,m)=>{this.sender=this.connection.connection.open_sender({target:{address:this.entityPath}}),this.sender.on("sender_open",()=>{R()}),this.sender.on("sender_error",k=>{m(new Error(k.sender.error?k.sender.error.toString():"Sender error"))}),setTimeout(()=>m(new Error("Sender open timeout")),5e3)})}async send(R,m={}){if(!this.sender)throw new Error("Sender not opened. Call open() first.");const k=m.message_id||m.messageId||`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;let v,l=m.content_type||m.contentType;typeof R=="string"?(v=new TextEncoder().encode(R),l=l||"text/plain"):R instanceof Uint8Array?(v=R,l=l||"application/octet-stream"):R instanceof ArrayBuffer?(v=new Uint8Array(R),l=l||"application/octet-stream"):(v=new TextEncoder().encode(JSON.stringify(R)),l=l||"application/json");const u={body:v,content_type:l,message_id:k,creation_time:new Date,...m};return delete u.contentType,delete u.messageId,new Promise((_,A)=>{const d=()=>{try{this.sender.send(u),_()}catch(h){A(h)}};this.sender.sendable()?d():(this.sender.once("sendable",d),setTimeout(()=>{this.sender.removeListener("sendable",d),A(new Error("Send timeout - sender not ready"))},5e3))})}close(){this.sender&&this.sender.close()}}function Ae($){const R=Ee($.body);return{messageId:$.message_id,body:R,contentType:$.content_type,deliveryCount:$.delivery_count||0,enqueuedTime:$.message_annotations?.["x-opt-enqueued-time"],sequenceNumber:$.message_annotations?.["x-opt-sequence-number"],lockedUntil:$.message_annotations?.["x-opt-locked-until"],applicationProperties:$.application_properties||{},properties:$.properties||{},ttl:$.ttl,expiryTime:$.absolute_expiry_time,creationTime:$.creation_time}}function Ee($){if(typeof $=="string")return $;if($&&typeof $=="object"&&$.typecode===117&&($=$.content),$ instanceof Uint8Array)return new TextDecoder("utf-8").decode($);if($&&$.type==="Buffer"&&Array.isArray($.data)){const R=new Uint8Array($.data);return new TextDecoder("utf-8").decode(R)}if($&&typeof $=="object"&&$.typecode!==void 0){if($.value!==void 0)return Ee($.value);if($.content!==void 0)return Ee($.content)}return $}async function Ce($,R,m,k=10,v=0,l=!1){const u=l?`${R}/$DeadLetterQueue`:R;return await Pe($,u,m,k,v)}async function ke($,R,m,k,v=10,l=0,u=!1){const _=`${R}/subscriptions/${m}`,A=u?`${_}/$DeadLetterQueue`:_;return await Pe($,A,k,v,l)}async function Pe($,R,m,k=10,v=0){const l=new me($,m);try{await l.connect(),await l.authenticateCBS(R);const u=new Xe(l,R);await u.open();const _=await u.peekMessages(v,k);return u.close(),l.close(),_.map(A=>Ae(A))}catch(u){throw l.close(),new Error(`Peek failed: ${u.message}`)}}async function je($,R,m,k,v={}){return await ge($,R,m,k,v)}async function Oe($,R,m,k,v={}){return await ge($,R,m,k,v)}async function ge($,R,m,k,v={}){const l=new me($,m);try{await l.connect(),await l.authenticateCBS(R);const u=new Ze(l,R);await u.open(),await u.send(k,v),u.close(),l.close()}catch(u){throw l.close(),new Error(`Send failed: ${u.message}`)}}async function Ie($,R,m,k,v,l={}){const u={...l,message_annotations:{...l.message_annotations,"x-opt-scheduled-enqueue-time":v}};return await ge($,R,m,k,u)}async function Ue($,R,m,k,v,l={}){const u={...l,message_annotations:{...l.message_annotations,"x-opt-scheduled-enqueue-time":v}};return await ge($,R,m,k,u)}const _e=new Map;async function Be($,R,m,k=5,v=!1,l=1){const u=v?`${R}/$DeadLetterQueue`:R;return await Me($,u,m,k,l)}async function xe($,R,m,k,v=5,l=!1,u=1){const _=`${R}/subscriptions/${m}`,A=l?`${_}/$DeadLetterQueue`:_;return await Me($,A,k,v,u)}async function Me($,R,m,k=5,v=1){const l=new me($,m);try{return await l.connect(),await l.authenticateCBS(R),new Promise((u,_)=>{const A=[];let d=0,h=!1,i=null;const p=l.connection.open_receiver({source:{address:R},credit_window:0,autoaccept:!1,rcv_settle_mode:1});p.on("message",j=>{if(h)return;i&&(clearTimeout(i),i=null);const T=Ae(j.message),c=j.delivery.tag.toString("hex");if(T.lockToken=c,_e.set(c,{delivery:j.delivery,receiver:p,connection:l}),A.push(T),d++,d>=v){h=!0,u(A);return}i=setTimeout(()=>{h=!0,u(A)},500)}),p.on("receiver_error",j=>{h||(i&&clearTimeout(i),p.close(),l.close(),_(new Error(j.receiver.error?j.receiver.error.toString():"Receiver error")))}),p.add_credit(v),setTimeout(()=>{h||(h=!0,i&&clearTimeout(i),u(A))},k*1e3)})}catch(u){throw l.close(),new Error(`Receive and lock failed: ${u.message}`)}}async function Fe($){const R={successCount:0,failureCount:0,errors:[]};for(const m of $)try{const k=_e.get(m);if(!k)throw new Error("Message not found or lock expired");k.delivery.accept(),k.receiver.close(),k.connection.close(),_e.delete(m),R.successCount++}catch(k){R.failureCount++,R.errors.push({messageId:m,error:k.message})}return R}async function Le($){const R={successCount:0,failureCount:0,errors:[]};for(const m of $)try{const k=_e.get(m);if(!k)throw new Error("Message not found or lock expired");k.delivery.release(),k.receiver.close(),k.connection.close(),_e.delete(m),R.successCount++}catch(k){R.failureCount++,R.errors.push({messageId:m,error:k.message})}return R}async function Re($,R={}){const m={successCount:0,failureCount:0,errors:[]};for(const k of $)try{const v=_e.get(k);if(!v)throw new Error("Message not found or lock expired");v.delivery.reject({condition:"com.microsoft:dead-letter",description:R.deadLetterErrorDescription||"Manual dead letter from browser",info:{DeadLetterReason:R.deadLetterReason||"Manual dead letter",DeadLetterErrorDescription:R.deadLetterErrorDescription||""}}),v.receiver.close(),v.connection.close(),_e.delete(k),m.successCount++}catch(v){m.failureCount++,m.errors.push({messageId:k,error:v.message})}return m}async function Ne($,R,m,k=null,v=!1){const l=v?`${R}/$DeadLetterQueue`:R;return await $e($,l,m,k)}async function De($,R,m,k,v=null,l=!1){const u=`${R}/subscriptions/${m}`,_=l?`${u}/$DeadLetterQueue`:u;return await $e($,_,k,v)}async function $e($,R,m,k=null){const v=new me($,m);let l=!0,u=0;try{await v.connect(),await v.authenticateCBS(R);const _=new Te(v,R,{peekMode:!1,maxMessages:null,autoClose:!1});return{promise:new Promise((d,h)=>{let i=null;_.receive(p=>{u++,k&&k(u),i&&clearTimeout(i),i=setTimeout(()=>{l&&(_.close(),v.close(),d(u))},2e3)},p=>{_.close(),v.close(),h(new Error(`Purge failed: ${p.message}`))})}),stop:()=>(l=!1,_.close(),v.close(),u),getCount:()=>u}}catch(_){throw v.close(),new Error(`Purge failed: ${_.message}`)}}async function We($,R,m,k,v){return await Ge($,R,m,k,v)}async function ze($,R,m,k,v,l){const u=`${R}/subscriptions/${m}`;return await Ge($,u,k,v,l)}async function Ge($,R,m,k,v){const l=new me($,m);try{await l.connect(),await l.authenticateCBS(R);const u=new Te(l,R,{peekMode:!0,maxMessages:null,autoClose:!1});return u.receive(_=>k(Ae(_)),v),{stop:()=>{u.close(),l.close()}}}catch(u){throw l.close(),new Error(`Monitor failed: ${u.message}`)}}window.ServiceBusAPI={peekQueueMessages:Ce,peekSubscriptionMessages:ke,receiveAndLockQueueMessage:Be,receiveAndLockSubscriptionMessage:xe,complete:Fe,abandon:Le,deadLetter:Re,sendQueueMessage:je,sendTopicMessage:Oe,sendScheduledQueueMessage:Ie,sendScheduledTopicMessage:Ue,purgeQueue:Ne,purgeSubscription:De,monitorQueue:We,monitorSubscription:ze},le.abandon=Le,le.complete=Fe,le.deadLetter=Re,le.monitorQueue=We,le.monitorSubscription=ze,le.peekQueueMessages=Ce,le.peekSubscriptionMessages=ke,le.purgeQueue=Ne,le.purgeSubscription=De,le.receiveAndLockQueueMessage=Be,le.receiveAndLockSubscriptionMessage=xe,le.sendQueueMessage=je,le.sendScheduledQueueMessage=Ie,le.sendScheduledTopicMessage=Ue,le.sendTopicMessage=Oe,Object.defineProperty(le,Symbol.toStringTag,{value:"Module"})})(this.ServiceBusAPI=this.ServiceBusAPI||{});

@inject NavigationManager Navigation
@inject NavigationStateService NavState
@implements IDisposable

<div class="nav-menu">
    <div class="p-3">
        <h4>Service Bus Explorer</h4>
    </div>
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span aria-hidden="true">üîç</span> Explore
            </NavLink>
        </div>
        
        <AuthorizeView>
            <Authorized>
                @if (NavState.RecentNamespaces.Any())
                {
                    <div class="px-3 mt-3">
                        <small class="text-muted fw-bold">RECENT</small>
                        <div class="mt-2">
                            @foreach (var ns in NavState.RecentNamespaces)
                            {
                                <a href="@GetExplorerUrl(ns)" class="recent-namespace-tile d-block mb-2 p-2">
                                    <div class="fw-semibold">@ns.Name</div>
                                    <small class="text-muted">@ns.Location</small>
                                </a>
                            }
                        </div>
                    </div>
                }
            </Authorized>
        </AuthorizeView>
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        NavState.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        NavState.OnChange -= StateHasChanged;
    }

    private string GetExplorerUrl(ServiceBusNamespaceInfo ns)
    {
        return $"explorer?namespace={Uri.EscapeDataString(ns.FullyQualifiedNamespace)}&rg={Uri.EscapeDataString(ns.ResourceGroup)}&sub={Uri.EscapeDataString(ns.SubscriptionId)}&name={Uri.EscapeDataString(ns.Name)}";
    }
}
